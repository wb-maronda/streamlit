{"version":3,"file":"HostCommunicationManager.test.js","names":["HostCommunicationManager","HOST_COMM_VERSION","mockEventListeners","listeners","window","addEventListener","jest","fn","event","cb","push","type","forEach","describe","hostCommunicationMgr","dispatchEvent","originalHash","setAllowedOriginsFunc","openCommFunc","sendMessageToHostFunc","beforeEach","themeChanged","sendRerunBackMsg","pageChanged","closeModal","stopScript","rerunScript","clearCache","sendAppHeartbeat","setInputsDisabled","isOwnerChanged","jwtHeaderChanged","hostMenuItemsChanged","hostToolbarItemsChanged","hostHideSidebarNavChanged","sidebarChevronDownshiftChanged","pageLinkBaseUrlChanged","queryParamsChanged","deployedAppMetadataChanged","restartWebsocketConnection","terminateWebsocketConnection","location","hash","spyOn","setAllowedOrigins","allowedOrigins","useExternalAuthToken","afterEach","it","expect","toHaveBeenCalledWith","toEqual","MessageEvent","data","stCommVersion","origin","props","pageScriptHash","disabled","isOwner","items","metadata","hostedAt","owner","repo","pageLinkBaseUrl","sidebarChevronDownshift","hidden","borderless","label","icon","key","queryParams","mockCustomThemeConfig","primaryColor","backgroundColor","secondaryBackgroundColor","textColor","widgetBackgroundColor","widgetBorderColor","skeletonBackgroundColor","themeInfo","undefined","themeName","message","jwtHeaderName","jwtHeaderValue","toHaveBeenCalled","deferredAuthToken","promise","resolves","toBe","setTimeout","authToken","resetAuthToken"],"sources":["../../src/hostComm/HostCommunicationManager.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport HostCommunicationManager, {\n  HOST_COMM_VERSION,\n} from \"@streamlit/lib/src/hostComm/HostCommunicationManager\"\n\n// Mocking \"message\" event listeners on the window;\n// returns function to establish a listener\nfunction mockEventListeners(): (type: string, event: any) => void {\n  const listeners: { [name: string]: ((event: Event) => void)[] } = {}\n\n  window.addEventListener = jest.fn((event: string, cb: any) => {\n    listeners[event] = listeners[event] || []\n    listeners[event].push(cb)\n  })\n\n  return (type: string, event: Event): void =>\n    listeners[type].forEach(cb => cb(event))\n}\n\ndescribe(\"HostCommunicationManager messaging\", () => {\n  let hostCommunicationMgr: HostCommunicationManager\n\n  let dispatchEvent: (type: string, event: Event) => void\n  let originalHash: string\n\n  let setAllowedOriginsFunc: jest.SpyInstance\n  let openCommFunc: jest.SpyInstance\n  let sendMessageToHostFunc: jest.SpyInstance\n\n  beforeEach(() => {\n    hostCommunicationMgr = new HostCommunicationManager({\n      themeChanged: jest.fn(),\n      sendRerunBackMsg: jest.fn(),\n      pageChanged: jest.fn(),\n      closeModal: jest.fn(),\n      stopScript: jest.fn(),\n      rerunScript: jest.fn(),\n      clearCache: jest.fn(),\n      sendAppHeartbeat: jest.fn(),\n      setInputsDisabled: jest.fn(),\n      isOwnerChanged: jest.fn(),\n      jwtHeaderChanged: jest.fn(),\n      hostMenuItemsChanged: jest.fn(),\n      hostToolbarItemsChanged: jest.fn(),\n      hostHideSidebarNavChanged: jest.fn(),\n      sidebarChevronDownshiftChanged: jest.fn(),\n      pageLinkBaseUrlChanged: jest.fn(),\n      queryParamsChanged: jest.fn(),\n      deployedAppMetadataChanged: jest.fn(),\n      restartWebsocketConnection: jest.fn(),\n      terminateWebsocketConnection: jest.fn(),\n    })\n\n    originalHash = window.location.hash\n    dispatchEvent = mockEventListeners()\n\n    setAllowedOriginsFunc = jest.spyOn(\n      hostCommunicationMgr,\n      \"setAllowedOrigins\"\n    )\n    openCommFunc = jest.spyOn(hostCommunicationMgr, \"openHostCommunication\")\n    sendMessageToHostFunc = jest.spyOn(\n      hostCommunicationMgr,\n      \"sendMessageToHost\"\n    )\n\n    hostCommunicationMgr.setAllowedOrigins({\n      allowedOrigins: [\"https://devel.streamlit.test\"],\n      useExternalAuthToken: false,\n    })\n  })\n\n  afterEach(() => {\n    window.location.hash = originalHash\n  })\n\n  it(\"sets allowedOrigins properly & opens HostCommunication\", () => {\n    expect(setAllowedOriginsFunc).toHaveBeenCalledWith({\n      allowedOrigins: [\"https://devel.streamlit.test\"],\n      useExternalAuthToken: false,\n    })\n    // @ts-expect-error\n    expect(hostCommunicationMgr.allowedOrigins).toEqual([\n      \"https://devel.streamlit.test\",\n    ])\n    expect(openCommFunc).toHaveBeenCalledWith()\n  })\n\n  it(\"host should receive a GUEST_READY message\", () => {\n    expect(sendMessageToHostFunc).toHaveBeenCalledWith({ type: \"GUEST_READY\" })\n  })\n\n  it(\"can process a received CLOSE_MODAL message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"CLOSE_MODAL\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.closeModal).toHaveBeenCalledWith()\n  })\n\n  it(\"can process a received STOP_SCRIPT message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"STOP_SCRIPT\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.stopScript).toHaveBeenCalledWith()\n  })\n\n  it(\"can process a received RERUN_SCRIPT message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"RERUN_SCRIPT\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.rerunScript).toHaveBeenCalledWith()\n  })\n\n  it(\"can process a received CLEAR_CACHE message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"CLEAR_CACHE\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.clearCache).toHaveBeenCalledWith()\n  })\n\n  it(\"can process a received REQUEST_PAGE_CHANGE message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"REQUEST_PAGE_CHANGE\",\n          pageScriptHash: \"hash1\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.pageChanged).toHaveBeenCalledWith(\n      \"hash1\"\n    )\n  })\n\n  it(\"can process a received SEND_APP_HEARTBEAT message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SEND_APP_HEARTBEAT\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.sendAppHeartbeat).toHaveBeenCalledWith()\n  })\n\n  it(\"can process a received SET_INPUTS_DISABLED message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_INPUTS_DISABLED\",\n          disabled: true,\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.setInputsDisabled).toHaveBeenCalledWith(\n      true\n    )\n  })\n\n  it(\"should respond to SET_IS_OWNER message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_IS_OWNER\",\n          isOwner: true,\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.isOwnerChanged).toHaveBeenCalledWith(\n      true\n    )\n  })\n\n  it(\"should respond to SET_MENU_ITEMS message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_MENU_ITEMS\",\n          items: [{ type: \"separator\" }],\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.hostMenuItemsChanged\n    ).toHaveBeenCalledWith([{ type: \"separator\" }])\n  })\n\n  it(\"should respond to SET_METADATA message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_METADATA\",\n          metadata: { hostedAt: \"maya\", owner: \"corgi\", repo: \"streamlit\" },\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.deployedAppMetadataChanged\n    ).toHaveBeenCalledWith({\n      hostedAt: \"maya\",\n      owner: \"corgi\",\n      repo: \"streamlit\",\n    })\n  })\n\n  it(\"can process a received SET_PAGE_LINK_BASE_URL message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_PAGE_LINK_BASE_URL\",\n          pageLinkBaseUrl: \"https://share.streamlit.io/vdonato/foo/bar\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.pageLinkBaseUrlChanged\n    ).toHaveBeenCalledWith(\"https://share.streamlit.io/vdonato/foo/bar\")\n  })\n\n  it(\"can process a received SET_SIDEBAR_CHEVRON_DOWNSHIFT message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_SIDEBAR_CHEVRON_DOWNSHIFT\",\n          sidebarChevronDownshift: 50,\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.sidebarChevronDownshiftChanged\n    ).toHaveBeenCalledWith(50)\n  })\n\n  it(\"can process a received SET_SIDEBAR_NAV_VISIBILITY message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_SIDEBAR_NAV_VISIBILITY\",\n          hidden: true,\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.hostHideSidebarNavChanged\n    ).toHaveBeenCalledWith(true)\n  })\n\n  it(\"can process a received SET_TOOLBAR_ITEMS message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_TOOLBAR_ITEMS\",\n          items: [\n            {\n              borderless: true,\n              label: \"\",\n              icon: \"star.svg\",\n              key: \"favorite\",\n            },\n          ],\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.hostToolbarItemsChanged\n    ).toHaveBeenCalledWith([\n      {\n        borderless: true,\n        icon: \"star.svg\",\n        key: \"favorite\",\n        label: \"\",\n      },\n    ])\n  })\n\n  it(\"should respond to UPDATE_HASH message\", () => {\n    expect(window.location.hash).toEqual(\"\")\n\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"UPDATE_HASH\",\n          hash: \"#somehash\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(window.location.hash).toEqual(\"#somehash\")\n  })\n\n  it(\"can process a received UPDATE_FROM_QUERY_PARAMS message\", () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"UPDATE_FROM_QUERY_PARAMS\",\n          queryParams: \"foo=bar\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.queryParamsChanged).toHaveBeenCalledWith(\n      \"foo=bar\"\n    )\n    // @ts-expect-error - props are private\n    expect(hostCommunicationMgr.props.sendRerunBackMsg).toHaveBeenCalledWith()\n  })\n\n  it(\"can process a received SET_CUSTOM_THEME_CONFIG message\", async () => {\n    const mockCustomThemeConfig = {\n      primaryColor: \"#1A6CE7\",\n      backgroundColor: \"#FFFFFF\",\n      secondaryBackgroundColor: \"#F5F5F5\",\n      textColor: \"#1A1D21\",\n      widgetBackgroundColor: \"#FFFFFF\",\n      widgetBorderColor: \"#D3DAE8\",\n      skeletonBackgroundColor: \"#CCDDEE\",\n    }\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_CUSTOM_THEME_CONFIG\",\n          themeInfo: mockCustomThemeConfig,\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.themeChanged\n    ).toHaveBeenCalledWith(undefined, mockCustomThemeConfig)\n  })\n\n  it(\"can process a received SET_CUSTOM_THEME_CONFIG message with a dark theme name\", async () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_CUSTOM_THEME_CONFIG\",\n          themeName: \"Dark\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.themeChanged\n    ).toHaveBeenCalledWith(\"Dark\", undefined)\n  })\n\n  it(\"can process a received SET_CUSTOM_THEME_CONFIG message with a light theme name\", async () => {\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"SET_CUSTOM_THEME_CONFIG\",\n          themeName: \"Light\",\n        },\n        origin: \"https://devel.streamlit.test\",\n      })\n    )\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.themeChanged\n    ).toHaveBeenCalledWith(\"Light\", undefined)\n  })\n\n  it(\"can process a received SET_AUTH_TOKEN message with JWT pair\", () => {\n    const message = new MessageEvent(\"message\", {\n      data: {\n        stCommVersion: HOST_COMM_VERSION,\n        type: \"SET_AUTH_TOKEN\",\n        jwtHeaderName: \"X-JWT-HEADER-NAME\",\n        jwtHeaderValue: \"X-JWT-HEADER-VALUE\",\n      },\n      origin: \"https://devel.streamlit.test\",\n    })\n    dispatchEvent(\"message\", message)\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.jwtHeaderChanged\n    ).toHaveBeenCalledWith(message.data)\n  })\n\n  it(\"can process a received RESTART_WEBSOCKET_CONNECTION message\", () => {\n    const message = new MessageEvent(\"message\", {\n      data: {\n        stCommVersion: HOST_COMM_VERSION,\n        type: \"RESTART_WEBSOCKET_CONNECTION\",\n      },\n      origin: \"https://devel.streamlit.test\",\n    })\n    dispatchEvent(\"message\", message)\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.restartWebsocketConnection\n    ).toHaveBeenCalled()\n  })\n\n  it(\"can process a received TERMINATE_WEBSOCKET_CONNECTION message\", () => {\n    const message = new MessageEvent(\"message\", {\n      data: {\n        stCommVersion: HOST_COMM_VERSION,\n        type: \"TERMINATE_WEBSOCKET_CONNECTION\",\n      },\n      origin: \"https://devel.streamlit.test\",\n    })\n    dispatchEvent(\"message\", message)\n\n    expect(\n      // @ts-expect-error - props are private\n      hostCommunicationMgr.props.terminateWebsocketConnection\n    ).toHaveBeenCalled()\n  })\n})\n\ndescribe(\"Test different origins\", () => {\n  let hostCommunicationMgr: HostCommunicationManager\n  let dispatchEvent: any\n\n  beforeEach(() => {\n    hostCommunicationMgr = new HostCommunicationManager({\n      themeChanged: jest.fn(),\n      sendRerunBackMsg: jest.fn(),\n      pageChanged: jest.fn(),\n      closeModal: jest.fn(),\n      stopScript: jest.fn(),\n      rerunScript: jest.fn(),\n      clearCache: jest.fn(),\n      sendAppHeartbeat: jest.fn(),\n      setInputsDisabled: jest.fn(),\n      jwtHeaderChanged: jest.fn(),\n      isOwnerChanged: jest.fn(),\n      hostMenuItemsChanged: jest.fn(),\n      hostToolbarItemsChanged: jest.fn(),\n      hostHideSidebarNavChanged: jest.fn(),\n      sidebarChevronDownshiftChanged: jest.fn(),\n      pageLinkBaseUrlChanged: jest.fn(),\n      queryParamsChanged: jest.fn(),\n      deployedAppMetadataChanged: jest.fn(),\n      restartWebsocketConnection: jest.fn(),\n      terminateWebsocketConnection: jest.fn(),\n    })\n\n    dispatchEvent = mockEventListeners()\n  })\n\n  afterEach(() => {\n    window.location.hash = \"\"\n  })\n\n  it(\"exact pattern\", () => {\n    hostCommunicationMgr.setAllowedOrigins({\n      allowedOrigins: [\"http://share.streamlit.io\"],\n      useExternalAuthToken: false,\n    })\n\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"UPDATE_HASH\",\n          hash: \"#somehash\",\n        },\n        origin: \"http://share.streamlit.io\",\n      })\n    )\n\n    expect(window.location.hash).toEqual(\"#somehash\")\n  })\n\n  it(\"wildcard pattern\", () => {\n    hostCommunicationMgr.setAllowedOrigins({\n      allowedOrigins: [\"http://*.streamlitapp.com\"],\n      useExternalAuthToken: false,\n    })\n\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"UPDATE_HASH\",\n          hash: \"#otherhash\",\n        },\n        origin: \"http://cool-cucumber-fa9ds9f.streamlitapp.com\",\n      })\n    )\n\n    expect(window.location.hash).toEqual(\"#otherhash\")\n  })\n\n  it(\"ignores non-matching origins\", () => {\n    hostCommunicationMgr.setAllowedOrigins({\n      allowedOrigins: [\"http://share.streamlit.io\"],\n      useExternalAuthToken: false,\n    })\n\n    dispatchEvent(\n      \"message\",\n      new MessageEvent(\"message\", {\n        data: {\n          stCommVersion: HOST_COMM_VERSION,\n          type: \"UPDATE_HASH\",\n          hash: \"#corgi\",\n        },\n        origin: \"http://example.com\",\n      })\n    )\n\n    expect(window.location.hash).toEqual(\"\")\n  })\n})\n\ndescribe(\"HostCommunicationManager external auth token handling\", () => {\n  let hostCommunicationMgr: HostCommunicationManager\n\n  beforeEach(() => {\n    hostCommunicationMgr = new HostCommunicationManager({\n      themeChanged: jest.fn(),\n      sendRerunBackMsg: jest.fn(),\n      pageChanged: jest.fn(),\n      closeModal: jest.fn(),\n      stopScript: jest.fn(),\n      rerunScript: jest.fn(),\n      clearCache: jest.fn(),\n      sendAppHeartbeat: jest.fn(),\n      setInputsDisabled: jest.fn(),\n      jwtHeaderChanged: jest.fn(),\n      isOwnerChanged: jest.fn(),\n      hostMenuItemsChanged: jest.fn(),\n      hostToolbarItemsChanged: jest.fn(),\n      hostHideSidebarNavChanged: jest.fn(),\n      sidebarChevronDownshiftChanged: jest.fn(),\n      pageLinkBaseUrlChanged: jest.fn(),\n      queryParamsChanged: jest.fn(),\n      deployedAppMetadataChanged: jest.fn(),\n      restartWebsocketConnection: jest.fn(),\n      terminateWebsocketConnection: jest.fn(),\n    })\n  })\n\n  it(\"resolves promise to undefined immediately if useExternalAuthToken is false\", async () => {\n    const setAllowedOriginsFunc = jest.spyOn(\n      hostCommunicationMgr,\n      \"setAllowedOrigins\"\n    )\n\n    hostCommunicationMgr.setAllowedOrigins({\n      allowedOrigins: [\"http://devel.streamlit.test\"],\n      useExternalAuthToken: false,\n    })\n\n    expect(setAllowedOriginsFunc).toHaveBeenCalled()\n    // @ts-expect-error - deferredAuthToken is private\n    await expect(hostCommunicationMgr.deferredAuthToken.promise).resolves.toBe(\n      undefined\n    )\n  })\n\n  it(\"waits to receive SET_AUTH_TOKEN message before resolving promise if useExternalAuthToken is true\", async () => {\n    const dispatchEvent = mockEventListeners()\n\n    hostCommunicationMgr.setAllowedOrigins({\n      allowedOrigins: [\"http://devel.streamlit.test\"],\n      useExternalAuthToken: true,\n    })\n    // Asynchronously send a SET_AUTH_TOKEN message to the\n    // HostCommunicationManager, which won't proceed past the `await`\n    // statement below until the message is received and handled.\n    setTimeout(() => {\n      dispatchEvent(\n        \"message\",\n        new MessageEvent(\"message\", {\n          data: {\n            stCommVersion: HOST_COMM_VERSION,\n            type: \"SET_AUTH_TOKEN\",\n            authToken: \"i am an auth token\",\n          },\n          origin: \"http://devel.streamlit.test\",\n        })\n      )\n    })\n\n    // @ts-expect-error - deferredAuthToken is private\n    await expect(hostCommunicationMgr.deferredAuthToken.promise).resolves.toBe(\n      \"i am an auth token\"\n    )\n\n    // Reset the auth token and do everything again to confirm that we don't\n    // incorrectly resolve to an old value after resetAuthToken is called.\n    hostCommunicationMgr.resetAuthToken()\n\n    // Simulate the browser tab disconnecting and reconnecting, which from the\n    // HostCommunication's perspective is only seen as a new call to\n    // setAllowedOrigins.\n    hostCommunicationMgr.setAllowedOrigins({\n      allowedOrigins: [\"http://devel.streamlit.test\"],\n      useExternalAuthToken: true,\n    })\n\n    setTimeout(() => {\n      dispatchEvent(\n        \"message\",\n        new MessageEvent(\"message\", {\n          data: {\n            stCommVersion: HOST_COMM_VERSION,\n            type: \"SET_AUTH_TOKEN\",\n            authToken: \"i am a NEW auth token\",\n          },\n          origin: \"http://devel.streamlit.test\",\n        })\n      )\n    })\n\n    // @ts-expect-error - deferredAuthToken is private\n    await expect(hostCommunicationMgr.deferredAuthToken.promise).resolves.toBe(\n      \"i am a NEW auth token\"\n    )\n  })\n})\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,wBAAwB,IAC7BC,iBAAiB;;AAGnB;AACA;AACA,SAASC,kBAAkBA,CAAA,EAAuC;EAChE,MAAMC,SAAyD,GAAG,CAAC,CAAC;EAEpEC,MAAM,CAACC,gBAAgB,GAAGC,IAAI,CAACC,EAAE,CAAC,CAACC,KAAa,EAAEC,EAAO,KAAK;IAC5DN,SAAS,CAACK,KAAK,CAAC,GAAGL,SAAS,CAACK,KAAK,CAAC,IAAI,EAAE;IACzCL,SAAS,CAACK,KAAK,CAAC,CAACE,IAAI,CAACD,EAAE,CAAC;EAC3B,CAAC,CAAC;EAEF,OAAO,CAACE,IAAY,EAAEH,KAAY,KAChCL,SAAS,CAACQ,IAAI,CAAC,CAACC,OAAO,CAACH,EAAE,IAAIA,EAAE,CAACD,KAAK,CAAC,CAAC;AAC5C;AAEAK,QAAQ,CAAC,oCAAoC,EAAE,MAAM;EACnD,IAAIC,oBAA8C;EAElD,IAAIC,aAAmD;EACvD,IAAIC,YAAoB;EAExB,IAAIC,qBAAuC;EAC3C,IAAIC,YAA8B;EAClC,IAAIC,qBAAuC;EAE3CC,UAAU,CAAC,MAAM;IACfN,oBAAoB,GAAG,IAAId,wBAAwB,CAAC;MAClDqB,YAAY,EAAEf,IAAI,CAACC,EAAE,CAAC,CAAC;MACvBe,gBAAgB,EAAEhB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3BgB,WAAW,EAAEjB,IAAI,CAACC,EAAE,CAAC,CAAC;MACtBiB,UAAU,EAAElB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBkB,UAAU,EAAEnB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBmB,WAAW,EAAEpB,IAAI,CAACC,EAAE,CAAC,CAAC;MACtBoB,UAAU,EAAErB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBqB,gBAAgB,EAAEtB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3BsB,iBAAiB,EAAEvB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC5BuB,cAAc,EAAExB,IAAI,CAACC,EAAE,CAAC,CAAC;MACzBwB,gBAAgB,EAAEzB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3ByB,oBAAoB,EAAE1B,IAAI,CAACC,EAAE,CAAC,CAAC;MAC/B0B,uBAAuB,EAAE3B,IAAI,CAACC,EAAE,CAAC,CAAC;MAClC2B,yBAAyB,EAAE5B,IAAI,CAACC,EAAE,CAAC,CAAC;MACpC4B,8BAA8B,EAAE7B,IAAI,CAACC,EAAE,CAAC,CAAC;MACzC6B,sBAAsB,EAAE9B,IAAI,CAACC,EAAE,CAAC,CAAC;MACjC8B,kBAAkB,EAAE/B,IAAI,CAACC,EAAE,CAAC,CAAC;MAC7B+B,0BAA0B,EAAEhC,IAAI,CAACC,EAAE,CAAC,CAAC;MACrCgC,0BAA0B,EAAEjC,IAAI,CAACC,EAAE,CAAC,CAAC;MACrCiC,4BAA4B,EAAElC,IAAI,CAACC,EAAE,CAAC;IACxC,CAAC,CAAC;IAEFS,YAAY,GAAGZ,MAAM,CAACqC,QAAQ,CAACC,IAAI;IACnC3B,aAAa,GAAGb,kBAAkB,CAAC,CAAC;IAEpCe,qBAAqB,GAAGX,IAAI,CAACqC,KAAK,CAChC7B,oBAAoB,EACpB,mBACF,CAAC;IACDI,YAAY,GAAGZ,IAAI,CAACqC,KAAK,CAAC7B,oBAAoB,EAAE,uBAAuB,CAAC;IACxEK,qBAAqB,GAAGb,IAAI,CAACqC,KAAK,CAChC7B,oBAAoB,EACpB,mBACF,CAAC;IAEDA,oBAAoB,CAAC8B,iBAAiB,CAAC;MACrCC,cAAc,EAAE,CAAC,8BAA8B,CAAC;MAChDC,oBAAoB,EAAE;IACxB,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFC,SAAS,CAAC,MAAM;IACd3C,MAAM,CAACqC,QAAQ,CAACC,IAAI,GAAG1B,YAAY;EACrC,CAAC,CAAC;EAEFgC,EAAE,CAAC,wDAAwD,EAAE,MAAM;IACjEC,MAAM,CAAChC,qBAAqB,CAAC,CAACiC,oBAAoB,CAAC;MACjDL,cAAc,EAAE,CAAC,8BAA8B,CAAC;MAChDC,oBAAoB,EAAE;IACxB,CAAC,CAAC;IACF;IACAG,MAAM,CAACnC,oBAAoB,CAAC+B,cAAc,CAAC,CAACM,OAAO,CAAC,CAClD,8BAA8B,CAC/B,CAAC;IACFF,MAAM,CAAC/B,YAAY,CAAC,CAACgC,oBAAoB,CAAC,CAAC;EAC7C,CAAC,CAAC;EAEFF,EAAE,CAAC,2CAA2C,EAAE,MAAM;IACpDC,MAAM,CAAC9B,qBAAqB,CAAC,CAAC+B,oBAAoB,CAAC;MAAEvC,IAAI,EAAE;IAAc,CAAC,CAAC;EAC7E,CAAC,CAAC;EAEFqC,EAAE,CAAC,4CAA4C,EAAE,MAAM;IACrDjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE;MACR,CAAC;MACD4C,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IACD;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAAChC,UAAU,CAAC,CAAC0B,oBAAoB,CAAC,CAAC;EACtE,CAAC,CAAC;EAEFF,EAAE,CAAC,4CAA4C,EAAE,MAAM;IACrDjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE;MACR,CAAC;MACD4C,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IACD;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAAC/B,UAAU,CAAC,CAACyB,oBAAoB,CAAC,CAAC;EACtE,CAAC,CAAC;EAEFF,EAAE,CAAC,6CAA6C,EAAE,MAAM;IACtDjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE;MACR,CAAC;MACD4C,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IACD;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAAC9B,WAAW,CAAC,CAACwB,oBAAoB,CAAC,CAAC;EACvE,CAAC,CAAC;EAEFF,EAAE,CAAC,4CAA4C,EAAE,MAAM;IACrDjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE;MACR,CAAC;MACD4C,MAAM,EAAE;IACV,CAAC,CACH,CAAC;;IAED;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAAC7B,UAAU,CAAC,CAACuB,oBAAoB,CAAC,CAAC;EACtE,CAAC,CAAC;EAEFF,EAAE,CAAC,oDAAoD,EAAE,MAAM;IAC7DjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,qBAAqB;QAC3B8C,cAAc,EAAE;MAClB,CAAC;MACDF,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IACD;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAACjC,WAAW,CAAC,CAAC2B,oBAAoB,CACjE,OACF,CAAC;EACH,CAAC,CAAC;EAEFF,EAAE,CAAC,mDAAmD,EAAE,MAAM;IAC5DjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE;MACR,CAAC;MACD4C,MAAM,EAAE;IACV,CAAC,CACH,CAAC;;IAED;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAAC5B,gBAAgB,CAAC,CAACsB,oBAAoB,CAAC,CAAC;EAC5E,CAAC,CAAC;EAEFF,EAAE,CAAC,oDAAoD,EAAE,MAAM;IAC7DjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,qBAAqB;QAC3B+C,QAAQ,EAAE;MACZ,CAAC;MACDH,MAAM,EAAE;IACV,CAAC,CACH,CAAC;;IAED;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAAC3B,iBAAiB,CAAC,CAACqB,oBAAoB,CACvE,IACF,CAAC;EACH,CAAC,CAAC;EAEFF,EAAE,CAAC,wCAAwC,EAAE,MAAM;IACjDjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,cAAc;QACpBgD,OAAO,EAAE;MACX,CAAC;MACDJ,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IACD;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAAC1B,cAAc,CAAC,CAACoB,oBAAoB,CACpE,IACF,CAAC;EACH,CAAC,CAAC;EAEFF,EAAE,CAAC,0CAA0C,EAAE,MAAM;IACnDjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,gBAAgB;QACtBiD,KAAK,EAAE,CAAC;UAAEjD,IAAI,EAAE;QAAY,CAAC;MAC/B,CAAC;MACD4C,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACxB,oBAC7B,CAAC,CAACkB,oBAAoB,CAAC,CAAC;MAAEvC,IAAI,EAAE;IAAY,CAAC,CAAC,CAAC;EACjD,CAAC,CAAC;EAEFqC,EAAE,CAAC,wCAAwC,EAAE,MAAM;IACjDjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,cAAc;QACpBkD,QAAQ,EAAE;UAAEC,QAAQ,EAAE,MAAM;UAAEC,KAAK,EAAE,OAAO;UAAEC,IAAI,EAAE;QAAY;MAClE,CAAC;MACDT,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAAClB,0BAC7B,CAAC,CAACY,oBAAoB,CAAC;MACrBY,QAAQ,EAAE,MAAM;MAChBC,KAAK,EAAE,OAAO;MACdC,IAAI,EAAE;IACR,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFhB,EAAE,CAAC,uDAAuD,EAAE,MAAM;IAChEjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,wBAAwB;QAC9BsD,eAAe,EAAE;MACnB,CAAC;MACDV,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACpB,sBAC7B,CAAC,CAACc,oBAAoB,CAAC,4CAA4C,CAAC;EACtE,CAAC,CAAC;EAEFF,EAAE,CAAC,8DAA8D,EAAE,MAAM;IACvEjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,+BAA+B;QACrCuD,uBAAuB,EAAE;MAC3B,CAAC;MACDX,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACrB,8BAC7B,CAAC,CAACe,oBAAoB,CAAC,EAAE,CAAC;EAC5B,CAAC,CAAC;EAEFF,EAAE,CAAC,2DAA2D,EAAE,MAAM;IACpEjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,4BAA4B;QAClCwD,MAAM,EAAE;MACV,CAAC;MACDZ,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACtB,yBAC7B,CAAC,CAACgB,oBAAoB,CAAC,IAAI,CAAC;EAC9B,CAAC,CAAC;EAEFF,EAAE,CAAC,kDAAkD,EAAE,MAAM;IAC3DjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,mBAAmB;QACzBiD,KAAK,EAAE,CACL;UACEQ,UAAU,EAAE,IAAI;UAChBC,KAAK,EAAE,EAAE;UACTC,IAAI,EAAE,UAAU;UAChBC,GAAG,EAAE;QACP,CAAC;MAEL,CAAC;MACDhB,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACvB,uBAC7B,CAAC,CAACiB,oBAAoB,CAAC,CACrB;MACEkB,UAAU,EAAE,IAAI;MAChBE,IAAI,EAAE,UAAU;MAChBC,GAAG,EAAE,UAAU;MACfF,KAAK,EAAE;IACT,CAAC,CACF,CAAC;EACJ,CAAC,CAAC;EAEFrB,EAAE,CAAC,uCAAuC,EAAE,MAAM;IAChDC,MAAM,CAAC7C,MAAM,CAACqC,QAAQ,CAACC,IAAI,CAAC,CAACS,OAAO,CAAC,EAAE,CAAC;IAExCpC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,aAAa;QACnB+B,IAAI,EAAE;MACR,CAAC;MACDa,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM,CAAC7C,MAAM,CAACqC,QAAQ,CAACC,IAAI,CAAC,CAACS,OAAO,CAAC,WAAW,CAAC;EACnD,CAAC,CAAC;EAEFH,EAAE,CAAC,yDAAyD,EAAE,MAAM;IAClEjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,0BAA0B;QAChC6D,WAAW,EAAE;MACf,CAAC;MACDjB,MAAM,EAAE;IACV,CAAC,CACH,CAAC;;IAED;IACAN,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAACnB,kBAAkB,CAAC,CAACa,oBAAoB,CACxE,SACF,CAAC;IACD;IACAD,MAAM,CAACnC,oBAAoB,CAAC0C,KAAK,CAAClC,gBAAgB,CAAC,CAAC4B,oBAAoB,CAAC,CAAC;EAC5E,CAAC,CAAC;EAEFF,EAAE,CAAC,wDAAwD,EAAE,YAAY;IACvE,MAAMyB,qBAAqB,GAAG;MAC5BC,YAAY,EAAE,SAAS;MACvBC,eAAe,EAAE,SAAS;MAC1BC,wBAAwB,EAAE,SAAS;MACnCC,SAAS,EAAE,SAAS;MACpBC,qBAAqB,EAAE,SAAS;MAChCC,iBAAiB,EAAE,SAAS;MAC5BC,uBAAuB,EAAE;IAC3B,CAAC;IACDjE,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,yBAAyB;QAC/BsE,SAAS,EAAER;MACb,CAAC;MACDlB,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACnC,YAC7B,CAAC,CAAC6B,oBAAoB,CAACgC,SAAS,EAAET,qBAAqB,CAAC;EAC1D,CAAC,CAAC;EAEFzB,EAAE,CAAC,+EAA+E,EAAE,YAAY;IAC9FjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,yBAAyB;QAC/BwE,SAAS,EAAE;MACb,CAAC;MACD5B,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACnC,YAC7B,CAAC,CAAC6B,oBAAoB,CAAC,MAAM,EAAEgC,SAAS,CAAC;EAC3C,CAAC,CAAC;EAEFlC,EAAE,CAAC,gFAAgF,EAAE,YAAY;IAC/FjC,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,yBAAyB;QAC/BwE,SAAS,EAAE;MACb,CAAC;MACD5B,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACnC,YAC7B,CAAC,CAAC6B,oBAAoB,CAAC,OAAO,EAAEgC,SAAS,CAAC;EAC5C,CAAC,CAAC;EAEFlC,EAAE,CAAC,6DAA6D,EAAE,MAAM;IACtE,MAAMoC,OAAO,GAAG,IAAIhC,YAAY,CAAC,SAAS,EAAE;MAC1CC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,gBAAgB;QACtB0E,aAAa,EAAE,mBAAmB;QAClCC,cAAc,EAAE;MAClB,CAAC;MACD/B,MAAM,EAAE;IACV,CAAC,CAAC;IACFxC,aAAa,CAAC,SAAS,EAAEqE,OAAO,CAAC;IAEjCnC,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACzB,gBAC7B,CAAC,CAACmB,oBAAoB,CAACkC,OAAO,CAAC/B,IAAI,CAAC;EACtC,CAAC,CAAC;EAEFL,EAAE,CAAC,6DAA6D,EAAE,MAAM;IACtE,MAAMoC,OAAO,GAAG,IAAIhC,YAAY,CAAC,SAAS,EAAE;MAC1CC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE;MACR,CAAC;MACD4C,MAAM,EAAE;IACV,CAAC,CAAC;IACFxC,aAAa,CAAC,SAAS,EAAEqE,OAAO,CAAC;IAEjCnC,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAACjB,0BAC7B,CAAC,CAACgD,gBAAgB,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFvC,EAAE,CAAC,+DAA+D,EAAE,MAAM;IACxE,MAAMoC,OAAO,GAAG,IAAIhC,YAAY,CAAC,SAAS,EAAE;MAC1CC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE;MACR,CAAC;MACD4C,MAAM,EAAE;IACV,CAAC,CAAC;IACFxC,aAAa,CAAC,SAAS,EAAEqE,OAAO,CAAC;IAEjCnC,MAAM;IACJ;IACAnC,oBAAoB,CAAC0C,KAAK,CAAChB,4BAC7B,CAAC,CAAC+C,gBAAgB,CAAC,CAAC;EACtB,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF1E,QAAQ,CAAC,wBAAwB,EAAE,MAAM;EACvC,IAAIC,oBAA8C;EAClD,IAAIC,aAAkB;EAEtBK,UAAU,CAAC,MAAM;IACfN,oBAAoB,GAAG,IAAId,wBAAwB,CAAC;MAClDqB,YAAY,EAAEf,IAAI,CAACC,EAAE,CAAC,CAAC;MACvBe,gBAAgB,EAAEhB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3BgB,WAAW,EAAEjB,IAAI,CAACC,EAAE,CAAC,CAAC;MACtBiB,UAAU,EAAElB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBkB,UAAU,EAAEnB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBmB,WAAW,EAAEpB,IAAI,CAACC,EAAE,CAAC,CAAC;MACtBoB,UAAU,EAAErB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBqB,gBAAgB,EAAEtB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3BsB,iBAAiB,EAAEvB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC5BwB,gBAAgB,EAAEzB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3BuB,cAAc,EAAExB,IAAI,CAACC,EAAE,CAAC,CAAC;MACzByB,oBAAoB,EAAE1B,IAAI,CAACC,EAAE,CAAC,CAAC;MAC/B0B,uBAAuB,EAAE3B,IAAI,CAACC,EAAE,CAAC,CAAC;MAClC2B,yBAAyB,EAAE5B,IAAI,CAACC,EAAE,CAAC,CAAC;MACpC4B,8BAA8B,EAAE7B,IAAI,CAACC,EAAE,CAAC,CAAC;MACzC6B,sBAAsB,EAAE9B,IAAI,CAACC,EAAE,CAAC,CAAC;MACjC8B,kBAAkB,EAAE/B,IAAI,CAACC,EAAE,CAAC,CAAC;MAC7B+B,0BAA0B,EAAEhC,IAAI,CAACC,EAAE,CAAC,CAAC;MACrCgC,0BAA0B,EAAEjC,IAAI,CAACC,EAAE,CAAC,CAAC;MACrCiC,4BAA4B,EAAElC,IAAI,CAACC,EAAE,CAAC;IACxC,CAAC,CAAC;IAEFQ,aAAa,GAAGb,kBAAkB,CAAC,CAAC;EACtC,CAAC,CAAC;EAEF6C,SAAS,CAAC,MAAM;IACd3C,MAAM,CAACqC,QAAQ,CAACC,IAAI,GAAG,EAAE;EAC3B,CAAC,CAAC;EAEFM,EAAE,CAAC,eAAe,EAAE,MAAM;IACxBlC,oBAAoB,CAAC8B,iBAAiB,CAAC;MACrCC,cAAc,EAAE,CAAC,2BAA2B,CAAC;MAC7CC,oBAAoB,EAAE;IACxB,CAAC,CAAC;IAEF/B,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,aAAa;QACnB+B,IAAI,EAAE;MACR,CAAC;MACDa,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM,CAAC7C,MAAM,CAACqC,QAAQ,CAACC,IAAI,CAAC,CAACS,OAAO,CAAC,WAAW,CAAC;EACnD,CAAC,CAAC;EAEFH,EAAE,CAAC,kBAAkB,EAAE,MAAM;IAC3BlC,oBAAoB,CAAC8B,iBAAiB,CAAC;MACrCC,cAAc,EAAE,CAAC,2BAA2B,CAAC;MAC7CC,oBAAoB,EAAE;IACxB,CAAC,CAAC;IAEF/B,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,aAAa;QACnB+B,IAAI,EAAE;MACR,CAAC;MACDa,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM,CAAC7C,MAAM,CAACqC,QAAQ,CAACC,IAAI,CAAC,CAACS,OAAO,CAAC,YAAY,CAAC;EACpD,CAAC,CAAC;EAEFH,EAAE,CAAC,8BAA8B,EAAE,MAAM;IACvClC,oBAAoB,CAAC8B,iBAAiB,CAAC;MACrCC,cAAc,EAAE,CAAC,2BAA2B,CAAC;MAC7CC,oBAAoB,EAAE;IACxB,CAAC,CAAC;IAEF/B,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;MAC1BC,IAAI,EAAE;QACJC,aAAa,EAAErD,iBAAiB;QAChCU,IAAI,EAAE,aAAa;QACnB+B,IAAI,EAAE;MACR,CAAC;MACDa,MAAM,EAAE;IACV,CAAC,CACH,CAAC;IAEDN,MAAM,CAAC7C,MAAM,CAACqC,QAAQ,CAACC,IAAI,CAAC,CAACS,OAAO,CAAC,EAAE,CAAC;EAC1C,CAAC,CAAC;AACJ,CAAC,CAAC;AAEFtC,QAAQ,CAAC,uDAAuD,EAAE,MAAM;EACtE,IAAIC,oBAA8C;EAElDM,UAAU,CAAC,MAAM;IACfN,oBAAoB,GAAG,IAAId,wBAAwB,CAAC;MAClDqB,YAAY,EAAEf,IAAI,CAACC,EAAE,CAAC,CAAC;MACvBe,gBAAgB,EAAEhB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3BgB,WAAW,EAAEjB,IAAI,CAACC,EAAE,CAAC,CAAC;MACtBiB,UAAU,EAAElB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBkB,UAAU,EAAEnB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBmB,WAAW,EAAEpB,IAAI,CAACC,EAAE,CAAC,CAAC;MACtBoB,UAAU,EAAErB,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBqB,gBAAgB,EAAEtB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3BsB,iBAAiB,EAAEvB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC5BwB,gBAAgB,EAAEzB,IAAI,CAACC,EAAE,CAAC,CAAC;MAC3BuB,cAAc,EAAExB,IAAI,CAACC,EAAE,CAAC,CAAC;MACzByB,oBAAoB,EAAE1B,IAAI,CAACC,EAAE,CAAC,CAAC;MAC/B0B,uBAAuB,EAAE3B,IAAI,CAACC,EAAE,CAAC,CAAC;MAClC2B,yBAAyB,EAAE5B,IAAI,CAACC,EAAE,CAAC,CAAC;MACpC4B,8BAA8B,EAAE7B,IAAI,CAACC,EAAE,CAAC,CAAC;MACzC6B,sBAAsB,EAAE9B,IAAI,CAACC,EAAE,CAAC,CAAC;MACjC8B,kBAAkB,EAAE/B,IAAI,CAACC,EAAE,CAAC,CAAC;MAC7B+B,0BAA0B,EAAEhC,IAAI,CAACC,EAAE,CAAC,CAAC;MACrCgC,0BAA0B,EAAEjC,IAAI,CAACC,EAAE,CAAC,CAAC;MACrCiC,4BAA4B,EAAElC,IAAI,CAACC,EAAE,CAAC;IACxC,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFyC,EAAE,CAAC,4EAA4E,EAAE,YAAY;IAC3F,MAAM/B,qBAAqB,GAAGX,IAAI,CAACqC,KAAK,CACtC7B,oBAAoB,EACpB,mBACF,CAAC;IAEDA,oBAAoB,CAAC8B,iBAAiB,CAAC;MACrCC,cAAc,EAAE,CAAC,6BAA6B,CAAC;MAC/CC,oBAAoB,EAAE;IACxB,CAAC,CAAC;IAEFG,MAAM,CAAChC,qBAAqB,CAAC,CAACsE,gBAAgB,CAAC,CAAC;IAChD;IACA,MAAMtC,MAAM,CAACnC,oBAAoB,CAAC0E,iBAAiB,CAACC,OAAO,CAAC,CAACC,QAAQ,CAACC,IAAI,CACxET,SACF,CAAC;EACH,CAAC,CAAC;EAEFlC,EAAE,CAAC,kGAAkG,EAAE,YAAY;IACjH,MAAMjC,aAAa,GAAGb,kBAAkB,CAAC,CAAC;IAE1CY,oBAAoB,CAAC8B,iBAAiB,CAAC;MACrCC,cAAc,EAAE,CAAC,6BAA6B,CAAC;MAC/CC,oBAAoB,EAAE;IACxB,CAAC,CAAC;IACF;IACA;IACA;IACA8C,UAAU,CAAC,MAAM;MACf7E,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;QAC1BC,IAAI,EAAE;UACJC,aAAa,EAAErD,iBAAiB;UAChCU,IAAI,EAAE,gBAAgB;UACtBkF,SAAS,EAAE;QACb,CAAC;QACDtC,MAAM,EAAE;MACV,CAAC,CACH,CAAC;IACH,CAAC,CAAC;;IAEF;IACA,MAAMN,MAAM,CAACnC,oBAAoB,CAAC0E,iBAAiB,CAACC,OAAO,CAAC,CAACC,QAAQ,CAACC,IAAI,CACxE,oBACF,CAAC;;IAED;IACA;IACA7E,oBAAoB,CAACgF,cAAc,CAAC,CAAC;;IAErC;IACA;IACA;IACAhF,oBAAoB,CAAC8B,iBAAiB,CAAC;MACrCC,cAAc,EAAE,CAAC,6BAA6B,CAAC;MAC/CC,oBAAoB,EAAE;IACxB,CAAC,CAAC;IAEF8C,UAAU,CAAC,MAAM;MACf7E,aAAa,CACX,SAAS,EACT,IAAIqC,YAAY,CAAC,SAAS,EAAE;QAC1BC,IAAI,EAAE;UACJC,aAAa,EAAErD,iBAAiB;UAChCU,IAAI,EAAE,gBAAgB;UACtBkF,SAAS,EAAE;QACb,CAAC;QACDtC,MAAM,EAAE;MACV,CAAC,CACH,CAAC;IACH,CAAC,CAAC;;IAEF;IACA,MAAMN,MAAM,CAACnC,oBAAoB,CAAC0E,iBAAiB,CAACC,OAAO,CAAC,CAACC,QAAQ,CAACC,IAAI,CACxE,uBACF,CAAC;EACH,CAAC,CAAC;AACJ,CAAC,CAAC"}