{"version":3,"file":"useScrollSpy.test.js","names":["act","renderHook","useScrollSpy","debounce","describe","beforeEach","jest","useFakeTimers","it","fn","debouncedFn","expect","toHaveBeenCalledTimes","toHaveBeenCalledWith","not","advanceTimersByTime","target","eventHandler","document","createElement","body","appendChild","spyOn","afterEach","removeChild","clearAllMocks","unmount","addEventListener","any","Function","passive","timeStampLow","Number","removeEventListener","toHaveBeenCalled","scrollEvent","Event","dispatchEvent"],"sources":["../../src/hooks/useScrollSpy.test.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { act, renderHook } from \"@testing-library/react-hooks\"\n\nimport useScrollSpy, { debounce } from \"./useScrollSpy\"\n\ndescribe(\"debounce function\", () => {\n  beforeEach(() => {\n    jest.useFakeTimers()\n  })\n  it(\"should call the function immediately when no delay is provided\", () => {\n    const fn = jest.fn()\n    const debouncedFn = debounce(fn, 0)\n\n    debouncedFn(\"arg1\", \"arg2\")\n\n    expect(fn).toHaveBeenCalledTimes(1)\n    expect(fn).toHaveBeenCalledWith(\"arg1\", \"arg2\")\n  })\n\n  it(\"should delay the function call when a delay is provided\", () => {\n    const fn = jest.fn()\n    const debouncedFn = debounce(fn, 100)\n    debouncedFn(\"arg1\", \"arg2\")\n    expect(fn).toHaveBeenCalledTimes(1)\n    expect(fn).toHaveBeenCalledWith(\"arg1\", \"arg2\")\n\n    debouncedFn(\"arg3\", \"arg4\")\n    expect(fn).not.toHaveBeenCalledWith(\"arg3\", \"arg4\")\n    jest.advanceTimersByTime(99)\n    expect(fn).not.toHaveBeenCalledWith(\"arg3\", \"arg4\")\n\n    jest.advanceTimersByTime(1)\n    expect(fn).toHaveBeenCalledTimes(2)\n    expect(fn).toHaveBeenCalledWith(\"arg3\", \"arg4\")\n  })\n\n  it(\"should cancel the delay when the function is called again\", () => {\n    const fn = jest.fn()\n    const debouncedFn = debounce(fn, 100)\n    debouncedFn(\"arg1\", \"arg2\")\n    expect(fn).toHaveBeenCalledTimes(1)\n    expect(fn).toHaveBeenCalledWith(\"arg1\", \"arg2\")\n\n    debouncedFn(\"arg3\", \"arg4\")\n    jest.advanceTimersByTime(99)\n\n    debouncedFn(\"arg5\", \"arg6\")\n    expect(fn).not.toHaveBeenCalledWith(\"arg5\", \"arg6\")\n\n    jest.advanceTimersByTime(1)\n    expect(fn).toHaveBeenCalledTimes(2)\n    expect(fn).toHaveBeenCalledWith(\"arg5\", \"arg6\")\n  })\n})\n\ndescribe(\"useScrollSpy hook\", () => {\n  let target: HTMLElement\n  let eventHandler: ({ timeStampLow }: any) => void\n\n  beforeEach(() => {\n    jest.useFakeTimers()\n    target = document.createElement(\"div\")\n    eventHandler = jest.fn()\n\n    document.body.appendChild(target)\n    jest.spyOn(target, \"addEventListener\")\n    jest.spyOn(target, \"removeEventListener\")\n  })\n\n  afterEach(() => {\n    document.body.removeChild(target)\n    jest.clearAllMocks()\n  })\n\n  it(\"should set up and clean up event listeners\", () => {\n    const { unmount } = renderHook(() => useScrollSpy(target, eventHandler))\n\n    expect(target.addEventListener).toHaveBeenCalledWith(\n      \"scroll\",\n      expect.any(Function),\n      { passive: true }\n    )\n    expect(eventHandler).toHaveBeenCalledWith({\n      target,\n      timeStampLow: expect.any(Number),\n    })\n\n    unmount()\n\n    expect(target.removeEventListener).toHaveBeenCalledWith(\n      \"scroll\",\n      expect.any(Function)\n    )\n  })\n\n  it(\"should not set up event listeners if no target is provided\", () => {\n    renderHook(() => useScrollSpy(null, eventHandler))\n\n    expect(target.addEventListener).not.toHaveBeenCalled()\n    expect(eventHandler).not.toHaveBeenCalled()\n  })\n\n  it(\"should debounce events\", () => {\n    renderHook(() => useScrollSpy(target, eventHandler))\n\n    const scrollEvent = new Event(\"scroll\")\n    act(() => {\n      target.dispatchEvent(scrollEvent)\n    })\n    expect(eventHandler).toHaveBeenCalledTimes(1)\n\n    act(() => {\n      target.dispatchEvent(scrollEvent)\n    })\n    expect(eventHandler).toHaveBeenCalledTimes(1)\n\n    jest.advanceTimersByTime(99)\n    expect(eventHandler).toHaveBeenCalledTimes(1)\n\n    jest.advanceTimersByTime(1)\n    expect(eventHandler).toHaveBeenCalledTimes(2)\n  })\n})\n"],"mappings":"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"}