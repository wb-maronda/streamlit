{"version":3,"file":"useScrollSpy.js","names":["useLayoutEffect","useMemo","useRef","useCallback","debounce","fn","ms","last","timeout","_len","arguments","length","args","Array","_key","now","Date","clearTimeout","setTimeout","Math","max","DEFAULT_DEBOUNCE_MS","useScrollSpy","target","eventHandler","onEventRef","debouncer","event","current","handleEvent","timeStampLow","addEventListener","passive","removeEventListener"],"sources":["../../src/hooks/useScrollSpy.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useLayoutEffect, useMemo, useRef, useCallback } from \"react\"\n\n/**\n * Creates a debounced function that delays invoking `fn` until after `ms`\n * milliseconds have passed since the last time the debounced function was\n * invoked.\n *\n * @param fn - A function to debounce. `fn` is called after the debounced\n * function has not been called for `ms` milliseconds.\n *\n * @param ms - The delay in milliseconds before `fn` is executed.\n *\n * The debounced function behaves as follows:\n * - It will be invoked immediately if 0 is passed for `ms`.\n * - It will be invoked immediately for the first call in any case.\n * - For subsequent calls, if less than `ms` milliseconds have passed since\n * the last invocation, a new invocation of `fn` is scheduled for `ms`\n * milliseconds after the last invocation.\n * - If it is invoked and `ms` milliseconds have passed since the last\n * invocation, `fn` is executed immediately and the timestamp is updated.\n * - If a new invocation of the debounced function is scheduled and it\n * is invoked again before the scheduled invocation, the scheduled\n * invocation is canceled and a new one is scheduled `ms` milliseconds\n * after the latest invocation.\n *\n * TODO: This has very similar but different behavior than our debounce function\n * in utils.ts. This behavior ensures that the debounced function is called on\n * some interval. Our other debounce function ensures that the function is\n * delayed until the user stops calling it. We should probably unify these\n *\n * @returns A debounced version of the `fn` function.\n */\nexport function debounce(\n  fn: (...args: any[]) => void,\n  ms: number\n): (...args: any[]) => void {\n  if (!ms) {\n    return fn\n  }\n\n  let last = 0\n  let timeout: ReturnType<typeof setTimeout> | null = null\n\n  return (...args) => {\n    const now = Date.now()\n\n    if (now - last > ms) {\n      fn(...args)\n      last = now\n    } else {\n      if (timeout) {\n        clearTimeout(timeout)\n      }\n\n      timeout = setTimeout(() => {\n        fn(...args)\n        last = Date.now()\n      }, Math.max(0, ms - now + last))\n    }\n  }\n}\nconst DEFAULT_DEBOUNCE_MS = 100\n\n/**\n * A hook to add a scroll event listener to a target element with debouncing.\n *\n * @param target - The target HTMLElement to attach the scroll listener to.\n * @param eventHandler - The callback function to execute on scroll.\n *\n * The hook behaves as follows:\n * - The eventHandler callback is wrapped in a debounce function, which\n * ensures the callback is not executed too frequently.\n * - A scroll event listener is added to the target element on mount.\n * - A 'timeStampLow' property is added to the event object before it's\n * passed to the eventHandler.\n * - The scroll event listener is removed from the target when the component\n * unmounts.\n *\n * @returns void.\n */\nexport default function useScrollSpy(\n  target: HTMLElement | null,\n  eventHandler: ({ timeStampLow }: any) => void\n): void {\n  const onEventRef = useRef(eventHandler)\n\n  const debouncer = useMemo(\n    () =>\n      debounce(event => {\n        onEventRef.current(event)\n      }, DEFAULT_DEBOUNCE_MS),\n    [onEventRef]\n  )\n\n  const handleEvent = useCallback(\n    (event: any) => {\n      event.timeStampLow = Date.now()\n\n      debouncer(event)\n    },\n    [debouncer]\n  )\n\n  useLayoutEffect(() => {\n    if (!target) {\n      return () => {}\n    }\n\n    target.addEventListener(\"scroll\", handleEvent, { passive: true })\n    handleEvent({ target })\n\n    return () => target.removeEventListener(\"scroll\", handleEvent)\n  }, [handleEvent, target])\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASA,eAAe,EAAEC,OAAO,EAAEC,MAAM,EAAEC,WAAW,QAAQ,OAAO;;AAErE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,QAAQA,CACtBC,EAA4B,EAC5BC,EAAU,EACgB;EAC1B,IAAI,CAACA,EAAE,EAAE;IACP,OAAOD,EAAE;EACX;EAEA,IAAIE,IAAI,GAAG,CAAC;EACZ,IAAIC,OAA6C,GAAG,IAAI;EAExD,OAAO,YAAa;IAAA,SAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAATC,IAAI,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;MAAJF,IAAI,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;IAAA;IACb,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IAEtB,IAAIA,GAAG,GAAGR,IAAI,GAAGD,EAAE,EAAE;MACnBD,EAAE,CAAC,GAAGO,IAAI,CAAC;MACXL,IAAI,GAAGQ,GAAG;IACZ,CAAC,MAAM;MACL,IAAIP,OAAO,EAAE;QACXS,YAAY,CAACT,OAAO,CAAC;MACvB;MAEAA,OAAO,GAAGU,UAAU,CAAC,MAAM;QACzBb,EAAE,CAAC,GAAGO,IAAI,CAAC;QACXL,IAAI,GAAGS,IAAI,CAACD,GAAG,CAAC,CAAC;MACnB,CAAC,EAAEI,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEd,EAAE,GAAGS,GAAG,GAAGR,IAAI,CAAC,CAAC;IAClC;EACF,CAAC;AACH;AACA,MAAMc,mBAAmB,GAAG,GAAG;;AAE/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,YAAYA,CAClCC,MAA0B,EAC1BC,YAA6C,EACvC;EACN,MAAMC,UAAU,GAAGvB,MAAM,CAACsB,YAAY,CAAC;EAEvC,MAAME,SAAS,GAAGzB,OAAO,CACvB,MACEG,QAAQ,CAACuB,KAAK,IAAI;IAChBF,UAAU,CAACG,OAAO,CAACD,KAAK,CAAC;EAC3B,CAAC,EAAEN,mBAAmB,CAAC,EACzB,CAACI,UAAU,CACb,CAAC;EAED,MAAMI,WAAW,GAAG1B,WAAW,CAC5BwB,KAAU,IAAK;IACdA,KAAK,CAACG,YAAY,GAAGd,IAAI,CAACD,GAAG,CAAC,CAAC;IAE/BW,SAAS,CAACC,KAAK,CAAC;EAClB,CAAC,EACD,CAACD,SAAS,CACZ,CAAC;EAED1B,eAAe,CAAC,MAAM;IACpB,IAAI,CAACuB,MAAM,EAAE;MACX,OAAO,MAAM,CAAC,CAAC;IACjB;IAEAA,MAAM,CAACQ,gBAAgB,CAAC,QAAQ,EAAEF,WAAW,EAAE;MAAEG,OAAO,EAAE;IAAK,CAAC,CAAC;IACjEH,WAAW,CAAC;MAAEN;IAAO,CAAC,CAAC;IAEvB,OAAO,MAAMA,MAAM,CAACU,mBAAmB,CAAC,QAAQ,EAAEJ,WAAW,CAAC;EAChE,CAAC,EAAE,CAACA,WAAW,EAAEN,MAAM,CAAC,CAAC;AAC3B"}