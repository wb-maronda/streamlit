{"version":3,"file":"useScrollAnimation.test.js","names":["renderHook","useScrollAnimation","describe","targetElement","onEndMock","scrollHeight","offsetHeight","beforeEach","document","createElement","scrollTop","Object","defineProperty","set","value","get","addEventListener","jest","fn","removeEventListener","afterEach","clearAllMocks","it","useFakeTimers","advanceTimersByTime","runOnlyPendingTimers","expect","toBeGreaterThan","toHaveBeenCalled","useRealTimers","unmount","toHaveBeenCalledTimes","toHaveBeenCalledWith","any","Function","passive","not"],"sources":["../../src/hooks/useScrollAnimation.test.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { renderHook } from \"@testing-library/react-hooks\"\n\nimport useScrollAnimation from \"./useScrollAnimation\"\n\ndescribe(\"useScrollAnimation\", () => {\n  let targetElement: HTMLElement\n  let onEndMock: () => void\n  let scrollHeight: number\n  let offsetHeight: number\n\n  beforeEach(() => {\n    targetElement = document.createElement(\"div\")\n    targetElement.scrollTop = 0\n    scrollHeight = 200\n    offsetHeight = 100\n    Object.defineProperty(targetElement, \"scrollHeight\", {\n      set: value => (scrollHeight = value),\n      get: () => scrollHeight,\n    })\n    Object.defineProperty(targetElement, \"offsetHeight\", {\n      set: value => (offsetHeight = value),\n      get: () => offsetHeight,\n    })\n    targetElement.addEventListener = jest.fn()\n    targetElement.removeEventListener = jest.fn()\n    onEndMock = jest.fn()\n  })\n\n  afterEach(() => {\n    jest.clearAllMocks()\n  })\n\n  it(\"should animate scroll\", () => {\n    jest.useFakeTimers()\n\n    renderHook(() => useScrollAnimation(targetElement, onEndMock, true))\n\n    // Simulate scroll animation\n    jest.advanceTimersByTime(5)\n    // Trigger the callback of requestAnimationFrame\n    jest.runOnlyPendingTimers()\n\n    // Assert the updated scrollTop value\n    expect(targetElement.scrollTop).toBeGreaterThan(0)\n\n    // Simulate reaching the end of animation\n    jest.advanceTimersByTime(100)\n    // Trigger the callback of requestAnimationFrame\n    jest.runOnlyPendingTimers()\n\n    // Assert that onEnd callback is called\n    expect(onEndMock).toHaveBeenCalled()\n\n    jest.useRealTimers()\n  })\n\n  it(\"should register and deregister the correct events\", () => {\n    jest.useFakeTimers()\n\n    const { unmount } = renderHook(() =>\n      useScrollAnimation(targetElement, onEndMock, true)\n    )\n\n    expect(targetElement.addEventListener).toHaveBeenCalledTimes(2)\n    expect(targetElement.addEventListener).toHaveBeenCalledWith(\n      \"pointerdown\",\n      expect.any(Function),\n      { passive: true }\n    )\n    expect(targetElement.addEventListener).toHaveBeenCalledWith(\n      \"wheel\",\n      expect.any(Function),\n      { passive: true }\n    )\n\n    unmount()\n\n    // Cleanup\n    expect(targetElement.removeEventListener).toHaveBeenCalledTimes(2)\n    expect(targetElement.removeEventListener).toHaveBeenCalledWith(\n      \"pointerdown\",\n      expect.any(Function)\n    )\n    expect(targetElement.removeEventListener).toHaveBeenCalledWith(\n      \"wheel\",\n      expect.any(Function)\n    )\n\n    jest.useRealTimers()\n  })\n\n  it(\"should not animate scroll if target element is null\", () => {\n    renderHook(() => useScrollAnimation(null, onEndMock, true))\n\n    expect(targetElement.addEventListener).not.toHaveBeenCalled()\n  })\n\n  it(\"should not animate scroll if isAnimating is false\", () => {\n    renderHook(() => useScrollAnimation(targetElement, onEndMock, false))\n\n    expect(targetElement.addEventListener).not.toHaveBeenCalled()\n  })\n})\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASA,UAAU,QAAQ,8BAA8B;AAEzD,OAAOC,kBAAkB;AAEzBC,QAAQ,CAAC,oBAAoB,EAAE,MAAM;EACnC,IAAIC,aAA0B;EAC9B,IAAIC,SAAqB;EACzB,IAAIC,YAAoB;EACxB,IAAIC,YAAoB;EAExBC,UAAU,CAAC,MAAM;IACfJ,aAAa,GAAGK,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;IAC7CN,aAAa,CAACO,SAAS,GAAG,CAAC;IAC3BL,YAAY,GAAG,GAAG;IAClBC,YAAY,GAAG,GAAG;IAClBK,MAAM,CAACC,cAAc,CAACT,aAAa,EAAE,cAAc,EAAE;MACnDU,GAAG,EAAEC,KAAK,IAAKT,YAAY,GAAGS,KAAM;MACpCC,GAAG,EAAEA,CAAA,KAAMV;IACb,CAAC,CAAC;IACFM,MAAM,CAACC,cAAc,CAACT,aAAa,EAAE,cAAc,EAAE;MACnDU,GAAG,EAAEC,KAAK,IAAKR,YAAY,GAAGQ,KAAM;MACpCC,GAAG,EAAEA,CAAA,KAAMT;IACb,CAAC,CAAC;IACFH,aAAa,CAACa,gBAAgB,GAAGC,IAAI,CAACC,EAAE,CAAC,CAAC;IAC1Cf,aAAa,CAACgB,mBAAmB,GAAGF,IAAI,CAACC,EAAE,CAAC,CAAC;IAC7Cd,SAAS,GAAGa,IAAI,CAACC,EAAE,CAAC,CAAC;EACvB,CAAC,CAAC;EAEFE,SAAS,CAAC,MAAM;IACdH,IAAI,CAACI,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFC,EAAE,CAAC,uBAAuB,EAAE,MAAM;IAChCL,IAAI,CAACM,aAAa,CAAC,CAAC;IAEpBvB,UAAU,CAAC,MAAMC,kBAAkB,CAACE,aAAa,EAAEC,SAAS,EAAE,IAAI,CAAC,CAAC;;IAEpE;IACAa,IAAI,CAACO,mBAAmB,CAAC,CAAC,CAAC;IAC3B;IACAP,IAAI,CAACQ,oBAAoB,CAAC,CAAC;;IAE3B;IACAC,MAAM,CAACvB,aAAa,CAACO,SAAS,CAAC,CAACiB,eAAe,CAAC,CAAC,CAAC;;IAElD;IACAV,IAAI,CAACO,mBAAmB,CAAC,GAAG,CAAC;IAC7B;IACAP,IAAI,CAACQ,oBAAoB,CAAC,CAAC;;IAE3B;IACAC,MAAM,CAACtB,SAAS,CAAC,CAACwB,gBAAgB,CAAC,CAAC;IAEpCX,IAAI,CAACY,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFP,EAAE,CAAC,mDAAmD,EAAE,MAAM;IAC5DL,IAAI,CAACM,aAAa,CAAC,CAAC;IAEpB,MAAM;MAAEO;IAAQ,CAAC,GAAG9B,UAAU,CAAC,MAC7BC,kBAAkB,CAACE,aAAa,EAAEC,SAAS,EAAE,IAAI,CACnD,CAAC;IAEDsB,MAAM,CAACvB,aAAa,CAACa,gBAAgB,CAAC,CAACe,qBAAqB,CAAC,CAAC,CAAC;IAC/DL,MAAM,CAACvB,aAAa,CAACa,gBAAgB,CAAC,CAACgB,oBAAoB,CACzD,aAAa,EACbN,MAAM,CAACO,GAAG,CAACC,QAAQ,CAAC,EACpB;MAAEC,OAAO,EAAE;IAAK,CAClB,CAAC;IACDT,MAAM,CAACvB,aAAa,CAACa,gBAAgB,CAAC,CAACgB,oBAAoB,CACzD,OAAO,EACPN,MAAM,CAACO,GAAG,CAACC,QAAQ,CAAC,EACpB;MAAEC,OAAO,EAAE;IAAK,CAClB,CAAC;IAEDL,OAAO,CAAC,CAAC;;IAET;IACAJ,MAAM,CAACvB,aAAa,CAACgB,mBAAmB,CAAC,CAACY,qBAAqB,CAAC,CAAC,CAAC;IAClEL,MAAM,CAACvB,aAAa,CAACgB,mBAAmB,CAAC,CAACa,oBAAoB,CAC5D,aAAa,EACbN,MAAM,CAACO,GAAG,CAACC,QAAQ,CACrB,CAAC;IACDR,MAAM,CAACvB,aAAa,CAACgB,mBAAmB,CAAC,CAACa,oBAAoB,CAC5D,OAAO,EACPN,MAAM,CAACO,GAAG,CAACC,QAAQ,CACrB,CAAC;IAEDjB,IAAI,CAACY,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFP,EAAE,CAAC,qDAAqD,EAAE,MAAM;IAC9DtB,UAAU,CAAC,MAAMC,kBAAkB,CAAC,IAAI,EAAEG,SAAS,EAAE,IAAI,CAAC,CAAC;IAE3DsB,MAAM,CAACvB,aAAa,CAACa,gBAAgB,CAAC,CAACoB,GAAG,CAACR,gBAAgB,CAAC,CAAC;EAC/D,CAAC,CAAC;EAEFN,EAAE,CAAC,mDAAmD,EAAE,MAAM;IAC5DtB,UAAU,CAAC,MAAMC,kBAAkB,CAACE,aAAa,EAAEC,SAAS,EAAE,KAAK,CAAC,CAAC;IAErEsB,MAAM,CAACvB,aAAa,CAACa,gBAAgB,CAAC,CAACoB,GAAG,CAACR,gBAAgB,CAAC,CAAC;EAC/D,CAAC,CAAC;AACJ,CAAC,CAAC"}