{"version":3,"file":"SessionInfo.test.js","names":["SessionInfo","NewSession","mockSessionInfoProps","test","sessionInfo","expect","current","toThrow","describe","setCurrent","isSet","toBe","toEqual","last","toBeUndefined","appId","isHello","MESSAGE","config","gatherUsageStats","maxCachedMessageAge","mapboxToken","allowRunOnSave","initialize","userInfo","installationId","installationIdV3","environmentInfo","streamlitVersion","pythonVersion","sessionStatus","runOnSave","scriptIsRunning","sessionId","props","propsFromNewSessionMessage","commandLine","toBeFalsy"],"sources":["../src/SessionInfo.test.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SessionInfo } from \"./SessionInfo\"\nimport { NewSession } from \"./proto\"\nimport { mockSessionInfoProps } from \"./mocks/mocks\"\n\ntest(\"Throws an error when used before initialization\", () => {\n  const sessionInfo = new SessionInfo()\n  expect(() => sessionInfo.current).toThrow()\n})\n\ndescribe(\"SessionInfo.setCurrent\", () => {\n  test(\"copies props to `current`\", () => {\n    const sessionInfo = new SessionInfo()\n    sessionInfo.setCurrent(mockSessionInfoProps())\n\n    expect(sessionInfo.isSet).toBe(true)\n    expect(sessionInfo.current).toEqual(mockSessionInfoProps())\n  })\n\n  test(\"copies previous props to `last`\", () => {\n    const sessionInfo = new SessionInfo()\n    sessionInfo.setCurrent(mockSessionInfoProps())\n    expect(sessionInfo.last).toBeUndefined()\n\n    sessionInfo.setCurrent(mockSessionInfoProps({ appId: \"newValue\" }))\n    expect(sessionInfo.current).toEqual(\n      mockSessionInfoProps({ appId: \"newValue\" })\n    )\n    expect(sessionInfo.last).toEqual(mockSessionInfoProps())\n  })\n})\n\ndescribe(\"SessionInfo.isHello\", () => {\n  test(\"is true only when `isHello` is true in current SessionInfo\", () => {\n    const sessionInfo = new SessionInfo()\n    expect(sessionInfo.isHello).toBe(false)\n\n    sessionInfo.setCurrent(mockSessionInfoProps({ isHello: true }))\n    expect(sessionInfo.isHello).toBe(true)\n\n    sessionInfo.setCurrent(mockSessionInfoProps({ isHello: false }))\n    expect(sessionInfo.isHello).toBe(false)\n  })\n})\n\ntest(\"Props can be initialized from a protobuf\", () => {\n  const MESSAGE = new NewSession({\n    config: {\n      gatherUsageStats: false,\n      maxCachedMessageAge: 31,\n      mapboxToken: \"mapboxToken\",\n      allowRunOnSave: false,\n    },\n    initialize: {\n      userInfo: {\n        installationId: \"installationId\",\n        installationIdV3: \"installationIdV3\",\n      },\n      environmentInfo: {\n        streamlitVersion: \"streamlitVersion\",\n        pythonVersion: \"pythonVersion\",\n      },\n      sessionStatus: {\n        runOnSave: false,\n        scriptIsRunning: false,\n      },\n      sessionId: \"sessionId\",\n      isHello: false,\n    },\n  })\n\n  const props = SessionInfo.propsFromNewSessionMessage(MESSAGE)\n  expect(props.sessionId).toEqual(\"sessionId\")\n  expect(props.streamlitVersion).toEqual(\"streamlitVersion\")\n  expect(props.pythonVersion).toEqual(\"pythonVersion\")\n  expect(props.installationId).toEqual(\"installationId\")\n  expect(props.installationIdV3).toEqual(\"installationIdV3\")\n  expect(props.maxCachedMessageAge).toEqual(31)\n  expect(props.commandLine).toBeUndefined()\n  expect(props.isHello).toBeFalsy()\n})\n"],"mappings":"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"}