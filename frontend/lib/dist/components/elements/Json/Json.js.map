{"version":3,"file":"Json.js","names":["React","useRef","JSON5","Clipboard","ReactJson","useTheme","ErrorElement","hasLightBackgroundColor","ensureError","StyledJsonWrapper","jsx","_jsx","Json","_ref","width","element","theme","elementRef","bodyObject","JSON","parse","body","e","error","json5Error","pos","parseInt","message","replace","substring","name","jsonTheme","handleCopy","copy","stringify","src","container","current","undefined","className","ref","children","collapsed","maxExpandDepth","expanded","displayDataTypes","displayObjectSize","enableClipboard","style","fontFamily","genericFonts","codeFont","fontSize","fontSizes","sm","backgroundColor","colors","bgColor","whiteSpace"],"sources":["../../../../src/components/elements/Json/Json.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement, useRef } from \"react\"\n\nimport JSON5 from \"json5\"\nimport Clipboard from \"clipboard\"\nimport ReactJson from \"react-json-view\"\nimport { useTheme } from \"@emotion/react\"\n\nimport ErrorElement from \"@streamlit/lib/src/components/shared/ErrorElement\"\nimport { Json as JsonProto } from \"@streamlit/lib/src/proto\"\nimport {\n  EmotionTheme,\n  hasLightBackgroundColor,\n} from \"@streamlit/lib/src/theme\"\nimport { ensureError } from \"@streamlit/lib/src/util/ErrorHandling\"\n\nimport { StyledJsonWrapper } from \"./styled-components\"\nexport interface JsonProps {\n  width: number\n  element: JsonProto\n}\n\n/**\n * Functional element representing JSON structured text.\n */\nexport default function Json({\n  width,\n  element,\n}: Readonly<JsonProps>): ReactElement {\n  const theme: EmotionTheme = useTheme()\n\n  const elementRef = useRef<HTMLDivElement>(null)\n\n  let bodyObject\n  try {\n    bodyObject = JSON.parse(element.body)\n  } catch (e) {\n    const error = ensureError(e)\n    try {\n      bodyObject = JSON5.parse(element.body)\n    } catch (json5Error) {\n      // If content fails to parse as Json, rebuild the error message\n      // to show where the problem occurred.\n      const pos = parseInt(error.message.replace(/[^0-9]/g, \"\"), 10)\n      error.message += `\\n${element.body.substring(0, pos + 1)} ‚Üê here`\n      return <ErrorElement name={\"Json Parse Error\"} message={error.message} />\n    }\n  }\n\n  // Try to pick a reasonable ReactJson theme based on whether the streamlit\n  // theme's background is light or dark.\n  const jsonTheme = hasLightBackgroundColor(theme) ? \"rjv-default\" : \"monokai\"\n\n  const handleCopy = (copy: any): void => {\n    // we use ClipboardJS to do the copying, because it allows\n    // us to specify a container element. This is necessary because\n    // otherwise copying doesn't work in dialogs.\n    Clipboard.copy(JSON.stringify(copy.src), {\n      container: elementRef.current ?? undefined,\n    })\n  }\n\n  return (\n    <StyledJsonWrapper\n      className=\"stJson\"\n      data-testid=\"stJson\"\n      width={width}\n      ref={elementRef}\n    >\n      <ReactJson\n        src={bodyObject}\n        collapsed={element.maxExpandDepth ?? !element.expanded}\n        displayDataTypes={false}\n        displayObjectSize={false}\n        name={false}\n        theme={jsonTheme}\n        enableClipboard={handleCopy}\n        style={{\n          fontFamily: theme.genericFonts.codeFont,\n          fontSize: theme.fontSizes.sm,\n          backgroundColor: theme.colors.bgColor,\n          whiteSpace: \"pre-wrap\", // preserve whitespace\n        }}\n      />\n    </StyledJsonWrapper>\n  )\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,KAAK,IAAkBC,MAAM,QAAQ,OAAO;AAEnD,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAOC,SAAS,MAAM,WAAW;AACjC,OAAOC,SAAS,MAAM,iBAAiB;AACvC,SAASC,QAAQ,QAAQ,gBAAgB;AAEzC,OAAOC,YAAY;AAEnB,SAEEC,uBAAuB;AAEzB,SAASC,WAAW;AAEpB,SAASC,iBAAiB;AAA6B,SAAAC,GAAA,IAAAC,IAAA;AAMvD;AACA;AACA;AACA,eAAe,SAASC,IAAIA,CAAAC,IAAA,EAGU;EAAA,IAHT;IAC3BC,KAAK;IACLC;EACmB,CAAC,GAAAF,IAAA;EACpB,MAAMG,KAAmB,GAAGX,QAAQ,CAAC,CAAC;EAEtC,MAAMY,UAAU,GAAGhB,MAAM,CAAiB,IAAI,CAAC;EAE/C,IAAIiB,UAAU;EACd,IAAI;IACFA,UAAU,GAAGC,IAAI,CAACC,KAAK,CAACL,OAAO,CAACM,IAAI,CAAC;EACvC,CAAC,CAAC,OAAOC,CAAC,EAAE;IACV,MAAMC,KAAK,GAAGf,WAAW,CAACc,CAAC,CAAC;IAC5B,IAAI;MACFJ,UAAU,GAAGhB,KAAK,CAACkB,KAAK,CAACL,OAAO,CAACM,IAAI,CAAC;IACxC,CAAC,CAAC,OAAOG,UAAU,EAAE;MACnB;MACA;MACA,MAAMC,GAAG,GAAGC,QAAQ,CAACH,KAAK,CAACI,OAAO,CAACC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;MAC9DL,KAAK,CAACI,OAAO,IAAK,KAAIZ,OAAO,CAACM,IAAI,CAACQ,SAAS,CAAC,CAAC,EAAEJ,GAAG,GAAG,CAAC,CAAE,SAAQ;MACjE,oBAAOd,IAAA,CAACL,YAAY;QAACwB,IAAI,EAAE,kBAAmB;QAACH,OAAO,EAAEJ,KAAK,CAACI;MAAQ,CAAE,CAAC;IAC3E;EACF;;EAEA;EACA;EACA,MAAMI,SAAS,GAAGxB,uBAAuB,CAACS,KAAK,CAAC,GAAG,aAAa,GAAG,SAAS;EAE5E,MAAMgB,UAAU,GAAIC,IAAS,IAAW;IACtC;IACA;IACA;IACA9B,SAAS,CAAC8B,IAAI,CAACd,IAAI,CAACe,SAAS,CAACD,IAAI,CAACE,GAAG,CAAC,EAAE;MACvCC,SAAS,EAAEnB,UAAU,CAACoB,OAAO,IAAIC;IACnC,CAAC,CAAC;EACJ,CAAC;EAED,oBACE3B,IAAA,CAACF,iBAAiB;IAChB8B,SAAS,EAAC,QAAQ;IAClB,eAAY,QAAQ;IACpBzB,KAAK,EAAEA,KAAM;IACb0B,GAAG,EAAEvB,UAAW;IAAAwB,QAAA,eAEhB9B,IAAA,CAACP,SAAS;MACR+B,GAAG,EAAEjB,UAAW;MAChBwB,SAAS,EAAE3B,OAAO,CAAC4B,cAAc,IAAI,CAAC5B,OAAO,CAAC6B,QAAS;MACvDC,gBAAgB,EAAE,KAAM;MACxBC,iBAAiB,EAAE,KAAM;MACzBhB,IAAI,EAAE,KAAM;MACZd,KAAK,EAAEe,SAAU;MACjBgB,eAAe,EAAEf,UAAW;MAC5BgB,KAAK,EAAE;QACLC,UAAU,EAAEjC,KAAK,CAACkC,YAAY,CAACC,QAAQ;QACvCC,QAAQ,EAAEpC,KAAK,CAACqC,SAAS,CAACC,EAAE;QAC5BC,eAAe,EAAEvC,KAAK,CAACwC,MAAM,CAACC,OAAO;QACrCC,UAAU,EAAE,UAAU,CAAE;MAC1B;IAAE,CACH;EAAC,CACe,CAAC;AAExB"}