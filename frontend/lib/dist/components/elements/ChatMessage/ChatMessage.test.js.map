{"version":3,"file":"ChatMessage.test.js","names":["React","screen","mockEndpoints","render","Block","BlockProto","ChatMessage","jsx","_jsx","getProps","elementProps","arguments","length","undefined","element","create","name","avatarType","AvatarType","ICON","avatar","endpoints","buildMediaURL","jest","fn","mockImplementation","url","describe","it","props","chatMessage","getByTestId","expect","toBeInTheDocument","toHaveClass","children","getByLabelText","textContent","toBe","EMOJI","getByText","toBeTruthy","IMAGE","chatAvatar","getByAltText","toHaveAttribute","userAvatarIcon","assistantAvatarIcon","toHaveStyle","chatMessageContent","getAttribute","toEqual"],"sources":["../../../../src/components/elements/ChatMessage/ChatMessage.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport \"@testing-library/jest-dom\"\nimport { screen } from \"@testing-library/react\"\n\nimport { mockEndpoints } from \"@streamlit/lib/src/mocks/mocks\"\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport { Block as BlockProto } from \"@streamlit/lib/src/proto\"\n\nimport ChatMessage, { ChatMessageProps } from \"./ChatMessage\"\n\nconst getProps = (\n  elementProps: Partial<BlockProto.ChatMessage> = {}\n): ChatMessageProps => ({\n  element: BlockProto.ChatMessage.create({\n    name: \"user\",\n    avatarType: BlockProto.ChatMessage.AvatarType.ICON,\n    avatar: \"user\",\n    ...elementProps,\n  }),\n  endpoints: mockEndpoints({\n    buildMediaURL: jest.fn().mockImplementation(url => url),\n  }),\n})\n\ndescribe(\"ChatMessage\", () => {\n  it(\"renders without crashing\", () => {\n    const props = getProps()\n    render(<ChatMessage {...props} />)\n\n    const chatMessage = screen.getByTestId(\"stChatMessage\")\n    expect(chatMessage).toBeInTheDocument()\n    expect(chatMessage).toHaveClass(\"stChatMessage\")\n  })\n\n  it(\"renders message children content\", () => {\n    const props = getProps()\n    render(<ChatMessage {...props}>Hello, world!</ChatMessage>)\n    expect(screen.getByLabelText(\"Chat message from user\").textContent).toBe(\n      \"Hello, world!\"\n    )\n  })\n\n  it(\"renders with an emoji avatar\", () => {\n    const props = getProps({\n      avatar: \"ðŸ˜ƒ\",\n      avatarType: BlockProto.ChatMessage.AvatarType.EMOJI,\n    })\n    render(<ChatMessage {...props} />)\n    expect(screen.getByText(\"ðŸ˜ƒ\")).toBeTruthy()\n  })\n\n  it(\"renders with an image avatar\", () => {\n    const props = getProps({\n      avatar: \"http://example.com/avatar.jpg\",\n      avatarType: BlockProto.ChatMessage.AvatarType.IMAGE,\n    })\n    render(<ChatMessage {...props} />)\n    const chatAvatar = screen.getByAltText(\"user avatar\")\n    expect(chatAvatar).toHaveAttribute(\"src\", \"http://example.com/avatar.jpg\")\n  })\n\n  it(\"renders with a name label character as fallback\", () => {\n    const props = getProps({\n      avatar: undefined,\n      avatarType: undefined,\n      name: \"test\",\n    })\n    render(<ChatMessage {...props} />)\n    expect(screen.getByText(\"T\")).toBeTruthy()\n  })\n\n  it(\"renders with a 'user' icon avatar\", () => {\n    const props = getProps({\n      avatar: \"user\",\n      avatarType: BlockProto.ChatMessage.AvatarType.ICON,\n      name: \"foo\",\n    })\n    render(<ChatMessage {...props} />)\n\n    const userAvatarIcon = screen.getByTestId(\"stChatMessageAvatarUser\")\n    expect(userAvatarIcon).toBeInTheDocument()\n  })\n\n  it(\"renders with a 'assistant' icon avatar\", () => {\n    const props = getProps({\n      avatar: \"assistant\",\n      avatarType: BlockProto.ChatMessage.AvatarType.ICON,\n      name: \"foo\",\n    })\n    render(<ChatMessage {...props} />)\n\n    const assistantAvatarIcon = screen.getByTestId(\n      \"stChatMessageAvatarAssistant\"\n    )\n    expect(assistantAvatarIcon).toBeInTheDocument()\n  })\n\n  it(\"renders with a grey background when name is 'user'\", () => {\n    const props = getProps()\n    render(<ChatMessage {...props} />)\n    const chatMessage = screen.getByTestId(\"stChatMessage\")\n    expect(chatMessage).toHaveStyle(\n      \"background-color: rgba(240, 242, 246, 0.5)\"\n    )\n  })\n\n  it(\"sets an aria label on the chat message\", () => {\n    const props = getProps()\n    render(<ChatMessage {...props} />)\n\n    const chatMessageContent = screen.getByTestId(\"stChatMessageContent\")\n    expect(chatMessageContent.getAttribute(\"aria-label\")).toEqual(\n      \"Chat message from user\"\n    )\n  })\n})\n"],"mappings":"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"}