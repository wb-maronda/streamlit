{"version":3,"file":"Expander.js","names":["React","useEffect","useRef","useState","ExpandMore","ExpandLess","DynamicIcon","StyledSpinnerIcon","StyledIcon","StreamlitMarkdown","notNullOrUndefined","LibContext","isPresetTheme","BORDER_SIZE","StyledExpandableContainer","StyledSummary","StyledSummaryHeading","StyledDetailsPanel","StyledDetails","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ExpanderIcon","props","icon","activeTheme","useContext","iconProps","size","margin","padding","statusIconTestIds","usingCustomTheme","color","iconValue","testid","Expander","_ref","element","isStale","empty","children","label","expanded","initialExpanded","setExpanded","detailsRef","summaryRef","animationRef","timeoutRef","contentRef","current","open","onAnimationFinish","style","height","overflow","toggleAnimation","detailsEl","startHeight","endHeight","isOpen","cancel","clearTimeout","animation","animate","concat","duration","easing","onfinish","toggle","e","preventDefault","detailsHeight","getBoundingClientRect","summaryHeight","window","requestAnimationFrame","setTimeout","contentHeight","ref","onClick","source","allowHTML","isLabel","as"],"sources":["../../../../src/components/elements/Expander/Expander.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement, useEffect, useRef, useState } from \"react\"\nimport { ExpandMore, ExpandLess } from \"@emotion-icons/material-outlined\"\nimport { Block as BlockProto } from \"@streamlit/lib/src/proto\"\nimport {\n  DynamicIcon,\n  StyledSpinnerIcon,\n  StyledIcon,\n} from \"@streamlit/lib/src/components/shared/Icon\"\nimport StreamlitMarkdown from \"@streamlit/lib/src/components/shared/StreamlitMarkdown\"\nimport { notNullOrUndefined } from \"@streamlit/lib/src/util/utils\"\nimport { LibContext } from \"@streamlit/lib/src/components/core/LibContext\"\nimport { IconSize, isPresetTheme } from \"@streamlit/lib/src/theme\"\n\nimport {\n  BORDER_SIZE,\n  StyledExpandableContainer,\n  StyledSummary,\n  StyledSummaryHeading,\n  StyledDetailsPanel,\n  StyledDetails,\n} from \"./styled-components\"\n\nexport interface ExpanderIconProps {\n  icon?: string\n}\n\n/**\n * Renders an icon for the expander and optionally a user-defined icon.\n *\n * If the icon is \"spinner\", it will render a spinner icon.\n * If the icon is a valid, user-defined icon, it will render the user-defined icon.\n * Otherwise, it will render nothing.\n *\n * @param {string} icon - The icon to render.\n * @returns {ReactElement}\n */\nexport const ExpanderIcon = (props: ExpanderIconProps): ReactElement => {\n  const { icon } = props\n  const { activeTheme } = React.useContext(LibContext)\n\n  const iconProps = {\n    size: \"lg\" as IconSize,\n    margin: \"\",\n    padding: \"\",\n  }\n\n  const statusIconTestIds: Record<string, string> = {\n    \":material/check:\": \"stExpanderIconCheck\",\n    \":material/error:\": \"stExpanderIconError\",\n  }\n\n  if (icon === \"spinner\") {\n    const usingCustomTheme = !isPresetTheme(activeTheme)\n    return (\n      <StyledSpinnerIcon\n        usingCustomTheme={usingCustomTheme}\n        data-testid=\"stExpanderIconSpinner\"\n        {...iconProps}\n      />\n    )\n  }\n\n  return icon ? (\n    <DynamicIcon\n      color=\"inherit\"\n      iconValue={icon}\n      testid={statusIconTestIds[icon] || \"stExpanderIcon\"}\n      {...iconProps}\n    />\n  ) : (\n    <></>\n  )\n}\n\nexport interface ExpanderProps {\n  element: BlockProto.Expandable\n  isStale: boolean\n  empty: boolean\n}\n\nconst Expander: React.FC<React.PropsWithChildren<ExpanderProps>> = ({\n  element,\n  isStale,\n  empty,\n  children,\n}): ReactElement => {\n  const { label, expanded: initialExpanded } = element\n  const [expanded, setExpanded] = useState<boolean>(initialExpanded || false)\n  const detailsRef = useRef<HTMLDetailsElement>(null)\n  const summaryRef = useRef<HTMLElement>(null)\n  const animationRef = useRef<Animation | null>(null)\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null)\n  const contentRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    // Only apply the expanded state if it was actually set in the proto.\n    if (notNullOrUndefined(initialExpanded)) {\n      setExpanded(initialExpanded)\n\n      // We manage the open attribute via the detailsRef and not with React state\n      if (detailsRef.current) {\n        detailsRef.current.open = initialExpanded\n      }\n    }\n\n    // Having `label` in the dependency array here is necessary because\n    // sometimes two distinct expanders look so similar that even the react\n    // diffing algorithm decides that they're the same element with updated\n    // props (this happens when something in the app removes one expander and\n    // replaces it with another in the same position).\n    //\n    // By adding `label` as a dependency, we ensure that we reset the\n    // expander's `expanded` state in this edge case.\n  }, [label, initialExpanded])\n\n  const onAnimationFinish = (open: boolean): void => {\n    if (!detailsRef.current) {\n      return\n    }\n\n    detailsRef.current.open = open\n    animationRef.current = null\n    detailsRef.current.style.height = \"\"\n    detailsRef.current.style.overflow = \"\"\n  }\n\n  const toggleAnimation = (\n    detailsEl: HTMLDetailsElement,\n    startHeight: number,\n    endHeight: number\n  ): void => {\n    const isOpen = endHeight > startHeight\n\n    if (animationRef.current) {\n      animationRef.current.cancel()\n\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current)\n        timeoutRef.current = null\n      }\n    }\n\n    const animation = detailsEl.animate(\n      {\n        height: [`${startHeight}px`, `${endHeight}px`],\n      },\n      {\n        duration: 500,\n        easing: \"cubic-bezier(0.23, 1, 0.32, 1)\",\n      }\n    )\n\n    animation.onfinish = () => onAnimationFinish(isOpen)\n    animationRef.current = animation\n  }\n\n  const toggle = (e: React.MouseEvent<HTMLDetailsElement>): void => {\n    e.preventDefault()\n    if (empty) {\n      return\n    }\n\n    setExpanded(!expanded)\n    const detailsEl = detailsRef.current\n    if (!detailsEl || !summaryRef.current) {\n      return\n    }\n\n    detailsEl.style.overflow = \"hidden\"\n    const detailsHeight = detailsEl.getBoundingClientRect().height\n    const summaryHeight = summaryRef.current.getBoundingClientRect().height\n\n    if (!expanded) {\n      detailsEl.style.height = `${detailsHeight}px`\n      detailsEl.open = true\n\n      window.requestAnimationFrame(() => {\n        // For expansion animations, we rely on the rendered width and height\n        // of the children content. However, in Safari, the children are not\n        // rendered because Safari doesn't paint elements that are not visible\n        // (in this case, the details element is not visible because it's\n        // not open). This operation produces inconsistent heights to animate.\n        // To work around this, we force a repaint by animating a tiny bit\n        // and animate the rest of it later.\n        toggleAnimation(\n          detailsEl,\n          detailsHeight,\n          summaryHeight + 2 * BORDER_SIZE + 5 // Arbitrary size of 5px\n        )\n\n        timeoutRef.current = setTimeout(() => {\n          if (!contentRef.current) {\n            return\n          }\n\n          const contentHeight =\n            contentRef.current.getBoundingClientRect().height\n          toggleAnimation(\n            detailsEl,\n            detailsHeight,\n            summaryHeight + contentHeight + 2 * BORDER_SIZE\n          )\n        }, 100)\n      })\n    } else {\n      toggleAnimation(\n        detailsEl,\n        detailsHeight,\n        summaryHeight + 2 * BORDER_SIZE\n      )\n    }\n  }\n\n  return (\n    <StyledExpandableContainer data-testid=\"stExpander\">\n      <StyledDetails isStale={isStale} ref={detailsRef}>\n        <StyledSummary onClick={toggle} empty={empty} ref={summaryRef}>\n          <StyledSummaryHeading>\n            {element.icon && <ExpanderIcon icon={element.icon} />}\n            <StreamlitMarkdown source={label} allowHTML={false} isLabel />\n          </StyledSummaryHeading>\n          {!empty ? (\n            <StyledIcon\n              as={expanded ? ExpandLess : ExpandMore}\n              color={\"inherit\"}\n              aria-hidden=\"true\"\n              data-testid=\"stExpanderToggleIcon\"\n              size=\"lg\"\n              margin=\"\"\n              padding=\"\"\n            />\n          ) : (\n            <></>\n          )}\n        </StyledSummary>\n        {!empty ? (\n          <StyledDetailsPanel data-testid=\"stExpanderDetails\" ref={contentRef}>\n            {children}\n          </StyledDetailsPanel>\n        ) : (\n          <></>\n        )}\n      </StyledDetails>\n    </StyledExpandableContainer>\n  )\n}\n\nexport default Expander\n"],"mappings":"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"}