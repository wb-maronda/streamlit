{"version":3,"file":"GraphVizChart.test.js","names":["React","screen","graphviz","logError","render","GraphVizChart","GraphVizChartProto","jsx","_jsx","jest","mock","fn","mockReturnValue","zoom","fit","scale","engine","renderDot","on","logMessage","getProps","elementProps","arguments","length","undefined","element","create","spec","elementId","isFullScreen","describe","beforeEach","mockClear","afterEach","it","props","expect","getByTestId","toBeInTheDocument","not","toHaveBeenCalled","mockRenderDot","mockImplementation","Error","toHaveBeenCalledTimes","toHaveBeenCalledWith","toHaveStyle"],"sources":["../../../../src/components/elements/GraphVizChart/GraphVizChart.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\nimport \"@testing-library/jest-dom\"\nimport { screen } from \"@testing-library/react\"\nimport { graphviz } from \"d3-graphviz\"\nimport { logError } from \"@streamlit/lib/src/util/log\"\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport { GraphVizChart as GraphVizChartProto } from \"@streamlit/lib/src/proto\"\nimport { GraphVizChart, GraphVizChartProps } from \"./GraphVizChart\"\n\njest.mock(\"d3-graphviz\", () => ({\n  graphviz: jest.fn().mockReturnValue({\n    zoom: () => ({\n      fit: () => ({\n        scale: () => ({\n          engine: () => ({\n            renderDot: () => ({\n              on: jest.fn(),\n            }),\n          }),\n        }),\n      }),\n    }),\n  }),\n}))\njest.mock(\"@streamlit/lib/src/util/log\", () => ({\n  logError: jest.fn(),\n  logMessage: jest.fn(),\n}))\n\nconst getProps = (\n  elementProps: Partial<GraphVizChartProto> = {}\n): GraphVizChartProps => ({\n  element: GraphVizChartProto.create({\n    spec: `digraph \"Hello World\" {Hello -> World}`,\n    elementId: \"1\",\n    ...elementProps,\n  }),\n  isFullScreen: false,\n})\n\ndescribe(\"GraphVizChart Element\", () => {\n  beforeEach(() => {\n    // @ts-expect-error\n    logError.mockClear()\n  })\n\n  afterEach(() => {\n    // @ts-expect-error\n    graphviz.mockClear()\n  })\n\n  it(\"renders without crashing\", () => {\n    const props = getProps()\n    render(<GraphVizChart {...props} />)\n\n    expect(screen.getByTestId(\"stGraphVizChart\")).toBeInTheDocument()\n    expect(logError).not.toHaveBeenCalled()\n    expect(graphviz).toHaveBeenCalled()\n  })\n\n  it(\"should update chart and log error when crashes\", () => {\n    // Mock graphviz().renderDot() to throw an error for the \"crash\" spec\n    const mockRenderDot = jest.fn().mockImplementation(spec => {\n      if (spec === \"crash\") {\n        throw new Error(\"Simulated GraphViz crash\")\n      }\n      return {\n        on: jest.fn(),\n      }\n    })\n\n    // Modify the graphviz mock to use the mockRenderDot\n    ;(graphviz as jest.Mock).mockReturnValue({\n      zoom: () => ({\n        fit: () => ({\n          scale: () => ({\n            engine: () => ({\n              renderDot: mockRenderDot,\n            }),\n          }),\n        }),\n      }),\n    })\n\n    const props = getProps({\n      spec: \"crash\",\n    })\n\n    render(<GraphVizChart {...props} />)\n\n    expect(logError).toHaveBeenCalledTimes(1)\n    expect(mockRenderDot).toHaveBeenCalledWith(\"crash\")\n    expect(graphviz).toHaveBeenCalledTimes(1)\n  })\n\n  it(\"shoud render with height and width set to auto\", () => {\n    const props = {\n      ...getProps(),\n    }\n    render(<GraphVizChart {...props} />)\n\n    expect(screen.getByTestId(\"stGraphVizChart\")).toHaveStyle(\n      \"height: auto; width: auto\"\n    )\n  })\n\n  it(\"shoud render with height and width set to 100%\", () => {\n    const props = {\n      ...getProps(),\n      isFullScreen: true,\n    }\n    render(<GraphVizChart {...props} />)\n\n    expect(screen.getByTestId(\"stGraphVizChart\")).toHaveStyle(\n      \"height: 100%; width: 100%\"\n    )\n  })\n})\n"],"mappings":"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"}