{"version":3,"file":"Html.js","names":["React","useEffect","useRef","useState","DOMPurify","jsx","_jsx","Fragment","_Fragment","sanitizeString","html","sanitizationOptions","USE_PROFILES","FORCE_BODY","sanitize","Html","_ref","element","width","body","sanitizedHtml","setSanitizedHtml","htmlRef","current","clientHeight","parentElement","childElementCount","classList","add","children","className","ref","style","dangerouslySetInnerHTML","__html"],"sources":["../../../../src/components/elements/Html/Html.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement, useEffect, useRef, useState } from \"react\"\n\nimport DOMPurify from \"dompurify\"\n\nimport { Html as HtmlProto } from \"@streamlit/lib/src/proto\"\n\nexport interface HtmlProps {\n  width: number\n  element: HtmlProto\n}\n\nconst sanitizeString = (html: string): string => {\n  const sanitizationOptions = {\n    // Default to permit HTML, SVG and MathML, this limits to HTML only\n    USE_PROFILES: { html: true },\n    // glue elements like style, script or others to document.body and prevent unintuitive browser behavior in several edge-cases\n    FORCE_BODY: true,\n  }\n  return DOMPurify.sanitize(html, sanitizationOptions)\n}\n\n/**\n * HTML code to insert into the page.\n */\nexport default function Html({\n  element,\n  width,\n}: Readonly<HtmlProps>): ReactElement {\n  const { body } = element\n  const [sanitizedHtml, setSanitizedHtml] = useState(sanitizeString(body))\n  const htmlRef = useRef<HTMLDivElement | null>(null)\n\n  useEffect(() => {\n    if (sanitizeString(body) !== sanitizedHtml) {\n      setSanitizedHtml(sanitizeString(body))\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [body])\n\n  useEffect(() => {\n    if (\n      htmlRef.current?.clientHeight === 0 &&\n      htmlRef.current.parentElement?.childElementCount === 1\n    ) {\n      // div has no rendered content - hide to avoid unnecessary spacing\n      htmlRef.current.parentElement.classList.add(\"stHtml-empty\")\n    }\n  })\n\n  return (\n    <>\n      {sanitizedHtml && (\n        <div\n          className=\"stHtml\"\n          data-testid=\"stHtml\"\n          ref={htmlRef}\n          style={{ width }}\n          dangerouslySetInnerHTML={{ __html: sanitizedHtml }}\n        />\n      )}\n    </>\n  )\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,KAAK,IAAkBC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAExE,OAAOC,SAAS,MAAM,WAAW;AAAA,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AASjC,MAAMC,cAAc,GAAIC,IAAY,IAAa;EAC/C,MAAMC,mBAAmB,GAAG;IAC1B;IACAC,YAAY,EAAE;MAAEF,IAAI,EAAE;IAAK,CAAC;IAC5B;IACAG,UAAU,EAAE;EACd,CAAC;EACD,OAAOT,SAAS,CAACU,QAAQ,CAACJ,IAAI,EAAEC,mBAAmB,CAAC;AACtD,CAAC;;AAED;AACA;AACA;AACA,eAAe,SAASI,IAAIA,CAAAC,IAAA,EAGU;EAAA,IAHT;IAC3BC,OAAO;IACPC;EACmB,CAAC,GAAAF,IAAA;EACpB,MAAM;IAAEG;EAAK,CAAC,GAAGF,OAAO;EACxB,MAAM,CAACG,aAAa,EAAEC,gBAAgB,CAAC,GAAGlB,QAAQ,CAACM,cAAc,CAACU,IAAI,CAAC,CAAC;EACxE,MAAMG,OAAO,GAAGpB,MAAM,CAAwB,IAAI,CAAC;EAEnDD,SAAS,CAAC,MAAM;IACd,IAAIQ,cAAc,CAACU,IAAI,CAAC,KAAKC,aAAa,EAAE;MAC1CC,gBAAgB,CAACZ,cAAc,CAACU,IAAI,CAAC,CAAC;IACxC;IACA;EACF,CAAC,EAAE,CAACA,IAAI,CAAC,CAAC;EAEVlB,SAAS,CAAC,MAAM;IACd,IACEqB,OAAO,CAACC,OAAO,EAAEC,YAAY,KAAK,CAAC,IACnCF,OAAO,CAACC,OAAO,CAACE,aAAa,EAAEC,iBAAiB,KAAK,CAAC,EACtD;MACA;MACAJ,OAAO,CAACC,OAAO,CAACE,aAAa,CAACE,SAAS,CAACC,GAAG,CAAC,cAAc,CAAC;IAC7D;EACF,CAAC,CAAC;EAEF,oBACEtB,IAAA,CAAAE,SAAA;IAAAqB,QAAA,EACGT,aAAa,iBACZd,IAAA;MACEwB,SAAS,EAAC,QAAQ;MAClB,eAAY,QAAQ;MACpBC,GAAG,EAAET,OAAQ;MACbU,KAAK,EAAE;QAAEd;MAAM,CAAE;MACjBe,uBAAuB,EAAE;QAAEC,MAAM,EAAEd;MAAc;IAAE,CACpD;EACF,CACD,CAAC;AAEP"}