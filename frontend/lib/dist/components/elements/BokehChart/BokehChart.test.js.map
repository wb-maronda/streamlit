{"version":3,"file":"BokehChart.test.js","names":["React","screen","render","BokehChart","BokehChartProto","Figure","Bokeh","jsx","_jsx","jest","mock","__esModule","default","register_plugin","fn","embed","embed_item","require","mockBokehEmbed","mocked","getProps","elementProps","arguments","length","undefined","element","create","figure","JSON","stringify","useContainerWidth","elementId","height","width","expect","extend","toMatchBokehDimensions","data","plot","doc","roots","references","find","e","type","message","pass","attributes","plot_width","plot_height","concat","describe","div","beforeEach","document","createElement","body","appendChild","afterEach","mockClear","removeChild","it","props","getByTestId","toBeInTheDocument","toHaveBeenCalledWith","rerender","toHaveBeenCalledTimes"],"sources":["../../../../src/components/elements/BokehChart/BokehChart.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\nimport \"@testing-library/jest-dom\"\nimport { screen } from \"@testing-library/react\"\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport { BokehChart as BokehChartProto } from \"@streamlit/lib/src/proto\"\n\nimport Figure from \"./mock\"\n\nimport { BokehChartProps } from \"./BokehChart\"\nimport Bokeh from \"@streamlit/lib/src/vendor/bokeh/bokeh.esm\"\n\njest.mock(\"@streamlit/lib/src/vendor/bokeh/bokeh.esm\", () => ({\n  // needed to parse correctly\n  __esModule: true,\n  default: {\n    // the js source code has main.register_plugin so we need to mock it\n    register_plugin: jest.fn(),\n    // actual function that we need to mock and check\n    embed: {\n      embed_item: jest.fn(),\n    },\n  },\n}))\n\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst { BokehChart } = require(\"./BokehChart\")\n\nconst mockBokehEmbed = jest.mocked(Bokeh)\n\nconst getProps = (\n  elementProps: Partial<BokehChartProto> = {}\n): BokehChartProps => ({\n  element: BokehChartProto.create({\n    figure: JSON.stringify(Figure),\n    useContainerWidth: false,\n    elementId: \"1\",\n    ...elementProps,\n  }),\n  height: 400,\n  width: 400,\n})\n\nexpect.extend({\n  toMatchBokehDimensions(data, width, height) {\n    const plot =\n      data && data.doc && data.doc.roots && data.doc.roots.references\n        ? data.doc.roots.references.find((e: any) => e.type === \"Plot\")\n        : undefined\n\n    if (!plot) {\n      return {\n        message: () => `expected data to contain attributes`,\n        pass: false,\n      }\n    }\n\n    const pass =\n      plot.attributes.plot_width === width &&\n      plot.attributes.plot_height === height\n\n    return {\n      message: () =>\n        `expected ${plot.attributes.plot_width}x${plot.attributes.plot_height} to be ${width}x${height}`,\n      pass,\n    }\n  },\n})\n\ndescribe(\"BokehChart element\", () => {\n  // Avoid Warning: render(): Rendering components directly into document.body is discouraged.\n  let div: HTMLDivElement\n  beforeEach(() => {\n    div = document.createElement(\"div\")\n    document.body.appendChild(div)\n  })\n\n  afterEach(() => {\n    // @ts-expect-error\n    mockBokehEmbed.embed.embed_item.mockClear() // clear so embed item calls don't add up\n    document.body.removeChild(div)\n  })\n\n  it(\"renders without crashing\", () => {\n    const props = getProps()\n    render(<BokehChart {...props} />)\n    expect(screen.getByTestId(\"stBokehChart\")).toBeInTheDocument()\n  })\n\n  describe(\"Chart dimensions\", () => {\n    it(\"should use height if not useContainerWidth\", () => {\n      const props = getProps()\n      render(<BokehChart {...props} />)\n      expect(mockBokehEmbed.embed.embed_item).toHaveBeenCalledWith(\n        // @ts-expect-error\n        expect.toMatchBokehDimensions(400, 400),\n        \"bokeh-chart-1\"\n      )\n    })\n\n    it(\"should have width if useContainerWidth\", () => {\n      const props = {\n        ...getProps({\n          useContainerWidth: true,\n        }),\n        height: 0,\n      }\n\n      render(<BokehChart {...props} />)\n\n      expect(mockBokehEmbed.embed.embed_item).toHaveBeenCalledWith(\n        // @ts-expect-error\n        expect.toMatchBokehDimensions(400),\n        \"bokeh-chart-1\"\n      )\n    })\n  })\n\n  it(\"should re-render the chart when the component updates\", () => {\n    const props = getProps()\n    const { rerender } = render(<BokehChart {...props} />)\n    rerender(<BokehChart {...props} width={500} height={500} />)\n    expect(mockBokehEmbed.embed.embed_item).toHaveBeenCalledTimes(2)\n  })\n})\n"],"mappings":"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"}