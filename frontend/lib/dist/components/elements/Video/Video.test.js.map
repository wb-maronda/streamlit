{"version":3,"file":"Video.test.js","names":["React","screen","render","Video","VideoProto","mockEndpoints","jsx","_jsx","describe","buildMediaURL","jest","fn","mockReturnValue","mockSetElementState","mockGetElementState","elementMgrMock","setElementState","getElementState","sendRerunBackMsg","formsDataChanged","getProps","elementProps","arguments","length","undefined","element","create","url","type","Type","UNUSED","startTime","endpoints","width","elementMgr","beforeEach","clearAllMocks","it","props","videoElement","getByTestId","expect","toBeInTheDocument","toHaveClass","video","toHaveAttribute","toHaveStyle","toHaveBeenCalledWith","mockReturnValueOnce","autoplay","id","audioElement","not","toHaveBeenCalledTimes","toHaveBeenCalled","YOUTUBE_IFRAME","document","body","toMatchSnapshot","currentTime","toBe","rerender"],"sources":["../../../../src/components/elements/Video/Video.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport \"@testing-library/jest-dom\"\nimport { screen } from \"@testing-library/react\"\n\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport { Video as VideoProto } from \"@streamlit/lib/src/proto\"\nimport { mockEndpoints } from \"@streamlit/lib/src/mocks/mocks\"\nimport { WidgetStateManager as ElementStateManager } from \"@streamlit/lib/src/WidgetStateManager\"\n\nimport Video, { VideoProps } from \"./Video\"\n\ndescribe(\"Video Element\", () => {\n  const buildMediaURL = jest.fn().mockReturnValue(\"https://mock.media.url\")\n\n  const mockSetElementState = jest.fn()\n  const mockGetElementState = jest.fn()\n  const elementMgrMock = {\n    setElementState: mockSetElementState,\n    getElementState: mockGetElementState,\n    sendRerunBackMsg: jest.fn(),\n    formsDataChanged: jest.fn(),\n  }\n\n  const getProps = (elementProps: Partial<VideoProto> = {}): VideoProps => ({\n    element: VideoProto.create({\n      url: \"https://www.w3schools.com/html/mov_bbb.mp4\",\n      type: VideoProto.Type.UNUSED,\n      startTime: 0,\n      ...elementProps,\n    }),\n    endpoints: mockEndpoints({ buildMediaURL: buildMediaURL }),\n    width: 0,\n    elementMgr: elementMgrMock as unknown as ElementStateManager,\n  })\n\n  beforeEach(() => {\n    jest.clearAllMocks()\n  })\n\n  it(\"renders without crashing\", () => {\n    const props = getProps()\n    render(<Video {...props} />)\n\n    const videoElement = screen.getByTestId(\"stVideo\")\n    expect(videoElement).toBeInTheDocument()\n    expect(videoElement).toHaveClass(\"stVideo\")\n  })\n\n  it(\"has correct style\", () => {\n    const props = getProps()\n    render(<Video {...props} />)\n    const video = screen.getByTestId(\"stVideo\")\n\n    expect(video).toHaveAttribute(\"class\", \"stVideo\")\n    expect(video).toHaveStyle(\"width: 0px; height: 528px;\")\n  })\n\n  it(\"has controls\", () => {\n    const props = getProps()\n    render(<Video {...props} />)\n\n    expect(screen.getByTestId(\"stVideo\")).toHaveAttribute(\"controls\")\n  })\n\n  it(\"creates its `src` attribute using buildMediaURL\", () => {\n    render(<Video {...getProps({ url: \"/media/mockVideoFile.mp4\" })} />)\n    expect(buildMediaURL).toHaveBeenCalledWith(\"/media/mockVideoFile.mp4\")\n    expect(screen.getByTestId(\"stVideo\")).toHaveAttribute(\n      \"src\",\n      \"https://mock.media.url\"\n    )\n  })\n\n  beforeEach(() => {\n    jest.clearAllMocks()\n    mockGetElementState.mockReturnValue(false) // By default, assume autoplay is not prevented\n  })\n\n  it(\"does not autoplay if preventAutoplay is set\", () => {\n    mockGetElementState.mockReturnValueOnce(true) // Autoplay should be prevented\n    const props = getProps({ autoplay: true, id: \"uniqueVideoId\" })\n    render(<Video {...props} />)\n    const audioElement = screen.getByTestId(\"stVideo\")\n    expect(audioElement).not.toHaveAttribute(\"autoPlay\")\n  })\n\n  it(\"autoplays if preventAutoplay is not set and autoplay is true\", () => {\n    mockGetElementState.mockReturnValueOnce(false) // Autoplay is not prevented\n    const props = getProps({ autoplay: true, id: \"uniqueVideoId\" })\n    render(<Video {...props} />)\n    const audioElement = screen.getByTestId(\"stVideo\")\n    expect(audioElement).toHaveAttribute(\"autoPlay\")\n  })\n\n  it(\"calls setElementState to prevent future autoplay on first autoplay\", () => {\n    mockGetElementState.mockReturnValueOnce(false) // Autoplay is not prevented initially\n    const props = getProps({ autoplay: true, id: \"uniqueVideoId\" })\n    render(<Video {...props} />)\n    expect(mockSetElementState).toHaveBeenCalledTimes(1)\n    expect(mockSetElementState).toHaveBeenCalledWith(\n      props.element.id,\n      \"preventAutoplay\",\n      true\n    )\n  })\n\n  // Test to ensure that setElementState is not called again if autoplay is already prevented\n  it(\"does not call setElementState again if autoplay is already prevented\", () => {\n    mockGetElementState.mockReturnValueOnce(true) // Autoplay is already prevented\n    const props = getProps({ autoplay: true, id: \"uniqueVideoId\" })\n    render(<Video {...props} />)\n    expect(mockSetElementState).not.toHaveBeenCalled()\n  })\n\n  describe(\"YouTube\", () => {\n    it(\"renders a youtube iframe\", () => {\n      const props = getProps({\n        type: VideoProto.Type.YOUTUBE_IFRAME,\n      })\n      render(<Video {...props} />)\n      expect(document.body).toMatchSnapshot()\n    })\n\n    it(\"renders a youtube iframe with an starting time\", () => {\n      const props = getProps({\n        type: VideoProto.Type.YOUTUBE_IFRAME,\n        startTime: 10,\n      })\n      render(<Video {...props} />)\n      expect(document.body).toMatchSnapshot()\n    })\n  })\n\n  describe(\"updateTime\", () => {\n    const props = getProps()\n\n    it(\"sets the current time to startTime on render\", () => {\n      render(<Video {...props} />)\n      const videoElement = screen.getByTestId(\"stVideo\") as HTMLMediaElement\n      expect(videoElement.currentTime).toBe(0)\n    })\n\n    it(\"updates the current time when startTime is changed\", () => {\n      const { rerender } = render(<Video {...props} />)\n      const videoElement = screen.getByTestId(\"stVideo\") as HTMLMediaElement\n      expect(videoElement.currentTime).toBe(0)\n\n      rerender(<Video {...getProps({ startTime: 10 })} />)\n      expect(videoElement.currentTime).toBe(10)\n    })\n  })\n})\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,KAAK,MAAM,OAAO;AAEzB,OAAO,2BAA2B;AAClC,SAASC,MAAM,QAAQ,wBAAwB;AAE/C,SAASC,MAAM;AACf,SAASC,KAAK,IAAIC,UAAU;AAC5B,SAASC,aAAa;AAGtB,OAAOF,KAAK;AAA+B,SAAAG,GAAA,IAAAC,IAAA;AAE3CC,QAAQ,CAAC,eAAe,EAAE,MAAM;EAC9B,MAAMC,aAAa,GAAGC,IAAI,CAACC,EAAE,CAAC,CAAC,CAACC,eAAe,CAAC,wBAAwB,CAAC;EAEzE,MAAMC,mBAAmB,GAAGH,IAAI,CAACC,EAAE,CAAC,CAAC;EACrC,MAAMG,mBAAmB,GAAGJ,IAAI,CAACC,EAAE,CAAC,CAAC;EACrC,MAAMI,cAAc,GAAG;IACrBC,eAAe,EAAEH,mBAAmB;IACpCI,eAAe,EAAEH,mBAAmB;IACpCI,gBAAgB,EAAER,IAAI,CAACC,EAAE,CAAC,CAAC;IAC3BQ,gBAAgB,EAAET,IAAI,CAACC,EAAE,CAAC;EAC5B,CAAC;EAED,MAAMS,QAAQ,GAAG,SAAAA,CAAA;IAAA,IAACC,YAAiC,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;IAAA,OAAkB;MACxEG,OAAO,EAAErB,UAAU,CAACsB,MAAM,CAAC;QACzBC,GAAG,EAAE,4CAA4C;QACjDC,IAAI,EAAExB,UAAU,CAACyB,IAAI,CAACC,MAAM;QAC5BC,SAAS,EAAE,CAAC;QACZ,GAAGV;MACL,CAAC,CAAC;MACFW,SAAS,EAAE3B,aAAa,CAAC;QAAEI,aAAa,EAAEA;MAAc,CAAC,CAAC;MAC1DwB,KAAK,EAAE,CAAC;MACRC,UAAU,EAAEnB;IACd,CAAC;EAAA,CAAC;EAEFoB,UAAU,CAAC,MAAM;IACfzB,IAAI,CAAC0B,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFC,EAAE,CAAC,0BAA0B,EAAE,MAAM;IACnC,MAAMC,KAAK,GAAGlB,QAAQ,CAAC,CAAC;IACxBlB,MAAM,eAACK,IAAA,CAACJ,KAAK;MAAA,GAAKmC;IAAK,CAAG,CAAC,CAAC;IAE5B,MAAMC,YAAY,GAAGtC,MAAM,CAACuC,WAAW,CAAC,SAAS,CAAC;IAClDC,MAAM,CAACF,YAAY,CAAC,CAACG,iBAAiB,CAAC,CAAC;IACxCD,MAAM,CAACF,YAAY,CAAC,CAACI,WAAW,CAAC,SAAS,CAAC;EAC7C,CAAC,CAAC;EAEFN,EAAE,CAAC,mBAAmB,EAAE,MAAM;IAC5B,MAAMC,KAAK,GAAGlB,QAAQ,CAAC,CAAC;IACxBlB,MAAM,eAACK,IAAA,CAACJ,KAAK;MAAA,GAAKmC;IAAK,CAAG,CAAC,CAAC;IAC5B,MAAMM,KAAK,GAAG3C,MAAM,CAACuC,WAAW,CAAC,SAAS,CAAC;IAE3CC,MAAM,CAACG,KAAK,CAAC,CAACC,eAAe,CAAC,OAAO,EAAE,SAAS,CAAC;IACjDJ,MAAM,CAACG,KAAK,CAAC,CAACE,WAAW,CAAC,4BAA4B,CAAC;EACzD,CAAC,CAAC;EAEFT,EAAE,CAAC,cAAc,EAAE,MAAM;IACvB,MAAMC,KAAK,GAAGlB,QAAQ,CAAC,CAAC;IACxBlB,MAAM,eAACK,IAAA,CAACJ,KAAK;MAAA,GAAKmC;IAAK,CAAG,CAAC,CAAC;IAE5BG,MAAM,CAACxC,MAAM,CAACuC,WAAW,CAAC,SAAS,CAAC,CAAC,CAACK,eAAe,CAAC,UAAU,CAAC;EACnE,CAAC,CAAC;EAEFR,EAAE,CAAC,iDAAiD,EAAE,MAAM;IAC1DnC,MAAM,eAACK,IAAA,CAACJ,KAAK;MAAA,GAAKiB,QAAQ,CAAC;QAAEO,GAAG,EAAE;MAA2B,CAAC;IAAC,CAAG,CAAC,CAAC;IACpEc,MAAM,CAAChC,aAAa,CAAC,CAACsC,oBAAoB,CAAC,0BAA0B,CAAC;IACtEN,MAAM,CAACxC,MAAM,CAACuC,WAAW,CAAC,SAAS,CAAC,CAAC,CAACK,eAAe,CACnD,KAAK,EACL,wBACF,CAAC;EACH,CAAC,CAAC;EAEFV,UAAU,CAAC,MAAM;IACfzB,IAAI,CAAC0B,aAAa,CAAC,CAAC;IACpBtB,mBAAmB,CAACF,eAAe,CAAC,KAAK,CAAC,EAAC;EAC7C,CAAC,CAAC;EAEFyB,EAAE,CAAC,6CAA6C,EAAE,MAAM;IACtDvB,mBAAmB,CAACkC,mBAAmB,CAAC,IAAI,CAAC,EAAC;IAC9C,MAAMV,KAAK,GAAGlB,QAAQ,CAAC;MAAE6B,QAAQ,EAAE,IAAI;MAAEC,EAAE,EAAE;IAAgB,CAAC,CAAC;IAC/DhD,MAAM,eAACK,IAAA,CAACJ,KAAK;MAAA,GAAKmC;IAAK,CAAG,CAAC,CAAC;IAC5B,MAAMa,YAAY,GAAGlD,MAAM,CAACuC,WAAW,CAAC,SAAS,CAAC;IAClDC,MAAM,CAACU,YAAY,CAAC,CAACC,GAAG,CAACP,eAAe,CAAC,UAAU,CAAC;EACtD,CAAC,CAAC;EAEFR,EAAE,CAAC,8DAA8D,EAAE,MAAM;IACvEvB,mBAAmB,CAACkC,mBAAmB,CAAC,KAAK,CAAC,EAAC;IAC/C,MAAMV,KAAK,GAAGlB,QAAQ,CAAC;MAAE6B,QAAQ,EAAE,IAAI;MAAEC,EAAE,EAAE;IAAgB,CAAC,CAAC;IAC/DhD,MAAM,eAACK,IAAA,CAACJ,KAAK;MAAA,GAAKmC;IAAK,CAAG,CAAC,CAAC;IAC5B,MAAMa,YAAY,GAAGlD,MAAM,CAACuC,WAAW,CAAC,SAAS,CAAC;IAClDC,MAAM,CAACU,YAAY,CAAC,CAACN,eAAe,CAAC,UAAU,CAAC;EAClD,CAAC,CAAC;EAEFR,EAAE,CAAC,oEAAoE,EAAE,MAAM;IAC7EvB,mBAAmB,CAACkC,mBAAmB,CAAC,KAAK,CAAC,EAAC;IAC/C,MAAMV,KAAK,GAAGlB,QAAQ,CAAC;MAAE6B,QAAQ,EAAE,IAAI;MAAEC,EAAE,EAAE;IAAgB,CAAC,CAAC;IAC/DhD,MAAM,eAACK,IAAA,CAACJ,KAAK;MAAA,GAAKmC;IAAK,CAAG,CAAC,CAAC;IAC5BG,MAAM,CAAC5B,mBAAmB,CAAC,CAACwC,qBAAqB,CAAC,CAAC,CAAC;IACpDZ,MAAM,CAAC5B,mBAAmB,CAAC,CAACkC,oBAAoB,CAC9CT,KAAK,CAACb,OAAO,CAACyB,EAAE,EAChB,iBAAiB,EACjB,IACF,CAAC;EACH,CAAC,CAAC;;EAEF;EACAb,EAAE,CAAC,sEAAsE,EAAE,MAAM;IAC/EvB,mBAAmB,CAACkC,mBAAmB,CAAC,IAAI,CAAC,EAAC;IAC9C,MAAMV,KAAK,GAAGlB,QAAQ,CAAC;MAAE6B,QAAQ,EAAE,IAAI;MAAEC,EAAE,EAAE;IAAgB,CAAC,CAAC;IAC/DhD,MAAM,eAACK,IAAA,CAACJ,KAAK;MAAA,GAAKmC;IAAK,CAAG,CAAC,CAAC;IAC5BG,MAAM,CAAC5B,mBAAmB,CAAC,CAACuC,GAAG,CAACE,gBAAgB,CAAC,CAAC;EACpD,CAAC,CAAC;EAEF9C,QAAQ,CAAC,SAAS,EAAE,MAAM;IACxB6B,EAAE,CAAC,0BAA0B,EAAE,MAAM;MACnC,MAAMC,KAAK,GAAGlB,QAAQ,CAAC;QACrBQ,IAAI,EAAExB,UAAU,CAACyB,IAAI,CAAC0B;MACxB,CAAC,CAAC;MACFrD,MAAM,eAACK,IAAA,CAACJ,KAAK;QAAA,GAAKmC;MAAK,CAAG,CAAC,CAAC;MAC5BG,MAAM,CAACe,QAAQ,CAACC,IAAI,CAAC,CAACC,eAAe,CAAC,CAAC;IACzC,CAAC,CAAC;IAEFrB,EAAE,CAAC,gDAAgD,EAAE,MAAM;MACzD,MAAMC,KAAK,GAAGlB,QAAQ,CAAC;QACrBQ,IAAI,EAAExB,UAAU,CAACyB,IAAI,CAAC0B,cAAc;QACpCxB,SAAS,EAAE;MACb,CAAC,CAAC;MACF7B,MAAM,eAACK,IAAA,CAACJ,KAAK;QAAA,GAAKmC;MAAK,CAAG,CAAC,CAAC;MAC5BG,MAAM,CAACe,QAAQ,CAACC,IAAI,CAAC,CAACC,eAAe,CAAC,CAAC;IACzC,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFlD,QAAQ,CAAC,YAAY,EAAE,MAAM;IAC3B,MAAM8B,KAAK,GAAGlB,QAAQ,CAAC,CAAC;IAExBiB,EAAE,CAAC,8CAA8C,EAAE,MAAM;MACvDnC,MAAM,eAACK,IAAA,CAACJ,KAAK;QAAA,GAAKmC;MAAK,CAAG,CAAC,CAAC;MAC5B,MAAMC,YAAY,GAAGtC,MAAM,CAACuC,WAAW,CAAC,SAAS,CAAqB;MACtEC,MAAM,CAACF,YAAY,CAACoB,WAAW,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;IAC1C,CAAC,CAAC;IAEFvB,EAAE,CAAC,oDAAoD,EAAE,MAAM;MAC7D,MAAM;QAAEwB;MAAS,CAAC,GAAG3D,MAAM,eAACK,IAAA,CAACJ,KAAK;QAAA,GAAKmC;MAAK,CAAG,CAAC,CAAC;MACjD,MAAMC,YAAY,GAAGtC,MAAM,CAACuC,WAAW,CAAC,SAAS,CAAqB;MACtEC,MAAM,CAACF,YAAY,CAACoB,WAAW,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;MAExCC,QAAQ,eAACtD,IAAA,CAACJ,KAAK;QAAA,GAAKiB,QAAQ,CAAC;UAAEW,SAAS,EAAE;QAAG,CAAC;MAAC,CAAG,CAAC,CAAC;MACpDU,MAAM,CAACF,YAAY,CAACoB,WAAW,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC;IAC3C,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC"}