{"version":3,"file":"Toast.js","names":["React","useCallback","useEffect","useMemo","useState","withTheme","toaster","hasLightBackgroundColor","StreamlitMarkdown","Kind","AlertElement","DynamicIcon","StyledMessageWrapper","StyledToastWrapper","StyledViewButton","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","generateToastOverrides","theme","lightBackground","Body","props","className","style","display","flexDirection","gap","spacing","md","width","sizes","toastWidth","marginTop","sm","borderTopLeftRadius","radii","default","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","paddingTop","lg","paddingBottom","paddingLeft","twoXL","paddingRight","backgroundColor","colors","gray10","gray90","color","bodyText","boxShadow","CloseIcon","fadedText40","fontSizes","height","marginRight","shortenMessage","fullMessage","characterLimit","length","message","replace","substring","split","slice","join","trim","Toast","_ref","body","icon","displayMessage","shortened","expanded","setExpanded","toastKey","setToastKey","handleClick","styleOverrides","toastContent","children","iconValue","size","testid","source","allowHTML","isToast","onClick","inSidebar","newKey","info","overrides","update","transitionDuration","clear","sidebarErrorMessage","kind","ERROR"],"sources":["../../../../src/components/elements/Toast/Toast.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\"\n\nimport { withTheme } from \"@emotion/react\"\nimport { toaster, ToastOverrides } from \"baseui/toast\"\n\nimport {\n  EmotionTheme,\n  hasLightBackgroundColor,\n} from \"@streamlit/lib/src/theme\"\nimport StreamlitMarkdown from \"@streamlit/lib/src/components/shared/StreamlitMarkdown\"\nimport { Kind } from \"@streamlit/lib/src/components/shared/AlertContainer\"\nimport AlertElement from \"@streamlit/lib/src/components/elements/AlertElement/AlertElement\"\nimport { DynamicIcon } from \"@streamlit/lib/src/components/shared/Icon\"\n\nimport {\n  StyledMessageWrapper,\n  StyledToastWrapper,\n  StyledViewButton,\n} from \"./styled-components\"\n\nexport interface ToastProps {\n  theme: EmotionTheme\n  body: string\n  icon?: string\n  width: number\n}\n\nfunction generateToastOverrides(theme: EmotionTheme): ToastOverrides {\n  const lightBackground = hasLightBackgroundColor(theme)\n  return {\n    Body: {\n      props: {\n        \"data-testid\": \"stToast\",\n        className: \"stToast\",\n      },\n      style: {\n        display: \"flex\",\n        flexDirection: \"row\",\n        gap: theme.spacing.md,\n        width: theme.sizes.toastWidth,\n        marginTop: theme.spacing.sm,\n        // Warnings logged if you use shorthand property here:\n        borderTopLeftRadius: theme.radii.default,\n        borderTopRightRadius: theme.radii.default,\n        borderBottomLeftRadius: theme.radii.default,\n        borderBottomRightRadius: theme.radii.default,\n        paddingTop: theme.spacing.lg,\n        paddingBottom: theme.spacing.lg,\n        paddingLeft: theme.spacing.twoXL,\n        paddingRight: theme.spacing.twoXL,\n        backgroundColor: lightBackground\n          ? theme.colors.gray10\n          : theme.colors.gray90,\n        color: theme.colors.bodyText,\n        // Take standard BaseWeb shadow and adjust for dark backgrounds\n        boxShadow: lightBackground\n          ? \"0px 4px 16px rgba(0, 0, 0, 0.16)\"\n          : \"0px 4px 16px rgba(0, 0, 0, 0.7)\",\n      },\n    },\n    CloseIcon: {\n      style: {\n        color: theme.colors.fadedText40,\n        width: theme.fontSizes.lg,\n        height: theme.fontSizes.lg,\n        marginRight: `calc(-1 * ${theme.spacing.lg} / 2)`,\n        \":hover\": {\n          color: theme.colors.bodyText,\n        },\n      },\n    },\n  }\n}\n\n// Function used to truncate toast messages that are longer than three lines.\nexport function shortenMessage(fullMessage: string): string {\n  const characterLimit = 104\n\n  if (fullMessage.length > characterLimit) {\n    let message = fullMessage.replace(/^(.{104}[^\\s]*).*/, \"$1\")\n\n    if (message.length > characterLimit) {\n      message = message\n        .substring(0, characterLimit)\n        .split(\" \")\n        .slice(0, -1)\n        .join(\" \")\n    }\n\n    return message.trim()\n  }\n\n  return fullMessage\n}\n\nexport function Toast({\n  theme,\n  body,\n  icon,\n  width,\n}: Readonly<ToastProps>): ReactElement {\n  const displayMessage = shortenMessage(body)\n  const shortened = body !== displayMessage\n\n  const [expanded, setExpanded] = useState(!shortened)\n  const [toastKey, setToastKey] = useState<React.Key>(0)\n\n  const handleClick = useCallback((): void => {\n    setExpanded(!expanded)\n  }, [expanded])\n\n  const styleOverrides = useMemo(() => generateToastOverrides(theme), [theme])\n\n  const toastContent = useMemo(\n    () => (\n      <StyledToastWrapper expanded={expanded}>\n        {icon && (\n          <DynamicIcon\n            iconValue={icon}\n            size=\"xl\"\n            testid=\"stToastDynamicIcon\"\n          />\n        )}\n        <StyledMessageWrapper>\n          <StreamlitMarkdown\n            source={expanded ? body : displayMessage}\n            allowHTML={false}\n            isToast\n          />\n          {shortened && (\n            <StyledViewButton\n              data-testid=\"stToastViewButton\"\n              onClick={handleClick}\n            >\n              {expanded ? \"view less\" : \"view more\"}\n            </StyledViewButton>\n          )}\n        </StyledMessageWrapper>\n      </StyledToastWrapper>\n    ),\n    [shortened, expanded, body, icon, displayMessage, handleClick]\n  )\n\n  useEffect(() => {\n    // Handles the error case where st.sidebar.toast is called since\n    // baseweb would throw error anyway (no toast container in sidebar)\n    if (theme.inSidebar) {\n      return\n    }\n\n    // Uses toaster utility to create toast on mount and generate unique key\n    // to reference that toast for update/removal\n    const newKey = toaster.info(toastContent, {\n      overrides: { ...styleOverrides },\n    })\n    setToastKey(newKey)\n\n    return () => {\n      // Disable transition so toast doesn't flicker on removal\n      toaster.update(newKey, {\n        overrides: { Body: { style: { transitionDuration: 0 } } },\n      })\n      // Remove toast on unmount\n      toaster.clear(newKey)\n    }\n\n    // Array must be empty to run as mount/cleanup\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  useEffect(() => {\n    // Handles expand/collapse button behavior for long toast messages\n    toaster.update(toastKey, {\n      children: toastContent,\n      overrides: { ...styleOverrides },\n    })\n  }, [toastKey, toastContent, styleOverrides])\n\n  const sidebarErrorMessage = (\n    <AlertElement\n      kind={Kind.ERROR}\n      body=\"Streamlit API Error: `st.toast` cannot be called directly on the sidebar with `st.sidebar.toast`.\n        See our `st.toast` API [docs](https://docs.streamlit.io/develop/api-reference/status/st.toast) for more information.\"\n      width={width}\n    />\n  )\n  return (\n    // Shows error if toast is called on st.sidebar\n    <>{theme.inSidebar && sidebarErrorMessage}</>\n  )\n}\n\nexport default withTheme(Toast)\n"],"mappings":"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"}