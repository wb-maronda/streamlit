{"version":3,"file":"Selectbox.js","names":["React","isMobile","ChevronDown","Select","UISelect","withTheme","hasMatch","score","sortBy","VirtualDropdown","isNullOrUndefined","Placement","TooltipIcon","WidgetLabel","StyledWidgetLabelHelp","iconSizes","jsx","_jsx","jsxs","_jsxs","NO_OPTIONS_MSG","fuzzyFilterSelectOptions","options","pattern","filteredOptions","filter","opt","label","reverse","Selectbox","PureComponent","constructor","arguments","state","isEmpty","value","props","onChange","params","length","setState","selected","parseInt","onInputChange","event","currentInput","target","onClose","filterOptions","filterValue","componentDidUpdate","prevProps","_","render","style","width","labelVisibility","help","placeholder","theme","clearable","disabled","toString","selectOptions","map","option","index","showKeyboardOnMobile","className","children","content","placement","TOP_RIGHT","labelKey","escapeClearsValue","valueKey","overrides","Root","lineHeight","lineHeights","inputWidget","Dropdown","component","ClearIcon","Svg","color","colors","darkGray","transform","spacing","twoXL","fill","bodyText","ControlContainer","height","sizes","minElementHeight","borderLeftWidth","borderWidth","borderRightWidth","borderTopWidth","borderBottomWidth","IconsContainer","paddingRight","sm","ValueContainer","paddingLeft","paddingBottom","paddingTop","Input","readOnly","Popover","Body","marginTop","SelectArrow","xl"],"sources":["../../../../src/components/shared/Dropdown/Selectbox.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\nimport { isMobile } from \"react-device-detect\"\nimport { ChevronDown } from \"baseui/icon\"\nimport { Select as UISelect, OnChangeParams, Option } from \"baseui/select\"\nimport { withTheme } from \"@emotion/react\"\nimport { hasMatch, score } from \"fzy.js\"\nimport sortBy from \"lodash/sortBy\"\n\nimport VirtualDropdown from \"@streamlit/lib/src/components/shared/Dropdown/VirtualDropdown\"\nimport {\n  LabelVisibilityOptions,\n  isNullOrUndefined,\n} from \"@streamlit/lib/src/util/utils\"\nimport { Placement } from \"@streamlit/lib/src/components/shared/Tooltip\"\nimport TooltipIcon from \"@streamlit/lib/src/components/shared/TooltipIcon\"\nimport {\n  WidgetLabel,\n  StyledWidgetLabelHelp,\n} from \"@streamlit/lib/src/components/widgets/BaseWidget\"\nimport { iconSizes } from \"@streamlit/lib/src/theme/primitives\"\nimport { EmotionTheme } from \"@streamlit/lib/src/theme\"\n\nconst NO_OPTIONS_MSG = \"No options to select.\"\n\nexport interface Props {\n  disabled: boolean\n  width?: number\n  value: number | null\n  onChange: (value: number | null) => void\n  options: any[]\n  label?: string | null\n  labelVisibility?: LabelVisibilityOptions\n  help?: string\n  placeholder?: string\n  clearable?: boolean\n  theme: EmotionTheme\n}\n\ninterface State {\n  // Used to work around the forced rerender when the input is empty\n  isEmpty: boolean\n  /**\n   * The value specified by the user via the UI. If the user didn't touch this\n   * widget's UI, the default value is used.\n   */\n  value: number | null\n}\n\ninterface SelectOption {\n  label: string\n  value: string\n}\n\n// Add a custom filterOptions method to filter options only based on labels.\n// The baseweb default method filters based on labels or indices\n// More details: https://github.com/streamlit/streamlit/issues/1010\n// Also filters using fuzzy search powered by fzy.js. Automatically handles\n// upper/lowercase.\nexport function fuzzyFilterSelectOptions(\n  options: SelectOption[],\n  pattern: string\n): readonly SelectOption[] {\n  if (!pattern) {\n    return options\n  }\n\n  const filteredOptions = options.filter((opt: SelectOption) =>\n    hasMatch(pattern, opt.label)\n  )\n  return sortBy(filteredOptions, (opt: SelectOption) =>\n    score(pattern, opt.label)\n  ).reverse()\n}\n\nexport class Selectbox extends React.PureComponent<Props, State> {\n  public state: State = {\n    isEmpty: false,\n    value: this.props.value,\n  }\n\n  componentDidUpdate(prevProps: Readonly<Props>): void {\n    if (\n      prevProps.value !== this.props.value &&\n      this.state.value !== this.props.value\n    ) {\n      this.setState((_, prevProps) => {\n        return { value: prevProps.value }\n      })\n    }\n  }\n\n  private onChange = (params: OnChangeParams): void => {\n    if (params.value.length === 0) {\n      this.setState({ value: null }, () => this.props.onChange(null))\n      return\n    }\n\n    const [selected] = params.value\n\n    this.setState({ value: parseInt(selected.value, 10) }, () =>\n      this.props.onChange(this.state.value)\n    )\n  }\n\n  /**\n   * Both onInputChange and onClose handle the situation where\n   * the user has hit backspace enough times that there's nothing\n   * left in the input, but we don't want the value for the input\n   * to then be invalid once they've clicked away\n   */\n  private onInputChange = (\n    event: React.ChangeEvent<HTMLInputElement>\n  ): void => {\n    const currentInput = event.target.value\n\n    this.setState({\n      isEmpty: !currentInput,\n    })\n  }\n\n  private onClose = (): void => {\n    this.setState({\n      isEmpty: false,\n    })\n  }\n\n  private filterOptions = (\n    options: readonly Option[],\n    filterValue: string\n  ): readonly Option[] =>\n    fuzzyFilterSelectOptions(options as SelectOption[], filterValue)\n\n  public render(): React.ReactNode {\n    const style = { width: this.props.width }\n    const { label, labelVisibility, help, placeholder, theme, clearable } =\n      this.props\n    let { disabled, options } = this.props\n\n    let value: Option[] = []\n\n    if (!isNullOrUndefined(this.state.value) && !this.state.isEmpty) {\n      value = [\n        {\n          label:\n            options.length > 0 ? options[this.state.value] : NO_OPTIONS_MSG,\n          value: this.state.value.toString(),\n        },\n      ]\n    }\n\n    if (options.length === 0) {\n      options = [NO_OPTIONS_MSG]\n      disabled = true\n    }\n\n    const selectOptions: SelectOption[] = options.map(\n      (option: string, index: number) => ({\n        label: option,\n        value: index.toString(),\n      })\n    )\n\n    // Check if we have more than 10 options in the selectbox.\n    // If that's true, we show the keyboard on mobile. If not, we hide it.\n    const showKeyboardOnMobile = options.length > 10\n\n    return (\n      <div\n        className=\"row-widget stSelectbox\"\n        data-testid=\"stSelectbox\"\n        style={style}\n      >\n        <WidgetLabel\n          label={label}\n          labelVisibility={labelVisibility}\n          disabled={disabled}\n        >\n          {help && (\n            <StyledWidgetLabelHelp>\n              <TooltipIcon content={help} placement={Placement.TOP_RIGHT} />\n            </StyledWidgetLabelHelp>\n          )}\n        </WidgetLabel>\n        <UISelect\n          disabled={disabled}\n          labelKey=\"label\"\n          aria-label={label || \"\"}\n          onChange={this.onChange}\n          onInputChange={this.onInputChange}\n          onClose={this.onClose}\n          options={selectOptions}\n          filterOptions={this.filterOptions}\n          clearable={clearable || false}\n          escapeClearsValue={clearable || false}\n          value={value}\n          valueKey=\"value\"\n          placeholder={placeholder}\n          overrides={{\n            Root: {\n              style: () => ({\n                lineHeight: theme.lineHeights.inputWidget,\n              }),\n            },\n            Dropdown: { component: VirtualDropdown },\n            ClearIcon: {\n              props: {\n                overrides: {\n                  Svg: {\n                    style: {\n                      color: theme.colors.darkGray,\n                      // Since the close icon is an SVG, and we can't control its viewbox nor its attributes,\n                      // Let's use a scale transform effect to make it bigger.\n                      // The width property only enlarges its bounding box, so it's easier to click.\n                      transform: \"scale(1.25)\",\n                      width: theme.spacing.twoXL,\n                      \":hover\": {\n                        fill: theme.colors.bodyText,\n                      },\n                    },\n                  },\n                },\n              },\n            },\n            ControlContainer: {\n              style: () => ({\n                height: theme.sizes.minElementHeight,\n                // Baseweb requires long-hand props, short-hand leads to weird bugs & warnings.\n                borderLeftWidth: theme.sizes.borderWidth,\n                borderRightWidth: theme.sizes.borderWidth,\n                borderTopWidth: theme.sizes.borderWidth,\n                borderBottomWidth: theme.sizes.borderWidth,\n              }),\n            },\n\n            IconsContainer: {\n              style: () => ({\n                paddingRight: theme.spacing.sm,\n              }),\n            },\n\n            ValueContainer: {\n              style: () => ({\n                // Baseweb requires long-hand props, short-hand leads to weird bugs & warnings.\n                paddingRight: theme.spacing.sm,\n                paddingLeft: theme.spacing.sm,\n                paddingBottom: theme.spacing.sm,\n                paddingTop: theme.spacing.sm,\n              }),\n            },\n\n            Input: {\n              props: {\n                // Change the 'readonly' prop to hide the mobile keyboard if options < 10\n                readOnly:\n                  isMobile && showKeyboardOnMobile === false\n                    ? \"readonly\"\n                    : null,\n              },\n              style: () => ({\n                lineHeight: theme.lineHeights.inputWidget,\n              }),\n            },\n\n            // Nudge the dropdown menu by 1px so the focus state doesn't get cut off\n            Popover: {\n              props: {\n                overrides: {\n                  Body: {\n                    style: () => ({\n                      marginTop: \"1px\",\n                    }),\n                  },\n                },\n              },\n            },\n\n            SelectArrow: {\n              component: ChevronDown,\n\n              props: {\n                overrides: {\n                  Svg: {\n                    style: () => ({\n                      width: iconSizes.xl,\n                      height: iconSizes.xl,\n                    }),\n                  },\n                },\n              },\n            },\n          }}\n        />\n      </div>\n    )\n  }\n}\n\nexport default withTheme(Selectbox)\n"],"mappings":"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"}