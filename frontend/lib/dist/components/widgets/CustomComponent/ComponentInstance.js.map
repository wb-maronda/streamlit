{"version":3,"file":"ComponentInstance.js","names":["React","useEffect","useState","useRef","withTheme","queryString","AlertElement","Skeleton","ErrorElement","Kind","useTimeout","SkeletonProto","DEFAULT_IFRAME_FEATURE_POLICY","DEFAULT_IFRAME_SANDBOX_POLICY","logWarning","COMMUNITY_URL","COMPONENT_DEVELOPER_URL","ensureError","createIframeMessageHandler","parseArgs","sendRenderMessage","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","COMPONENT_READY_WARNING_TIME_MS","getSrc","componentName","componentRegistry","url","src","getComponentURL","currentUrl","URL","window","location","href","stringifyUrl","query","streamlitUrl","origin","pathname","getWarnMessage","message","concat","tryParseArgs","jsonArgs","specialArgs","setComponentError","componentError","e","error","compareDataframeArgs","previousDataframeArgs","newDataframeArgs","length","every","previousDataframeArg","i","newDataframeArg","key","value","ComponentInstance","props","disabled","element","registry","theme","widgetMgr","width","fragmentId","parsedNewArgs","parsedDataframeArgs","parsedArgsRef","args","dataframeArgs","haveDataframeArgsChanged","current","isReadyTimeout","setIsReadyTimeout","frameHeight","setFrameHeight","isNaN","height","undefined","isReadyRef","iframeRef","onBackMsgRef","clearTimeoutLog","clearTimeoutWarningElement","_iframeRef$current","handleSetFrameHeight","toString","componentReadyCallback","_iframeRef$current2","isReady","frameHeightCallback","_iframeRef$current$co","_iframeRef$current3","contentWindow","registerListener","deregisterListener","name","loadingSkeleton","create","style","SkeletonStyle","ELEMENT","warns","body","kind","WARNING","children","allow","ref","colorScheme","display","scrolling","sandbox","title"],"sources":["../../../../src/components/widgets/CustomComponent/ComponentInstance.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement, useEffect, useState, useRef } from \"react\"\n\nimport { withTheme } from \"@emotion/react\"\nimport queryString from \"query-string\"\n\nimport AlertElement from \"@streamlit/lib/src/components/elements/AlertElement\"\nimport { Skeleton } from \"@streamlit/lib/src/components/elements/Skeleton\"\nimport ErrorElement from \"@streamlit/lib/src/components/shared/ErrorElement\"\nimport { Kind } from \"@streamlit/lib/src/components/shared/AlertContainer\"\nimport useTimeout from \"@streamlit/lib/src/hooks/useTimeout\"\nimport {\n  ComponentInstance as ComponentInstanceProto,\n  ISpecialArg,\n  Skeleton as SkeletonProto,\n} from \"@streamlit/lib/src/proto\"\nimport { EmotionTheme } from \"@streamlit/lib/src/theme\"\nimport {\n  DEFAULT_IFRAME_FEATURE_POLICY,\n  DEFAULT_IFRAME_SANDBOX_POLICY,\n} from \"@streamlit/lib/src/util/IFrameUtil\"\nimport { logWarning } from \"@streamlit/lib/src/util/log\"\nimport { WidgetStateManager } from \"@streamlit/lib/src/WidgetStateManager\"\nimport {\n  COMMUNITY_URL,\n  COMPONENT_DEVELOPER_URL,\n} from \"@streamlit/lib/src/urls\"\nimport { ensureError } from \"@streamlit/lib/src/util/ErrorHandling\"\n\nimport { ComponentRegistry } from \"./ComponentRegistry\"\nimport {\n  Args,\n  DataframeArg,\n  IframeMessageHandlerProps,\n  createIframeMessageHandler,\n  parseArgs,\n  sendRenderMessage,\n} from \"./componentUtils\"\n\n/**\n * If we haven't received a COMPONENT_READY message this many seconds\n * after the component has been created, explain to the user that there\n * may be a problem with their component, and offer troubleshooting advice.\n */\nexport const COMPONENT_READY_WARNING_TIME_MS = 60000 // 60 seconds\n\nexport interface Props {\n  registry: ComponentRegistry\n  widgetMgr: WidgetStateManager\n  disabled: boolean\n  element: ComponentInstanceProto\n  width: number\n  theme: EmotionTheme\n  fragmentId?: string\n}\n\n/**\n * Create the iFrame `src` based on the passed `url` or, if missing, from the ComponentRegistry. Adds a `streamlitUrl` query parameter.\n * @param componentName name of the component. Only used when `url` is empty\n * @param componentRegistry component registry to get the `url` for the passed component name if `url` is empty\n * @param url used as the `src` if passed\n * @returns the iFrame src including a `streamlitUrl` query parameter\n */\nfunction getSrc(\n  componentName: string,\n  componentRegistry: ComponentRegistry,\n  url?: string\n): string {\n  let src: string\n  if (url != null && url !== \"\") {\n    src = url\n  } else {\n    src = componentRegistry.getComponentURL(componentName, \"index.html\")\n  }\n\n  // Add streamlitUrl query parameter to src\n  const currentUrl = new URL(window.location.href)\n  src = queryString.stringifyUrl({\n    url: src,\n    query: { streamlitUrl: currentUrl.origin + currentUrl.pathname },\n  })\n  return src\n}\n\n/**\n * Creates a warn message. The message is different based on whether or not a `url` is provided.\n * @param componentName\n * @param url\n * @returns the created warn message\n */\nfunction getWarnMessage(componentName: string, url?: string): string {\n  let message: string\n  if (url && url !== \"\") {\n    message =\n      `Your app is having trouble loading the **${componentName}** component.` +\n      `\\nThe app is attempting to load the component from **${url}**,` +\n      `\\nand hasn't received its \\`Streamlit.setComponentReady()\\` message.` +\n      `\\n\\nIf this is a development build, have you started the dev server?` +\n      `\\n\\nFor more troubleshooting help, please see the [Streamlit Component docs](${COMPONENT_DEVELOPER_URL}) or visit our [forums](${COMMUNITY_URL}).`\n  } else {\n    message =\n      `Your app is having trouble loading the **${componentName}** component.` +\n      `\\n\\nIf this is an installed component that works locally, the app may be having trouble accessing the component frontend assets due to network latency or proxy settings in your app deployment.` +\n      `\\n\\nFor more troubleshooting help, please see the [Streamlit Component docs](${COMPONENT_DEVELOPER_URL}) or visit our [forums](${COMMUNITY_URL}).`\n  }\n  return message\n}\n\nfunction tryParseArgs(\n  jsonArgs: string,\n  specialArgs: ISpecialArg[],\n  setComponentError: (e: Error) => void,\n  componentError?: Error\n): [newArgs: Args, dataframeArgs: DataframeArg[]] {\n  if (!componentError) {\n    try {\n      return parseArgs(jsonArgs, specialArgs)\n    } catch (e) {\n      const error = ensureError(e)\n      setComponentError(error)\n    }\n  }\n\n  return [{}, []]\n}\n\n/**\n * Compare the two DataframeArg arrays\n *\n * @param previousDataframeArgs\n * @param newDataframeArgs\n * @returns true if the two DataframeArg arrays are equal or if all their key-value pairs (first level only) are equal\n */\nfunction compareDataframeArgs(\n  previousDataframeArgs: DataframeArg[],\n  newDataframeArgs: DataframeArg[]\n): boolean {\n  return (\n    previousDataframeArgs === newDataframeArgs ||\n    (previousDataframeArgs.length === newDataframeArgs.length &&\n      previousDataframeArgs.every((previousDataframeArg, i) => {\n        const newDataframeArg = newDataframeArgs[i]\n        return (\n          previousDataframeArg.key === newDataframeArg.key &&\n          previousDataframeArg.value === newDataframeArg.value\n        )\n      }))\n  )\n}\n\n/**\n * Render the component element. If an error occurs when parsing the arguments,\n * an error element is rendered instead. If the component assets take too long to load as specified\n * by {@link COMPONENT_READY_WARNING_TIME_MS}, a warning element is rendered instead.\n */\nfunction ComponentInstance(props: Props): ReactElement {\n  const [componentError, setComponentError] = useState<Error>()\n\n  const { disabled, element, registry, theme, widgetMgr, width, fragmentId } =\n    props\n  const { componentName, jsonArgs, specialArgs, url } = element\n\n  const [parsedNewArgs, parsedDataframeArgs] = tryParseArgs(\n    jsonArgs,\n    specialArgs,\n    setComponentError,\n    componentError\n  )\n\n  // Use a ref for the args so that we can use them inside the useEffect calls without the linter complaining\n  // as in the useEffect dependencies array, we don't use the parsed arg objects, but their string representation\n  // and a comparing function result for the jsonArgs and dataframeArgs, respectively, for deep-equal checks and to\n  // prevent calling useEffect too often\n  const parsedArgsRef = useRef<{ args: Args; dataframeArgs: DataframeArg[] }>({\n    args: {},\n    dataframeArgs: [],\n  })\n  const haveDataframeArgsChanged = compareDataframeArgs(\n    parsedArgsRef.current.dataframeArgs,\n    parsedDataframeArgs\n  )\n  parsedArgsRef.current.args = parsedNewArgs\n  parsedArgsRef.current.dataframeArgs = parsedDataframeArgs\n\n  const [isReadyTimeout, setIsReadyTimeout] = useState<boolean>()\n  // By passing the args.height here, we can derive the initial height for\n  // custom components that define a height property, e.g. in Python\n  // my_custom_component(height=100). undefined means no explicit height\n  // was specified, but will be set to the default height of 0.\n  const [frameHeight, setFrameHeight] = useState<number | undefined>(\n    isNaN(parsedNewArgs.height) ? undefined : parsedNewArgs.height\n  )\n\n  // Use a ref for the ready-state so that we can differentiate between sending renderMessages due to props-changes\n  // and when the componentReady callback is called (for the first time)\n  const isReadyRef = useRef<boolean>(false)\n  const iframeRef = useRef<HTMLIFrameElement>(null)\n  const onBackMsgRef = useRef<IframeMessageHandlerProps>()\n\n  // Show a log in the console as a soft-warning to the developer before showing the more disrupting warning element\n  const clearTimeoutLog = useTimeout(\n    () => logWarning(getWarnMessage(componentName, url)),\n    COMPONENT_READY_WARNING_TIME_MS / 4\n  )\n  const clearTimeoutWarningElement = useTimeout(\n    () => setIsReadyTimeout(true),\n    COMPONENT_READY_WARNING_TIME_MS\n  )\n\n  // Send a render message to the custom component everytime relevant props change, such as the\n  // input args or the theme / width\n  useEffect(() => {\n    if (!isReadyRef.current) {\n      return\n    }\n    sendRenderMessage(\n      parsedArgsRef.current.args,\n      parsedArgsRef.current.dataframeArgs,\n      disabled,\n      theme,\n      iframeRef.current ?? undefined\n    )\n  }, [disabled, frameHeight, haveDataframeArgsChanged, jsonArgs, theme, width])\n\n  useEffect(() => {\n    const handleSetFrameHeight = (height: number | undefined): void => {\n      if (height === undefined) {\n        logWarning(`handleSetFrameHeight: missing 'height' prop`)\n        return\n      }\n\n      if (height === frameHeight) {\n        // Nothing to do!\n        return\n      }\n\n      if (iframeRef.current == null) {\n        // This should not be possible.\n        logWarning(`handleSetFrameHeight: missing our iframeRef!`)\n        return\n      }\n\n      // We shove our new frameHeight directly into our iframe, to avoid\n      // triggering a re-render. Otherwise, components will receive the RENDER\n      // event several times during startup (because they will generally\n      // immediately change their frameHeight after mounting). This is wasteful,\n      // and it also breaks certain components.\n      iframeRef.current.height = height.toString()\n      setFrameHeight(height)\n    }\n\n    const componentReadyCallback = (): void => {\n      // Send a render message whenever the custom component sends a ready message\n      sendRenderMessage(\n        parsedArgsRef.current.args,\n        parsedArgsRef.current.dataframeArgs,\n        disabled,\n        theme,\n        iframeRef.current ?? undefined\n      )\n      clearTimeoutLog()\n      clearTimeoutWarningElement()\n      isReadyRef.current = true\n      setIsReadyTimeout(false)\n    }\n\n    // Update the reference fields for the callback that we\n    // passed to the componentRegistry\n    onBackMsgRef.current = {\n      // isReady is a callback to ensure the caller receives the latest value\n      isReady: () => isReadyRef.current,\n      element,\n      widgetMgr,\n      setComponentError,\n      componentReadyCallback,\n      frameHeightCallback: handleSetFrameHeight,\n      fragmentId,\n    }\n  }, [\n    componentName,\n    disabled,\n    element,\n    frameHeight,\n    haveDataframeArgsChanged,\n    isReadyTimeout,\n    jsonArgs,\n    theme,\n    widgetMgr,\n    clearTimeoutWarningElement,\n    clearTimeoutLog,\n    fragmentId,\n  ])\n\n  useEffect(() => {\n    const contentWindow: Window | undefined =\n      iframeRef.current?.contentWindow ?? undefined\n    if (!contentWindow) {\n      return\n    }\n    // By creating the callback using the reference variable, we\n    // can access up-to-date information from the component when the callback\n    // is called without the need to re-register the callback\n    registry.registerListener(\n      contentWindow,\n      createIframeMessageHandler(onBackMsgRef)\n    )\n\n    // De-register component when unmounting and when effect is re-running\n    return () => {\n      if (!contentWindow) {\n        return\n      }\n      registry.deregisterListener(contentWindow)\n    }\n  }, [registry, componentName])\n\n  if (componentError) {\n    return (\n      <ErrorElement\n        name={componentError.name}\n        message={componentError.message}\n      />\n    )\n  }\n\n  // Show the loading Skeleton while we have not received the ready message from the custom component\n  // but while we also have not waited until the ready timeout\n  const loadingSkeleton = !isReadyRef.current &&\n    !isReadyTimeout &&\n    // if height is explicitly set to 0, we donâ€™t want to show the skeleton at all\n    frameHeight !== 0 && (\n      // Skeletons will have a default height if no frameHeight was specified\n      <Skeleton\n        element={SkeletonProto.create({\n          height: frameHeight,\n          style: SkeletonProto.SkeletonStyle.ELEMENT,\n        })}\n      />\n    )\n\n  // If we've timed out waiting for the READY message from the component,\n  // display a warning.\n  const warns =\n    !isReadyRef.current && isReadyTimeout ? (\n      <AlertElement\n        width={width}\n        body={getWarnMessage(componentName, url)}\n        kind={Kind.WARNING}\n      />\n    ) : null\n\n  // Render the iframe. We set scrolling=\"no\", because we don't want\n  // scrollbars to appear; instead, we want components to properly auto-size\n  // themselves.\n  //\n  // Without this, there is a potential for a scrollbar to\n  // appear for a brief moment after an iframe's content gets bigger,\n  // and before it sends the \"setFrameHeight\" message back to Streamlit.\n  //\n  // We may ultimately want to give components control over the \"scrolling\"\n  // property.\n  //\n  // While the custom component is not in ready-state, show the loading Skeletion instead\n  //\n  // TODO: make sure horizontal scrolling still works!\n  return (\n    <>\n      {loadingSkeleton}\n      {warns}\n      <iframe\n        allow={DEFAULT_IFRAME_FEATURE_POLICY}\n        ref={iframeRef}\n        src={getSrc(componentName, registry, url)}\n        width={width}\n        // for undefined height we set the height to 0 to avoid inconsistent behavior\n        height={frameHeight ?? 0}\n        style={{\n          colorScheme: \"normal\",\n          display: isReadyRef.current ? \"initial\" : \"none\",\n        }}\n        scrolling=\"no\"\n        sandbox={DEFAULT_IFRAME_SANDBOX_POLICY}\n        title={componentName}\n      />\n    </>\n  )\n}\n\nexport default withTheme(ComponentInstance)\n"],"mappings":"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"}