{"version":3,"file":"FormSubmitButton.test.js","names":["React","screen","fireEvent","render","enableAllPlugins","Button","ButtonProto","createFormsData","WidgetStateManager","FormSubmitButton","jsx","_jsx","describe","formsData","widgetMgr","beforeEach","sendRerunBackMsg","jest","fn","formsDataChanged","newData","getProps","props","arguments","length","undefined","useContainerWidth","helpText","element","create","id","label","formId","help","disabled","hasInProgressUpload","width","it","expect","getByRole","toBeInTheDocument","formSubmitButton","getByTestId","toHaveClass","toHaveStyle","concat","name","spyOn","click","submitForm","toHaveBeenCalledWith","fragmentId","toBeDisabled","_formsData$submitButt","_formsData$submitButt2","_formsData$submitButt3","_formsData$submitButt4","submitButtons","get","toBeUndefined","props2","unmount","unmountView1","toBe","toEqual","unmountView2"],"sources":["../../../../src/components/widgets/Form/FormSubmitButton.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\"\nimport \"@testing-library/jest-dom\"\nimport { screen, fireEvent } from \"@testing-library/react\"\nimport { render } from \"@streamlit/lib/src/test_util\"\n\nimport { enableAllPlugins } from \"immer\"\n\nimport { Button as ButtonProto } from \"@streamlit/lib/src/proto\"\n\nimport {\n  createFormsData,\n  FormsData,\n  WidgetStateManager,\n} from \"@streamlit/lib/src/WidgetStateManager\"\nimport { FormSubmitButton, Props } from \"./FormSubmitButton\"\n\n// Required by ImmerJS\nenableAllPlugins()\n\ndescribe(\"FormSubmitButton\", () => {\n  let formsData: FormsData\n  let widgetMgr: WidgetStateManager\n\n  beforeEach(() => {\n    formsData = createFormsData()\n    widgetMgr = new WidgetStateManager({\n      sendRerunBackMsg: jest.fn(),\n      formsDataChanged: jest.fn(newData => {\n        formsData = newData\n      }),\n    })\n  })\n\n  function getProps(\n    props: Partial<Props> = {},\n    useContainerWidth = false,\n    helpText = \"mockHelpText\"\n  ): Props {\n    return {\n      element: ButtonProto.create({\n        id: \"1\",\n        label: \"Submit\",\n        formId: \"mockFormId\",\n        help: helpText,\n        useContainerWidth,\n      }),\n      disabled: false,\n      hasInProgressUpload: false,\n      width: 250,\n      widgetMgr,\n      ...props,\n    }\n  }\n\n  it(\"renders without crashing\", () => {\n    render(<FormSubmitButton {...getProps()} />)\n    expect(screen.getByRole(\"button\")).toBeInTheDocument()\n  })\n\n  it(\"has correct className and style\", () => {\n    const props = getProps()\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByTestId(\"stFormSubmitButton\")\n\n    expect(formSubmitButton).toHaveClass(\"row-widget\")\n    expect(formSubmitButton).toHaveClass(\"stButton\")\n    expect(formSubmitButton).toHaveStyle(`width: ${props.width}px`)\n  })\n\n  it(\"renders a label\", () => {\n    const props = getProps()\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByRole(\"button\", {\n      name: `${props.element.label}`,\n    })\n\n    expect(formSubmitButton).toBeInTheDocument()\n  })\n\n  it(\"calls submitForm when clicked\", async () => {\n    const props = getProps()\n    jest.spyOn(props.widgetMgr, \"submitForm\")\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n\n    fireEvent.click(formSubmitButton)\n    expect(props.widgetMgr.submitForm).toHaveBeenCalledWith(\n      props.element.formId,\n      undefined,\n      props.element\n    )\n  })\n\n  it(\"can pass fragmentId to submitForm\", async () => {\n    const props = getProps({ fragmentId: \"myFragmentId\" })\n    jest.spyOn(props.widgetMgr, \"submitForm\")\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n\n    fireEvent.click(formSubmitButton)\n    expect(props.widgetMgr.submitForm).toHaveBeenCalledWith(\n      props.element.formId,\n      \"myFragmentId\",\n      props.element\n    )\n  })\n\n  it(\"is disabled when form has pending upload\", () => {\n    const props = getProps({ hasInProgressUpload: true })\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n    expect(formSubmitButton).toBeDisabled()\n  })\n\n  it(\"Adds the proto to submitButtons on mount and removes the proto on unmount\", () => {\n    expect(formsData.submitButtons.get(\"mockFormId\")).toBeUndefined()\n\n    const props = getProps()\n    const props2 = getProps({\n      element: ButtonProto.create({\n        id: \"2\",\n        label: \"Submit\",\n        formId: \"mockFormId\",\n        help: \"mockHelpText\",\n      }),\n    })\n\n    const { unmount: unmountView1 } = render(<FormSubmitButton {...props} />)\n\n    expect(formsData.submitButtons.get(\"mockFormId\")?.length).toBe(1)\n    // @ts-expect-error\n    expect(formsData.submitButtons.get(\"mockFormId\")[0]).toEqual(props.element)\n\n    const { unmount: unmountView2 } = render(<FormSubmitButton {...props2} />)\n\n    expect(formsData.submitButtons.get(\"mockFormId\")?.length).toBe(2)\n    // @ts-expect-error\n    expect(formsData.submitButtons.get(\"mockFormId\")[1]).toEqual(\n      props2.element\n    )\n\n    unmountView1()\n\n    expect(formsData.submitButtons.get(\"mockFormId\")?.length).toBe(1)\n    // @ts-expect-error\n    expect(formsData.submitButtons.get(\"mockFormId\")[0]).toEqual(\n      props2.element\n    )\n\n    unmountView2()\n\n    expect(formsData.submitButtons.get(\"mockFormId\")?.length).toBe(0)\n  })\n\n  it(\"does not use container width by default\", () => {\n    render(<FormSubmitButton {...getProps()} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n    expect(formSubmitButton).toHaveStyle(\"width: auto\")\n  })\n\n  it(\"passes useContainerWidth property with help correctly\", () => {\n    render(<FormSubmitButton {...getProps({}, true)} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n    expect(formSubmitButton).toHaveStyle(`width: ${250}px`)\n  })\n\n  it(\"passes useContainerWidth property without help correctly\", () => {\n    render(<FormSubmitButton {...getProps({}, true, \"\")} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n    expect(formSubmitButton).toHaveStyle(\"width: 100%\")\n  })\n})\n"],"mappings":"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"}