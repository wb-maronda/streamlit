{"version":3,"file":"FormSubmitButton.test.js","names":["React","fireEvent","screen","enableAllPlugins","render","Button","ButtonProto","createFormsData","WidgetStateManager","FormSubmitButton","jsx","_jsx","describe","formsData","widgetMgr","beforeEach","sendRerunBackMsg","jest","fn","formsDataChanged","newData","getProps","props","arguments","length","undefined","elementProps","element","create","id","label","formId","help","useContainerWidth","disabled","hasInProgressUpload","width","it","expect","getByRole","toBeInTheDocument","formSubmitButton","getByTestId","toHaveClass","toHaveStyle","name","spyOn","click","submitForm","toHaveBeenCalledWith","fragmentId","toBeDisabled","submitButtons","get","toBeUndefined","props2","unmount","unmountView1","toBe","toEqual","unmountView2"],"sources":["../../../../src/components/widgets/Form/FormSubmitButton.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\"\n\nimport \"@testing-library/jest-dom\"\nimport { fireEvent, screen } from \"@testing-library/react\"\nimport { enableAllPlugins } from \"immer\"\n\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport { Button as ButtonProto } from \"@streamlit/lib/src/proto\"\nimport {\n  createFormsData,\n  FormsData,\n  WidgetStateManager,\n} from \"@streamlit/lib/src/WidgetStateManager\"\n\nimport { FormSubmitButton, Props } from \"./FormSubmitButton\"\n\n// Required by ImmerJS\nenableAllPlugins()\n\ndescribe(\"FormSubmitButton\", () => {\n  let formsData: FormsData\n  let widgetMgr: WidgetStateManager\n\n  beforeEach(() => {\n    formsData = createFormsData()\n    widgetMgr = new WidgetStateManager({\n      sendRerunBackMsg: jest.fn(),\n      formsDataChanged: jest.fn(newData => {\n        formsData = newData\n      }),\n    })\n  })\n\n  function getProps(\n    props: Partial<Props> = {},\n    elementProps: Partial<ButtonProto> = {}\n  ): Props {\n    return {\n      element: ButtonProto.create({\n        id: \"1\",\n        label: \"Submit\",\n        formId: \"mockFormId\",\n        help: \"mockHelpText\",\n        useContainerWidth: false,\n        ...elementProps,\n      }),\n      disabled: false,\n      hasInProgressUpload: false,\n      width: 250,\n      widgetMgr,\n      ...props,\n    }\n  }\n\n  it(\"renders without crashing\", () => {\n    render(<FormSubmitButton {...getProps()} />)\n    expect(screen.getByRole(\"button\")).toBeInTheDocument()\n  })\n\n  it(\"has correct className and style\", () => {\n    const props = getProps()\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByTestId(\"stFormSubmitButton\")\n\n    expect(formSubmitButton).toHaveClass(\"stFormSubmitButton\")\n    expect(formSubmitButton).toHaveStyle(`width: ${props.width}px`)\n  })\n\n  it(\"renders a label within the button\", () => {\n    const props = getProps()\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByRole(\"button\", {\n      name: `${props.element.label}`,\n    })\n\n    expect(formSubmitButton).toBeInTheDocument()\n  })\n\n  it(\"calls submitForm when clicked\", async () => {\n    const props = getProps()\n    jest.spyOn(props.widgetMgr, \"submitForm\")\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n\n    fireEvent.click(formSubmitButton)\n    expect(props.widgetMgr.submitForm).toHaveBeenCalledWith(\n      props.element.formId,\n      undefined,\n      props.element\n    )\n  })\n\n  it(\"can pass fragmentId to submitForm\", async () => {\n    const props = getProps({ fragmentId: \"myFragmentId\" })\n    jest.spyOn(props.widgetMgr, \"submitForm\")\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n\n    fireEvent.click(formSubmitButton)\n    expect(props.widgetMgr.submitForm).toHaveBeenCalledWith(\n      props.element.formId,\n      \"myFragmentId\",\n      props.element\n    )\n  })\n\n  it(\"is disabled when form has pending upload\", () => {\n    const props = getProps({ hasInProgressUpload: true })\n    render(<FormSubmitButton {...props} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n    expect(formSubmitButton).toBeDisabled()\n  })\n\n  it(\"Adds the proto to submitButtons on mount and removes the proto on unmount\", () => {\n    expect(formsData.submitButtons.get(\"mockFormId\")).toBeUndefined()\n\n    const props = getProps()\n    const props2 = getProps({\n      element: ButtonProto.create({\n        id: \"2\",\n        label: \"Submit\",\n        formId: \"mockFormId\",\n        help: \"mockHelpText\",\n      }),\n    })\n\n    const { unmount: unmountView1 } = render(<FormSubmitButton {...props} />)\n\n    expect(formsData.submitButtons.get(\"mockFormId\")?.length).toBe(1)\n    // @ts-expect-error\n    expect(formsData.submitButtons.get(\"mockFormId\")[0]).toEqual(props.element)\n\n    const { unmount: unmountView2 } = render(<FormSubmitButton {...props2} />)\n\n    expect(formsData.submitButtons.get(\"mockFormId\")?.length).toBe(2)\n    // @ts-expect-error\n    expect(formsData.submitButtons.get(\"mockFormId\")[1]).toEqual(\n      props2.element\n    )\n\n    unmountView1()\n\n    expect(formsData.submitButtons.get(\"mockFormId\")?.length).toBe(1)\n    // @ts-expect-error\n    expect(formsData.submitButtons.get(\"mockFormId\")[0]).toEqual(\n      props2.element\n    )\n\n    unmountView2()\n\n    expect(formsData.submitButtons.get(\"mockFormId\")?.length).toBe(0)\n  })\n\n  it(\"does not use container width by default\", () => {\n    render(<FormSubmitButton {...getProps()} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n    expect(formSubmitButton).toHaveStyle(\"width: auto\")\n  })\n\n  it(\"passes useContainerWidth property with help correctly\", () => {\n    render(<FormSubmitButton {...getProps({}, { useContainerWidth: true })} />)\n\n    const formSubmitButton = screen.getByRole(\"button\")\n    expect(formSubmitButton).toHaveStyle(`width: ${250}px`)\n  })\n\n  it(\"passes useContainerWidth property without help correctly\", () => {\n    render(\n      <FormSubmitButton\n        {...getProps({}, { useContainerWidth: true, help: \"\" })}\n      />\n    )\n\n    const formSubmitButton = screen.getByRole(\"button\")\n    expect(formSubmitButton).toHaveStyle(\"width: 100%\")\n  })\n})\n"],"mappings":"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"}