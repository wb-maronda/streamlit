{"version":3,"file":"ColorPicker.test.js","names":["React","screen","fireEvent","render","ColorPicker","ColorPickerProto","WidgetStateManager","jsx","_jsx","getProps","elementProps","arguments","length","undefined","widgetProps","element","create","id","label","default","width","disabled","widgetMgr","sendRerunBackMsg","jest","fn","formsDataChanged","describe","it","props","colorPicker","getByTestId","expect","toBeInTheDocument","spyOn","setStringValue","toHaveBeenCalledWith","fromUi","fragmentId","colorBlock","click","toHaveStyle","colorInput","getByRole","toHaveValue","newColor","change","target","value","toHaveBeenLastCalledWith","formId","setFormClearOnSubmit","concat","submitForm"],"sources":["../../../../src/components/widgets/ColorPicker/ColorPicker.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\nimport \"@testing-library/jest-dom\"\nimport { screen, fireEvent } from \"@testing-library/react\"\nimport { render } from \"@streamlit/lib/src/test_util\"\n\nimport { ColorPicker as ColorPickerProto } from \"@streamlit/lib/src/proto\"\nimport { WidgetStateManager } from \"@streamlit/lib/src/WidgetStateManager\"\n\nimport ColorPicker, { Props } from \"./ColorPicker\"\n\nconst getProps = (\n  elementProps: Partial<ColorPickerProto> = {},\n  widgetProps: Partial<Props> = {}\n): Props => ({\n  element: ColorPickerProto.create({\n    id: \"1\",\n    label: \"Label\",\n    default: \"#000000\",\n    ...elementProps,\n  }),\n  width: 0,\n  disabled: false,\n  widgetMgr: new WidgetStateManager({\n    sendRerunBackMsg: jest.fn(),\n    formsDataChanged: jest.fn(),\n  }),\n  ...widgetProps,\n})\n\ndescribe(\"ColorPicker widget\", () => {\n  it(\"renders without crashing\", () => {\n    const props = getProps()\n    render(<ColorPicker {...props} />)\n    const colorPicker = screen.getByTestId(\"stColorPicker\")\n    expect(colorPicker).toBeInTheDocument()\n  })\n\n  it(\"sets widget value on mount\", () => {\n    const props = getProps()\n    jest.spyOn(props.widgetMgr, \"setStringValue\")\n\n    render(<ColorPicker {...props} />)\n\n    expect(props.widgetMgr.setStringValue).toHaveBeenCalledWith(\n      props.element,\n      props.element.default,\n      { fromUi: false },\n      undefined\n    )\n  })\n\n  it(\"can pass fragmentId to setStringValue\", () => {\n    const props = getProps(undefined, { fragmentId: \"myFragmentId\" })\n    jest.spyOn(props.widgetMgr, \"setStringValue\")\n\n    render(<ColorPicker {...props} />)\n\n    expect(props.widgetMgr.setStringValue).toHaveBeenCalledWith(\n      props.element,\n      props.element.default,\n      { fromUi: false },\n      \"myFragmentId\"\n    )\n  })\n\n  it(\"renders a default color in the preview and the color picker\", () => {\n    const props = getProps()\n    render(<ColorPicker {...props} />)\n\n    const colorBlock = screen.getByTestId(\"stColorBlock\")\n    fireEvent.click(colorBlock)\n    expect(colorBlock).toHaveStyle(\"background-color: #000000\")\n\n    const colorInput = screen.getByRole(\"textbox\")\n    expect(colorInput).toHaveValue(\"#000000\")\n  })\n\n  it(\"updates its widget value when it's changed\", () => {\n    const props = getProps()\n    jest.spyOn(props.widgetMgr, \"setStringValue\")\n\n    render(<ColorPicker {...props} />)\n\n    const newColor = \"#e91e63\"\n    const colorBlock = screen.getByTestId(\"stColorBlock\")\n    fireEvent.click(colorBlock)\n\n    // Our widget should be updated.\n    const colorInput = screen.getByRole(\"textbox\")\n    fireEvent.change(colorInput, { target: { value: newColor } })\n    // Close out of the popover\n    fireEvent.click(colorBlock)\n\n    // And the WidgetMgr should also be updated.\n    expect(props.widgetMgr.setStringValue).toHaveBeenLastCalledWith(\n      props.element,\n      newColor,\n      { fromUi: true },\n      undefined\n    )\n  })\n\n  it(\"resets its value when form is cleared\", () => {\n    // Create a widget in a clearOnSubmit form\n    const props = getProps({ formId: \"form\" })\n    jest.spyOn(props.widgetMgr, \"setStringValue\")\n    props.widgetMgr.setFormClearOnSubmit(\"form\", true)\n\n    render(<ColorPicker {...props} />)\n\n    // Choose a new color\n    const newColor = \"#e91e63\"\n    const colorBlock = screen.getByTestId(\"stColorBlock\")\n    fireEvent.click(colorBlock)\n\n    // Update the color\n    const colorInput = screen.getByRole(\"textbox\")\n    fireEvent.change(colorInput, { target: { value: newColor } })\n    // Close out of the popover\n    fireEvent.click(colorBlock)\n\n    expect(colorInput).toHaveValue(newColor)\n    expect(colorBlock).toHaveStyle(`background-color: ${newColor}`)\n    expect(props.widgetMgr.setStringValue).toHaveBeenLastCalledWith(\n      props.element,\n      newColor,\n      { fromUi: true },\n      undefined\n    )\n\n    // \"Submit\" the form\n    props.widgetMgr.submitForm(\"form\", undefined)\n\n    // Our widget should be reset, and the widgetMgr should be updated\n    expect(colorBlock).toHaveStyle(\"background-color: #000000\")\n    expect(props.widgetMgr.setStringValue).toHaveBeenLastCalledWith(\n      props.element,\n      props.element.default,\n      {\n        fromUi: true,\n      },\n      undefined\n    )\n  })\n})\n"],"mappings":"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"}