{"version":3,"file":"TextArea.js","names":["React","Textarea","UITextArea","withTheme","uniqueId","FormClearHelper","InputInstructions","WidgetLabel","StyledWidgetLabelHelp","TooltipIcon","Placement","isInForm","labelVisibilityProtoValueToEnum","breakpoints","jsx","_jsx","jsxs","_jsxs","TextArea","PureComponent","initialValue","_ref","storedValue","props","widgetMgr","getStringValue","element","default","constructor","formClearHelper","id","state","dirty","value","commitWidgetValue","source","fragmentId","setStringValue","setState","onFormCleared","_","prevProps","_prevProps$element$de","fromUi","onBlur","onChange","e","target","maxChars","length","isEnterKeyPressed","event","_event$nativeEvent","keyCode","key","nativeEvent","isComposing","onKeyDown","metaKey","ctrlKey","preventDefault","formId","submitForm","componentDidMount","setValue","updateFromProtobuf","componentDidUpdate","maybeUpdateFromProtobuf","componentWillUnmount","disconnect","render","_element$labelVisibil","disabled","width","theme","style","height","placeholder","manageFormClearListener","className","children","label","labelVisibility","htmlFor","help","content","placement","TOP_RIGHT","overrides","Input","lineHeight","lineHeights","inputWidget","concat","minHeight","resize","opacity","paddingRight","spacing","lg","paddingLeft","paddingBottom","paddingTop","Root","borderLeftWidth","sizes","borderWidth","borderRightWidth","borderTopWidth","borderBottomWidth","hideWidgetDetails","maxLength","type","inForm"],"sources":["../../../../src/components/widgets/TextArea/TextArea.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\nimport { Textarea as UITextArea } from \"baseui/textarea\"\nimport { withTheme } from \"@emotion/react\"\nimport uniqueId from \"lodash/uniqueId\"\n\nimport { TextArea as TextAreaProto } from \"@streamlit/lib/src/proto\"\nimport { FormClearHelper } from \"@streamlit/lib/src/components/widgets/Form\"\nimport {\n  WidgetStateManager,\n  Source,\n} from \"@streamlit/lib/src/WidgetStateManager\"\nimport InputInstructions from \"@streamlit/lib/src/components/shared/InputInstructions/InputInstructions\"\nimport {\n  WidgetLabel,\n  StyledWidgetLabelHelp,\n} from \"@streamlit/lib/src/components/widgets/BaseWidget\"\nimport TooltipIcon from \"@streamlit/lib/src/components/shared/TooltipIcon\"\nimport { Placement } from \"@streamlit/lib/src/components/shared/Tooltip\"\nimport {\n  isInForm,\n  labelVisibilityProtoValueToEnum,\n} from \"@streamlit/lib/src/util/utils\"\nimport { breakpoints } from \"@streamlit/lib/src/theme/primitives\"\nimport { EmotionTheme } from \"@streamlit/lib/src/theme\"\n\nexport interface Props {\n  disabled: boolean\n  element: TextAreaProto\n  widgetMgr: WidgetStateManager\n  width: number\n  theme: EmotionTheme\n  fragmentId?: string\n}\n\ninterface State {\n  /**\n   * True if the user-specified state.value has not yet been synced to the WidgetStateManager.\n   */\n  dirty: boolean\n\n  /**\n   * The value specified by the user via the UI. If the user didn't touch this\n   * widget's UI, the default value is used.\n   */\n  value: string | null\n}\n\nclass TextArea extends React.PureComponent<Props, State> {\n  private readonly formClearHelper = new FormClearHelper()\n\n  private readonly id: string\n\n  public state: State = {\n    dirty: false,\n    value: this.initialValue,\n  }\n\n  get initialValue(): string | null {\n    // If WidgetStateManager knew a value for this widget, initialize to that.\n    // Otherwise, use the default value from the widget protobuf.\n    const storedValue = this.props.widgetMgr.getStringValue(this.props.element)\n    return storedValue ?? this.props.element.default ?? null\n  }\n\n  constructor(props: Props) {\n    super(props)\n    this.id = uniqueId(\"text_area_\")\n  }\n\n  public componentDidMount(): void {\n    if (this.props.element.setValue) {\n      this.updateFromProtobuf()\n    } else {\n      this.commitWidgetValue({ fromUi: false })\n    }\n  }\n\n  public componentDidUpdate(): void {\n    this.maybeUpdateFromProtobuf()\n  }\n\n  public componentWillUnmount(): void {\n    this.formClearHelper.disconnect()\n  }\n\n  private maybeUpdateFromProtobuf(): void {\n    const { setValue } = this.props.element\n    if (setValue) {\n      this.updateFromProtobuf()\n    }\n  }\n\n  private updateFromProtobuf(): void {\n    const { value } = this.props.element\n    this.props.element.setValue = false\n    this.setState({ value: value ?? null }, () => {\n      this.commitWidgetValue({ fromUi: false })\n    })\n  }\n\n  /** Commit state.value to the WidgetStateManager. */\n  private commitWidgetValue = (source: Source): void => {\n    const { widgetMgr, element, fragmentId } = this.props\n    widgetMgr.setStringValue(element, this.state.value, source, fragmentId)\n    this.setState({ dirty: false })\n  }\n\n  /**\n   * If we're part of a clear_on_submit form, this will be called when our\n   * form is submitted. Restore our default value and update the WidgetManager.\n   */\n  private onFormCleared = (): void => {\n    this.setState(\n      (_, prevProps) => {\n        return { value: prevProps.element.default ?? null }\n      },\n      () => this.commitWidgetValue({ fromUi: true })\n    )\n  }\n\n  private onBlur = (): void => {\n    if (this.state.dirty) {\n      this.commitWidgetValue({ fromUi: true })\n    }\n  }\n\n  private onChange = (e: React.ChangeEvent<HTMLTextAreaElement>): void => {\n    const { value } = e.target\n    const { element } = this.props\n    const { maxChars } = element\n\n    if (maxChars !== 0 && value.length > maxChars) {\n      return\n    }\n\n    // mark it dirty but don't update its value in the WidgetMgr\n    // This means that individual keypresses won't trigger a script re-run.\n    this.setState({ dirty: true, value })\n  }\n\n  isEnterKeyPressed = (\n    event: React.KeyboardEvent<HTMLTextAreaElement>\n  ): boolean => {\n    const { keyCode, key } = event\n\n    // Using keyCode as well due to some different behaviors on Windows\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=79407\n    return (\n      (key === \"Enter\" || keyCode === 13 || keyCode === 10) &&\n      // Do not send the sentence being composed when Enter is typed into the IME.\n      !(event.nativeEvent?.isComposing === true)\n    )\n  }\n\n  private onKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>): void => {\n    const { metaKey, ctrlKey } = e\n    const { dirty } = this.state\n\n    if (this.isEnterKeyPressed(e) && (ctrlKey || metaKey) && dirty) {\n      e.preventDefault()\n\n      this.commitWidgetValue({ fromUi: true })\n      const { formId } = this.props.element\n      if (isInForm({ formId })) {\n        this.props.widgetMgr.submitForm(\n          this.props.element.formId,\n          this.props.fragmentId\n        )\n      }\n    }\n  }\n\n  public render(): React.ReactNode {\n    const { element, disabled, width, widgetMgr, theme } = this.props\n    const { value, dirty } = this.state\n    const style = { width }\n    const { height, placeholder } = element\n\n    // Manage our form-clear event handler.\n    this.formClearHelper.manageFormClearListener(\n      widgetMgr,\n      element.formId,\n      this.onFormCleared\n    )\n\n    return (\n      <div className=\"stTextArea\" data-testid=\"stTextArea\" style={style}>\n        <WidgetLabel\n          label={element.label}\n          disabled={disabled}\n          labelVisibility={labelVisibilityProtoValueToEnum(\n            element.labelVisibility?.value\n          )}\n          htmlFor={this.id}\n        >\n          {element.help && (\n            <StyledWidgetLabelHelp>\n              <TooltipIcon\n                content={element.help}\n                placement={Placement.TOP_RIGHT}\n              />\n            </StyledWidgetLabelHelp>\n          )}\n        </WidgetLabel>\n        <UITextArea\n          value={value ?? \"\"}\n          placeholder={placeholder}\n          onBlur={this.onBlur}\n          onChange={this.onChange}\n          onKeyDown={this.onKeyDown}\n          aria-label={element.label}\n          disabled={disabled}\n          id={this.id}\n          overrides={{\n            Input: {\n              style: {\n                lineHeight: theme.lineHeights.inputWidget,\n                height: height ? `${height}px` : \"\",\n                minHeight: \"95px\",\n                resize: \"vertical\",\n                \"::placeholder\": {\n                  opacity: \"0.7\",\n                },\n                // Baseweb requires long-hand props, short-hand leads to weird bugs & warnings.\n                paddingRight: theme.spacing.lg,\n                paddingLeft: theme.spacing.lg,\n                paddingBottom: theme.spacing.lg,\n                paddingTop: theme.spacing.lg,\n              },\n            },\n            Root: {\n              props: {\n                \"data-testid\": \"stTextInput-RootElement\",\n              },\n              style: {\n                // Baseweb requires long-hand props, short-hand leads to weird bugs & warnings.\n                borderLeftWidth: theme.sizes.borderWidth,\n                borderRightWidth: theme.sizes.borderWidth,\n                borderTopWidth: theme.sizes.borderWidth,\n                borderBottomWidth: theme.sizes.borderWidth,\n              },\n            },\n          }}\n        />\n        {/* Hide the \"Please enter to apply\" text in small widget sizes */}\n        {width > breakpoints.hideWidgetDetails && (\n          <InputInstructions\n            dirty={dirty}\n            value={value ?? \"\"}\n            maxLength={element.maxChars}\n            type={\"multiline\"}\n            inForm={isInForm({ formId: element.formId })}\n          />\n        )}\n      </div>\n    )\n  }\n}\n\nexport default withTheme(TextArea)\n"],"mappings":"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"}