{"version":3,"file":"useDataLoader.test.js","names":["React","renderHook","GridCellKind","Quiver","Arrow","ArrowProto","UNICODE","isErrorCell","TextColumn","EditingState","useDataLoader","MOCK_COLUMNS","arrowType","meta","numpy_type","pandas_type","id","name","indexNumber","isEditable","isHidden","isIndex","isStretched","title","columnTypeOptions","undefined","describe","it","element","create","data","numRows","dimensions","rows","result","editingState","useRef","expect","getCellValue","current","getCellContent","toBe","editingMode","EditingMode","FIXED","setCell","kind","Text","displayData","allowOverlay","toEqual","DYNAMIC","deleteRow"],"sources":["../../../../../src/components/widgets/DataFrame/hooks/useDataLoader.test.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport { renderHook } from \"@testing-library/react-hooks\"\nimport { GridCellKind } from \"@glideapps/glide-data-grid\"\n\nimport { Quiver } from \"@streamlit/lib/src/dataframes/Quiver\"\nimport { Arrow as ArrowProto } from \"@streamlit/lib/src/proto\"\nimport { UNICODE } from \"@streamlit/lib/src/mocks/arrow\"\nimport {\n  BaseColumn,\n  isErrorCell,\n  TextColumn,\n} from \"@streamlit/lib/src/components/widgets/DataFrame/columns\"\nimport EditingState from \"@streamlit/lib/src/components/widgets/DataFrame/EditingState\"\n\nimport useDataLoader from \"./useDataLoader\"\n\n// These columns are based on the UNICODE mock arrow table:\nconst MOCK_COLUMNS: BaseColumn[] = [\n  TextColumn({\n    arrowType: { meta: null, numpy_type: \"object\", pandas_type: \"unicode\" },\n    id: \"index-0\",\n    name: \"\",\n    indexNumber: 0,\n    isEditable: true,\n    isHidden: false,\n    isIndex: true,\n    isStretched: false,\n    title: \"\",\n  }),\n  TextColumn({\n    arrowType: { meta: null, numpy_type: \"object\", pandas_type: \"unicode\" },\n    id: \"column-c1-0\",\n    name: \"c1\",\n    indexNumber: 1,\n    isEditable: true,\n    isHidden: false,\n    isIndex: false,\n    isStretched: false,\n    title: \"c1\",\n  }),\n  TextColumn({\n    arrowType: { meta: null, numpy_type: \"object\", pandas_type: \"unicode\" },\n    columnTypeOptions: undefined,\n    id: \"column-c2-1\",\n    name: \"c2\",\n    indexNumber: 2,\n    isEditable: true,\n    isHidden: false,\n    isIndex: false,\n    isStretched: false,\n    title: \"c2\",\n  }),\n]\n\ndescribe(\"useDataLoader hook\", () => {\n  it(\"creates a glide-data-grid compatible callback to access cells\", () => {\n    const element = ArrowProto.create({\n      data: UNICODE,\n    })\n    const data = new Quiver(element)\n    const numRows = data.dimensions.rows\n\n    const { result } = renderHook(() => {\n      const editingState = React.useRef<EditingState>(\n        new EditingState(numRows)\n      )\n      return useDataLoader(data, MOCK_COLUMNS, numRows, editingState)\n    })\n\n    // Row 1\n    expect(\n      MOCK_COLUMNS[0].getCellValue(result.current.getCellContent([0, 0]))\n    ).toBe(\"i1\")\n    expect(\n      MOCK_COLUMNS[1].getCellValue(result.current.getCellContent([1, 0]))\n    ).toBe(\"foo\")\n    expect(\n      MOCK_COLUMNS[2].getCellValue(result.current.getCellContent([2, 0]))\n    ).toBe(\"1\")\n\n    // Row 2\n    expect(\n      MOCK_COLUMNS[0].getCellValue(result.current.getCellContent([0, 1]))\n    ).toBe(\"i2\")\n    expect(\n      MOCK_COLUMNS[1].getCellValue(result.current.getCellContent([1, 1]))\n    ).toBe(\"bar\")\n    expect(\n      MOCK_COLUMNS[2].getCellValue(result.current.getCellContent([2, 1]))\n    ).toBe(\"2\")\n\n    // if row out of bounds. return error cell\n    expect(isErrorCell(result.current.getCellContent([0, 2]))).toBe(true)\n\n    // if column out of bounds. return error cell\n    expect(isErrorCell(result.current.getCellContent([3, 0]))).toBe(true)\n  })\n\n  it(\"uses editing state if a cell got edited\", () => {\n    const element = ArrowProto.create({\n      data: UNICODE,\n      editingMode: ArrowProto.EditingMode.FIXED,\n    })\n\n    const data = new Quiver(element)\n    const numRows = data.dimensions.rows\n\n    const { result } = renderHook(() => {\n      const editingState = React.useRef<EditingState>(\n        new EditingState(numRows)\n      )\n      editingState.current.setCell(1, 0, {\n        kind: GridCellKind.Text,\n        displayData: \"edited\",\n        data: \"edited\",\n        allowOverlay: true,\n      })\n      return useDataLoader(data, MOCK_COLUMNS, numRows, editingState)\n    })\n\n    // Check if value got edited\n    expect(\n      MOCK_COLUMNS[1].getCellValue(result.current.getCellContent([1, 0]))\n    ).toEqual(\"edited\")\n  })\n\n  it(\"uses editing state if a row got deleted\", () => {\n    const element = ArrowProto.create({\n      data: UNICODE,\n      editingMode: ArrowProto.EditingMode.DYNAMIC,\n    })\n\n    const data = new Quiver(element)\n    const numRows = data.dimensions.rows\n\n    const { result } = renderHook(() => {\n      const editingState = React.useRef<EditingState>(\n        new EditingState(numRows)\n      )\n      editingState.current.deleteRow(0)\n      return useDataLoader(data, MOCK_COLUMNS, numRows, editingState)\n    })\n\n    // Should return value of second row\n    expect(\n      MOCK_COLUMNS[1].getCellValue(result.current.getCellContent([1, 0]))\n    ).toEqual(\"bar\")\n  })\n})\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,KAAK,MAAM,OAAO;AAEzB,SAASC,UAAU,QAAQ,8BAA8B;AACzD,SAASC,YAAY,QAAQ,4BAA4B;AAEzD,SAASC,MAAM;AACf,SAASC,KAAK,IAAIC,UAAU;AAC5B,SAASC,OAAO;AAChB,SAEEC,WAAW,EACXC,UAAU;AAEZ,OAAOC,YAAY;AAEnB,OAAOC,aAAa;;AAEpB;AACA,MAAMC,YAA0B,GAAG,CACjCH,UAAU,CAAC;EACTI,SAAS,EAAE;IAAEC,IAAI,EAAE,IAAI;IAAEC,UAAU,EAAE,QAAQ;IAAEC,WAAW,EAAE;EAAU,CAAC;EACvEC,EAAE,EAAE,SAAS;EACbC,IAAI,EAAE,EAAE;EACRC,WAAW,EAAE,CAAC;EACdC,UAAU,EAAE,IAAI;EAChBC,QAAQ,EAAE,KAAK;EACfC,OAAO,EAAE,IAAI;EACbC,WAAW,EAAE,KAAK;EAClBC,KAAK,EAAE;AACT,CAAC,CAAC,EACFf,UAAU,CAAC;EACTI,SAAS,EAAE;IAAEC,IAAI,EAAE,IAAI;IAAEC,UAAU,EAAE,QAAQ;IAAEC,WAAW,EAAE;EAAU,CAAC;EACvEC,EAAE,EAAE,aAAa;EACjBC,IAAI,EAAE,IAAI;EACVC,WAAW,EAAE,CAAC;EACdC,UAAU,EAAE,IAAI;EAChBC,QAAQ,EAAE,KAAK;EACfC,OAAO,EAAE,KAAK;EACdC,WAAW,EAAE,KAAK;EAClBC,KAAK,EAAE;AACT,CAAC,CAAC,EACFf,UAAU,CAAC;EACTI,SAAS,EAAE;IAAEC,IAAI,EAAE,IAAI;IAAEC,UAAU,EAAE,QAAQ;IAAEC,WAAW,EAAE;EAAU,CAAC;EACvES,iBAAiB,EAAEC,SAAS;EAC5BT,EAAE,EAAE,aAAa;EACjBC,IAAI,EAAE,IAAI;EACVC,WAAW,EAAE,CAAC;EACdC,UAAU,EAAE,IAAI;EAChBC,QAAQ,EAAE,KAAK;EACfC,OAAO,EAAE,KAAK;EACdC,WAAW,EAAE,KAAK;EAClBC,KAAK,EAAE;AACT,CAAC,CAAC,CACH;AAEDG,QAAQ,CAAC,oBAAoB,EAAE,MAAM;EACnCC,EAAE,CAAC,+DAA+D,EAAE,MAAM;IACxE,MAAMC,OAAO,GAAGvB,UAAU,CAACwB,MAAM,CAAC;MAChCC,IAAI,EAAExB;IACR,CAAC,CAAC;IACF,MAAMwB,IAAI,GAAG,IAAI3B,MAAM,CAACyB,OAAO,CAAC;IAChC,MAAMG,OAAO,GAAGD,IAAI,CAACE,UAAU,CAACC,IAAI;IAEpC,MAAM;MAAEC;IAAO,CAAC,GAAGjC,UAAU,CAAC,MAAM;MAClC,MAAMkC,YAAY,GAAGnC,KAAK,CAACoC,MAAM,CAC/B,IAAI3B,YAAY,CAACsB,OAAO,CAC1B,CAAC;MACD,OAAOrB,aAAa,CAACoB,IAAI,EAAEnB,YAAY,EAAEoB,OAAO,EAAEI,YAAY,CAAC;IACjE,CAAC,CAAC;;IAEF;IACAE,MAAM,CACJ1B,YAAY,CAAC,CAAC,CAAC,CAAC2B,YAAY,CAACJ,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CACpE,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;IACZJ,MAAM,CACJ1B,YAAY,CAAC,CAAC,CAAC,CAAC2B,YAAY,CAACJ,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CACpE,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;IACbJ,MAAM,CACJ1B,YAAY,CAAC,CAAC,CAAC,CAAC2B,YAAY,CAACJ,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CACpE,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;;IAEX;IACAJ,MAAM,CACJ1B,YAAY,CAAC,CAAC,CAAC,CAAC2B,YAAY,CAACJ,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CACpE,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;IACZJ,MAAM,CACJ1B,YAAY,CAAC,CAAC,CAAC,CAAC2B,YAAY,CAACJ,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CACpE,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;IACbJ,MAAM,CACJ1B,YAAY,CAAC,CAAC,CAAC,CAAC2B,YAAY,CAACJ,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CACpE,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;;IAEX;IACAJ,MAAM,CAAC9B,WAAW,CAAC2B,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;;IAErE;IACAJ,MAAM,CAAC9B,WAAW,CAAC2B,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;EACvE,CAAC,CAAC;EAEFd,EAAE,CAAC,yCAAyC,EAAE,MAAM;IAClD,MAAMC,OAAO,GAAGvB,UAAU,CAACwB,MAAM,CAAC;MAChCC,IAAI,EAAExB,OAAO;MACboC,WAAW,EAAErC,UAAU,CAACsC,WAAW,CAACC;IACtC,CAAC,CAAC;IAEF,MAAMd,IAAI,GAAG,IAAI3B,MAAM,CAACyB,OAAO,CAAC;IAChC,MAAMG,OAAO,GAAGD,IAAI,CAACE,UAAU,CAACC,IAAI;IAEpC,MAAM;MAAEC;IAAO,CAAC,GAAGjC,UAAU,CAAC,MAAM;MAClC,MAAMkC,YAAY,GAAGnC,KAAK,CAACoC,MAAM,CAC/B,IAAI3B,YAAY,CAACsB,OAAO,CAC1B,CAAC;MACDI,YAAY,CAACI,OAAO,CAACM,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE;QACjCC,IAAI,EAAE5C,YAAY,CAAC6C,IAAI;QACvBC,WAAW,EAAE,QAAQ;QACrBlB,IAAI,EAAE,QAAQ;QACdmB,YAAY,EAAE;MAChB,CAAC,CAAC;MACF,OAAOvC,aAAa,CAACoB,IAAI,EAAEnB,YAAY,EAAEoB,OAAO,EAAEI,YAAY,CAAC;IACjE,CAAC,CAAC;;IAEF;IACAE,MAAM,CACJ1B,YAAY,CAAC,CAAC,CAAC,CAAC2B,YAAY,CAACJ,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CACpE,CAAC,CAACU,OAAO,CAAC,QAAQ,CAAC;EACrB,CAAC,CAAC;EAEFvB,EAAE,CAAC,yCAAyC,EAAE,MAAM;IAClD,MAAMC,OAAO,GAAGvB,UAAU,CAACwB,MAAM,CAAC;MAChCC,IAAI,EAAExB,OAAO;MACboC,WAAW,EAAErC,UAAU,CAACsC,WAAW,CAACQ;IACtC,CAAC,CAAC;IAEF,MAAMrB,IAAI,GAAG,IAAI3B,MAAM,CAACyB,OAAO,CAAC;IAChC,MAAMG,OAAO,GAAGD,IAAI,CAACE,UAAU,CAACC,IAAI;IAEpC,MAAM;MAAEC;IAAO,CAAC,GAAGjC,UAAU,CAAC,MAAM;MAClC,MAAMkC,YAAY,GAAGnC,KAAK,CAACoC,MAAM,CAC/B,IAAI3B,YAAY,CAACsB,OAAO,CAC1B,CAAC;MACDI,YAAY,CAACI,OAAO,CAACa,SAAS,CAAC,CAAC,CAAC;MACjC,OAAO1C,aAAa,CAACoB,IAAI,EAAEnB,YAAY,EAAEoB,OAAO,EAAEI,YAAY,CAAC;IACjE,CAAC,CAAC;;IAEF;IACAE,MAAM,CACJ1B,YAAY,CAAC,CAAC,CAAC,CAAC2B,YAAY,CAACJ,MAAM,CAACK,OAAO,CAACC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CACpE,CAAC,CAACU,OAAO,CAAC,KAAK,CAAC;EAClB,CAAC,CAAC;AACJ,CAAC,CAAC"}