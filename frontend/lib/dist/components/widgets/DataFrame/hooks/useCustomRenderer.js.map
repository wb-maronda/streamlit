{"version":3,"file":"useCustomRenderer.js","names":["React","drawTextCell","DatePickerCell","DropdownCell","RangeCell","SparklineCell","CustomCells","isMissingValueCell","NULL_VALUE_TOKEN","drawRequiredIndicator","ctx","rect","theme","save","beginPath","moveTo","x","width","y","lineTo","fillStyle","accentColor","fill","restore","drawMissingPlaceholder","args","cell","textDark","textLight","headerFontFull","headerFontStyle","fontFamily","baseFontFull","baseFontStyle","markerFontFull","markerFontStyle","spriteManager","hyperWrapping","contentAlign","useCustomRenderer","columns","drawCell","useCallback","draw","colPos","col","length","column","includes","kind","isRequired","isEditable","customRenderers","useMemo"],"sources":["../../../../../src/components/widgets/DataFrame/hooks/useCustomRenderer.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport {\n  BaseDrawArgs,\n  DataEditorProps,\n  DrawCellCallback,\n  drawTextCell,\n  Theme as GlideTheme,\n  Rectangle,\n} from \"@glideapps/glide-data-grid\"\nimport {\n  DatePickerCell,\n  DropdownCell,\n  RangeCell,\n  SparklineCell,\n} from \"@glideapps/glide-data-grid-cells\"\n\nimport {\n  BaseColumn,\n  CustomCells,\n  isMissingValueCell,\n} from \"@streamlit/lib/src/components/widgets/DataFrame/columns\"\n\n// Token used for missing values (null, NaN, etc.)\nconst NULL_VALUE_TOKEN = \"None\"\n\n/**\n * Draw a red indicator in the top right corner of the cell\n * to indicate that the cell is required.\n */\nexport function drawRequiredIndicator(\n  ctx: CanvasRenderingContext2D,\n  rect: Rectangle,\n  theme: GlideTheme\n): void {\n  ctx.save()\n  ctx.beginPath()\n  // We are first moving the drawing position under the top right corner\n  // 8 pixels from left side (this is the size triangle)\n  // and 1 pixel from top side (to be under the cell border).\n  ctx.moveTo(rect.x + rect.width - 8, rect.y + 1)\n  // We draw the first line to the top right corner.\n  ctx.lineTo(rect.x + rect.width, rect.y + 1)\n  // We draw the second line 8 pixel down on the right cell border\n  ctx.lineTo(rect.x + rect.width, rect.y + 1 + 8)\n  // And now its enough to just fill it with a color to get a triangle.\n  ctx.fillStyle = theme.accentColor\n  ctx.fill()\n  ctx.restore()\n}\n\n/**\n * If a cell is marked as missing, we draw a placeholder symbol with a faded text color.\n */\nexport const drawMissingPlaceholder = (args: BaseDrawArgs): void => {\n  const { cell, theme, ctx } = args\n  drawTextCell(\n    {\n      ...args,\n      theme: {\n        ...theme,\n        textDark: theme.textLight,\n        headerFontFull: `${theme.headerFontStyle} ${theme.fontFamily}`,\n        baseFontFull: `${theme.baseFontStyle} ${theme.fontFamily}`,\n        markerFontFull: `${theme.markerFontStyle} ${theme.fontFamily}`,\n      },\n      // The following props are just added for technical reasons:\n      // @ts-expect-error\n      spriteManager: {},\n      hyperWrapping: false,\n    },\n    NULL_VALUE_TOKEN,\n    cell.contentAlign\n  )\n  // Reset fill style to the original one\n  ctx.fillStyle = theme.textDark\n}\n\n/**\n * Create return type for useCustomRenderer hook based on the DataEditorProps.\n */\ntype CustomRendererReturn = Pick<\n  DataEditorProps,\n  \"drawCell\" | \"customRenderers\"\n>\n\n/**\n * Custom hook that creates some custom cell renderers compatible with glide-data-grid.\n *\n * This includes capabilities like showing a faded placeholder for missing values or\n * a red indicator for required cells.\n *\n * @param columns - The columns of the table.\n *\n * @returns An object containing the following properties:\n * - `drawCell`: A function that overwrites some rendering that can be\n *    passed to the `DataEditor` component.\n * - `customRenderers`: A map of custom cell renderers used by custom cells\n *    that can be passed to the `DataEditor` component.\n */\nfunction useCustomRenderer(columns: BaseColumn[]): CustomRendererReturn {\n  const drawCell: DrawCellCallback = React.useCallback(\n    (args, draw) => {\n      const { cell, theme, ctx, rect } = args\n      const colPos = args.col\n      if (isMissingValueCell(cell) && colPos < columns.length) {\n        const column = columns[colPos]\n\n        // We explicitly ignore some cell types here (e.g. checkbox, progress...) since\n        // they are taking care of rendering their missing value state themselves (usually as empty cell).\n        // All other cell types are rendered with a placeholder symbol and a faded text color via drawMissingPlaceholder.\n        if (\n          [\"checkbox\", \"line_chart\", \"bar_chart\", \"progress\"].includes(\n            column.kind\n          )\n        ) {\n          draw()\n        } else {\n          drawMissingPlaceholder(args as BaseDrawArgs)\n        }\n\n        if (column.isRequired && column.isEditable) {\n          // If the cell value is missing, and it is configured as required & editable,\n          // we draw a red indicator in the top right corner of the cell.\n          drawRequiredIndicator(ctx, rect, theme)\n        }\n        return\n      }\n      draw()\n    },\n    [columns]\n  )\n\n  // Load extra cell renderers from the glide-data-grid-cells package:\n  const customRenderers = React.useMemo(\n    () =>\n      [\n        SparklineCell,\n        DropdownCell,\n        RangeCell,\n        DatePickerCell,\n        ...CustomCells,\n      ] as DataEditorProps[\"customRenderers\"],\n    // This doesn't change during the lifetime of the component,\n    // so we can just run it once at creation time.\n    /* eslint-disable react-hooks/exhaustive-deps */\n    []\n  )\n\n  return {\n    drawCell,\n    customRenderers,\n  }\n}\n\nexport default useCustomRenderer\n"],"mappings":"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"}