{"version":3,"file":"useTableSizer.js","names":["React","Arrow","ArrowProto","notNullOrUndefined","MIN_COLUMN_WIDTH","MAX_COLUMN_WIDTH","MAX_COLUMN_AUTO_WIDTH","BORDER_THRESHOLD","ROW_HEIGHT","MIN_TABLE_WIDTH","MIN_TABLE_HEIGHT","DEFAULT_TABLE_HEIGHT","calculateMaxHeight","numRows","Math","max","useTableSizer","element","containerWidth","containerHeight","isFullScreen","maxHeight","editingMode","EditingMode","DYNAMIC","initialHeight","min","height","availableWidth","initialWidth","maxWidth","useContainerWidth","width","resizableSize","setResizableSize","useState","useLayoutEffect","stretchColumns","minHeight","minWidth"],"sources":["../../../../../src/components/widgets/DataFrame/hooks/useTableSizer.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// TODO: fix incorrect hook usage and delete this lint suppression\n/* eslint-disable react-hooks/exhaustive-deps */\n\nimport React from \"react\"\n\nimport { Size as ResizableSize } from \"re-resizable\"\n\nimport { Arrow as ArrowProto } from \"@streamlit/lib/src/proto\"\nimport { notNullOrUndefined } from \"@streamlit/lib/src/util/utils\"\n\n// Min column width used for manual and automatic resizing\nexport const MIN_COLUMN_WIDTH = 50\n// Max column width used for manual resizing\nexport const MAX_COLUMN_WIDTH = 1000\n// Max column width used for automatic column sizing\nexport const MAX_COLUMN_AUTO_WIDTH = 500\n// The border size in pixels (2)\n// to prevent overlap problem with selection ring.\nexport const BORDER_THRESHOLD = 2\n// The default row height in pixels\nexport const ROW_HEIGHT = 35\n// Min width for the resizable table container:\n// Based on one column at minimum width + borders\nexport const MIN_TABLE_WIDTH = MIN_COLUMN_WIDTH + BORDER_THRESHOLD\n// Min height for the resizable table container:\n// Based on header + one column, and border threshold\nconst MIN_TABLE_HEIGHT = 2 * ROW_HEIGHT + BORDER_THRESHOLD\n// The default maximum height of the table:\nconst DEFAULT_TABLE_HEIGHT = 400\n\nexport type AutoSizerReturn = {\n  // The minimum height that the data grid can be resized to\n  minHeight: number\n  // The maximum height of the data grid can be resized to\n  maxHeight: number\n  // The minimum width of the data grid can be resized to\n  minWidth: number\n  // The maximum width of the data grid can be resized to\n  maxWidth: number\n  // The current (or initial) size of the data grid\n  resizableSize: ResizableSize\n  // A callback function to change the size of the data grid.\n  setResizableSize: React.Dispatch<React.SetStateAction<ResizableSize>>\n}\n\nexport function calculateMaxHeight(numRows: number): number {\n  return Math.max(numRows * ROW_HEIGHT + BORDER_THRESHOLD, MIN_TABLE_HEIGHT)\n}\n/**\n * A custom React hook that manages all aspects related to the size of the table.\n *\n * @param element - The ArrowProto element\n * @param numRows - The number of rows in the table\n * @param containerWidth - The width of the surrounding container\n * @param containerHeight - The height of the surrounding container\n * @param isFullScreen - Whether the table is in fullscreen mode\n *\n * @returns The row height, min/max height & width, and the current size of the resizable container.\n */\nfunction useTableSizer(\n  element: ArrowProto,\n  numRows: number,\n  containerWidth: number,\n  containerHeight?: number,\n  isFullScreen?: boolean\n): AutoSizerReturn {\n  // Calculate the maximum height of the table based on the number of rows:\n  let maxHeight = calculateMaxHeight(\n    numRows +\n      1 + // Column header row\n      (element.editingMode === ArrowProto.EditingMode.DYNAMIC ? 1 : 0) // Trailing row\n  )\n\n  // The initial height is either the default table height or the maximum\n  // (full) height based if its smaller than the default table height.\n  // The reason why we have initial height is that the table itself is\n  // resizable by the user. So, it starts with initial height but can be\n  // resized between min and max height.\n  let initialHeight = Math.min(maxHeight, DEFAULT_TABLE_HEIGHT)\n\n  if (element.height) {\n    // User has explicitly configured a height\n    initialHeight = Math.max(element.height, MIN_TABLE_HEIGHT)\n    maxHeight = Math.max(element.height, maxHeight)\n  }\n\n  if (containerHeight) {\n    // If container height is set (e.g. when used in fullscreen)\n    // The maxHeight and height should not be larger than container height\n    initialHeight = Math.min(initialHeight, containerHeight)\n    maxHeight = Math.min(maxHeight, containerHeight)\n\n    if (!element.height) {\n      // If no explicit height is set, set height to max height (fullscreen mode)\n      initialHeight = maxHeight\n    }\n  }\n\n  // The available width should be at least the minimum table width\n  // to prevent \"maximum update depth exceeded\" error. The reason\n  // is that the container width can be -1 in some edge cases\n  // caused by the resize observer in the Block component.\n  // This can trigger the \"maximum update depth exceeded\" error\n  // within the grid component.\n  const availableWidth = Math.max(containerWidth, MIN_TABLE_WIDTH)\n\n  // The initial width of the data grid.\n  // If not set, the data grid will be auto adapted to its content.\n  // The reason why we have initial width is that the data grid itself\n  // is resizable by the user. It starts with initial width but can be\n  // resized between min and max width.\n  let initialWidth: number | undefined\n  // The maximum width of the data grid can be resized to.\n  let maxWidth = availableWidth\n\n  if (element.useContainerWidth) {\n    // If user has set use_container_width,\n    // use the full container (available) width.\n    initialWidth = availableWidth\n  } else if (element.width) {\n    // The user has explicitly configured a width\n    // use it but keep between the MIN_TABLE_WIDTH\n    // and the available width.\n    initialWidth = Math.min(\n      Math.max(element.width, MIN_TABLE_WIDTH),\n      availableWidth\n    )\n    // Make sure that the max width we configure is between the user\n    // configured width and the available (container) width.\n    maxWidth = Math.min(Math.max(element.width, maxWidth), availableWidth)\n  }\n\n  const [resizableSize, setResizableSize] = React.useState<ResizableSize>({\n    // If user hasn't specified a width via `width` or `use_container_width`,\n    // we configure the table to 100%. Which will cause the data grid to\n    // calculate the best size on the content and use that.\n    width: initialWidth || \"100%\",\n    height: initialHeight,\n  })\n\n  React.useLayoutEffect(() => {\n    // This prevents weird table resizing behavior if the container width\n    // changes and the table uses the full container width.\n    if (element.useContainerWidth && resizableSize.width === \"100%\") {\n      setResizableSize({\n        width: availableWidth,\n        height: resizableSize.height,\n      })\n    }\n  }, [availableWidth])\n\n  // Reset the height if the number of rows changes (e.g. via add_rows):\n  React.useLayoutEffect(() => {\n    setResizableSize({\n      width: resizableSize.width,\n      height: initialHeight,\n    })\n  }, [numRows])\n\n  // Reset the width if the element width parameter was changed:\n  React.useLayoutEffect(() => {\n    setResizableSize({\n      width: initialWidth || \"100%\",\n      height: resizableSize.height,\n    })\n  }, [initialWidth])\n\n  // Reset the height if the element height parameter was changed:\n  React.useLayoutEffect(() => {\n    setResizableSize({\n      width: resizableSize.width,\n      height: initialHeight,\n    })\n  }, [initialHeight])\n\n  // Change sizing if the fullscreen mode is activated or deactivated:\n  React.useLayoutEffect(() => {\n    if (isFullScreen) {\n      const stretchColumns: boolean =\n        element.useContainerWidth ||\n        (notNullOrUndefined(element.width) && element.width > 0)\n      setResizableSize({\n        width: stretchColumns ? maxWidth : \"100%\",\n        height: maxHeight,\n      })\n    } else {\n      setResizableSize({\n        width: initialWidth || \"100%\",\n        height: initialHeight,\n      })\n    }\n  }, [isFullScreen])\n\n  return {\n    minHeight: MIN_TABLE_HEIGHT,\n    maxHeight,\n    minWidth: MIN_TABLE_WIDTH,\n    maxWidth,\n    resizableSize,\n    setResizableSize,\n  }\n}\n\nexport default useTableSizer\n"],"mappings":"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"}