{"version":3,"file":"useTooltips.test.js","names":["renderHook","act","TextColumn","NumberColumn","useTooltips","DEBOUNCE_TIME_MS","REQUIRED_CELL_TOOLTIP","TOOLTIP_CONTENT","MOCK_COLUMNS","id","name","title","indexNumber","arrowType","pandas_type","numpy_type","isEditable","isRequired","isHidden","isIndex","isStretched","help","getCellContentMock","jest","fn","mockImplementation","_ref","col","column","kind","getCell","tooltip","getEmptyCellContentMock","_ref2","describe","beforeEach","clearAllMocks","useFakeTimers","afterEach","runOnlyPendingTimers","useRealTimers","it","result","current","onItemHovered","location","bounds","x","y","width","height","advanceTimersByTime","expect","toMatchObject","content","left","top","clearTooltip","toBeUndefined"],"sources":["../../../../../src/components/widgets/DataFrame/hooks/useTooltips.test.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { renderHook, act } from \"@testing-library/react-hooks\"\nimport {\n  BaseColumn,\n  TextColumn,\n  NumberColumn,\n} from \"@streamlit/lib/src/components/widgets/DataFrame/columns\"\n\nimport useTooltips, {\n  DEBOUNCE_TIME_MS,\n  REQUIRED_CELL_TOOLTIP,\n} from \"./useTooltips\"\nimport { GridMouseEventArgs } from \"@glideapps/glide-data-grid\"\n\nconst TOOLTIP_CONTENT = \"This is a **number** column.\"\nconst MOCK_COLUMNS: BaseColumn[] = [\n  NumberColumn({\n    id: \"column_1\",\n    name: \"column_1\",\n    title: \"column_1\",\n    indexNumber: 0,\n    arrowType: {\n      pandas_type: \"int64\",\n      numpy_type: \"int64\",\n    },\n    isEditable: true,\n    isRequired: true,\n    isHidden: false,\n    isIndex: false,\n    isStretched: false,\n    help: TOOLTIP_CONTENT,\n  }),\n  TextColumn({\n    id: \"column_2\",\n    name: \"column_2\",\n    title: \"column_2\",\n    indexNumber: 1,\n    arrowType: {\n      pandas_type: \"unicode\",\n      numpy_type: \"object\",\n    },\n    isEditable: true,\n    isRequired: false,\n    isHidden: false,\n    isIndex: false,\n    isStretched: false,\n  }),\n]\n\nconst getCellContentMock = jest\n  .fn()\n  .mockImplementation(([col]: readonly [number]) => {\n    const column = MOCK_COLUMNS[col]\n    if (column.kind === \"number\") {\n      return { ...column.getCell(123), tooltip: \"Cell tooltip 1\" }\n    }\n    return { ...column.getCell(\"foo\"), tooltip: \"Cell tooltip 2\" }\n  })\n\nconst getEmptyCellContentMock = jest\n  .fn()\n  .mockImplementation(([col]: readonly [number]) => {\n    const column = MOCK_COLUMNS[col]\n    return column.getCell(null)\n  })\n\ndescribe(\"useTooltips hook\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks()\n    jest.useFakeTimers()\n  })\n\n  afterEach(() => {\n    jest.runOnlyPendingTimers()\n    jest.useRealTimers()\n  })\n\n  it(\"renders a tooltip on hovering the header column with a tooltip\", () => {\n    const { result } = renderHook(() => {\n      return useTooltips(MOCK_COLUMNS, getCellContentMock)\n    })\n\n    act(() => {\n      // eslint-disable-next-line  @typescript-eslint/no-non-null-assertion\n      result.current.onItemHovered!({\n        kind: \"header\",\n        location: [0, -1],\n        bounds: { x: 0, y: 0, width: 100, height: 30 },\n      } as object as GridMouseEventArgs)\n\n      jest.advanceTimersByTime(DEBOUNCE_TIME_MS)\n    })\n\n    expect(result.current.tooltip).toMatchObject({\n      content: TOOLTIP_CONTENT,\n      left: 50,\n      top: 0,\n    })\n  })\n\n  it(\"renders a tooltip on hovering a cell with a tooltip\", () => {\n    const { result } = renderHook(() => {\n      return useTooltips(MOCK_COLUMNS, getCellContentMock)\n    })\n\n    act(() => {\n      // eslint-disable-next-line  @typescript-eslint/no-non-null-assertion\n      result.current.onItemHovered!({\n        kind: \"cell\",\n        location: [0, 1],\n        bounds: { x: 0, y: 30, width: 100, height: 30 },\n      } as object as GridMouseEventArgs)\n\n      jest.advanceTimersByTime(DEBOUNCE_TIME_MS)\n    })\n\n    expect(result.current.tooltip).toMatchObject({\n      content: \"Cell tooltip 1\",\n      left: 50,\n      top: 30,\n    })\n  })\n\n  it(\"renders a tooltip on hovering a required cell\", () => {\n    const { result } = renderHook(() => {\n      return useTooltips(MOCK_COLUMNS, getEmptyCellContentMock)\n    })\n\n    act(() => {\n      // eslint-disable-next-line  @typescript-eslint/no-non-null-assertion\n      result.current.onItemHovered!({\n        kind: \"cell\",\n        location: [0, 1],\n        bounds: { x: 0, y: 30, width: 100, height: 30 },\n      } as object as GridMouseEventArgs)\n\n      jest.advanceTimersByTime(DEBOUNCE_TIME_MS)\n    })\n\n    expect(result.current.tooltip).toMatchObject({\n      content: REQUIRED_CELL_TOOLTIP,\n      left: 50,\n      top: 30,\n    })\n  })\n\n  it(\"clears the tooltip when calling the clearTooltip function\", () => {\n    const { result } = renderHook(() => {\n      return useTooltips(MOCK_COLUMNS, getCellContentMock)\n    })\n\n    act(() => {\n      // eslint-disable-next-line  @typescript-eslint/no-non-null-assertion\n      result.current.onItemHovered!({\n        kind: \"header\",\n        location: [0, 0],\n        bounds: { x: 0, y: 0, width: 100, height: 30 },\n      } as object as GridMouseEventArgs)\n\n      jest.advanceTimersByTime(DEBOUNCE_TIME_MS)\n    })\n\n    expect(result.current.tooltip).toMatchObject({\n      content: TOOLTIP_CONTENT,\n      left: 50,\n      top: 0,\n    })\n\n    act(() => {\n      result.current.clearTooltip()\n    })\n\n    expect(result.current.tooltip).toBeUndefined()\n  })\n})\n"],"mappings":"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"}