{"version":3,"file":"useTableSizer.test.js","names":["act","renderHook","TEN_BY_TEN","UNICODE","VERY_TALL","Arrow","ArrowProto","useTableSizer","calculateMaxHeight","MIN_TABLE_WIDTH","describe","it","CONTAINER_WIDTH","TABLE_WIDTH","result","create","data","useContainerWidth","width","expect","current","resizableSize","toEqual","maxWidth","minWidth","NUMBER_OF_ROWS","TABLE_HEIGHT","height","maxHeight","CONTAINER_HEIGHT","NEW_WIDTH","NEW_HEIGHT","setResizableSize"],"sources":["../../../../../src/components/widgets/DataFrame/hooks/useTableSizer.test.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { act, renderHook } from \"@testing-library/react-hooks\"\n\nimport { TEN_BY_TEN, UNICODE, VERY_TALL } from \"@streamlit/lib/src/mocks/arrow\"\nimport { Arrow as ArrowProto } from \"@streamlit/lib/src/proto\"\n\nimport useTableSizer, {\n  calculateMaxHeight,\n  MIN_TABLE_WIDTH,\n} from \"./useTableSizer\"\n\ndescribe(\"useTableSizer hook\", () => {\n  it(\"applies the configured width\", () => {\n    // The width of the surrounding containers\n    const CONTAINER_WIDTH = 700\n    const TABLE_WIDTH = 350\n    const { result } = renderHook(() =>\n      useTableSizer(\n        ArrowProto.create({\n          data: TEN_BY_TEN,\n          useContainerWidth: false,\n          width: TABLE_WIDTH,\n        }),\n        10,\n        CONTAINER_WIDTH\n      )\n    )\n\n    expect(result.current.resizableSize.width).toEqual(TABLE_WIDTH)\n    expect(result.current.maxWidth).toEqual(CONTAINER_WIDTH)\n  })\n\n  it(\"Uses the minimum table width if container width is -1\", () => {\n    // The width of the surrounding containers can be -1 in some edge cases\n    // caused by the resize observer in the Block component.\n    // We test that the dataframe component correctly handles this case\n    // by falling back to the minimum table width instead.\n    // Related to: https://github.com/streamlit/streamlit/issues/7949\n    const CONTAINER_WIDTH = -1\n    const { result } = renderHook(() =>\n      useTableSizer(\n        ArrowProto.create({\n          data: TEN_BY_TEN,\n          useContainerWidth: true,\n        }),\n        10,\n        CONTAINER_WIDTH\n      )\n    )\n\n    expect(result.current.resizableSize.width).toEqual(MIN_TABLE_WIDTH)\n    expect(result.current.maxWidth).toEqual(MIN_TABLE_WIDTH)\n    expect(result.current.minWidth).toEqual(MIN_TABLE_WIDTH)\n  })\n\n  it(\"adapts to the surrounding container width\", () => {\n    // The width of the surrounding containers\n    const CONTAINER_WIDTH = 200\n    const TABLE_WIDTH = 350\n    const { result } = renderHook(() =>\n      useTableSizer(\n        ArrowProto.create({\n          data: TEN_BY_TEN,\n          useContainerWidth: false,\n          width: TABLE_WIDTH,\n        }),\n        10,\n        CONTAINER_WIDTH\n      )\n    )\n\n    expect(result.current.resizableSize.width).toEqual(CONTAINER_WIDTH)\n    expect(result.current.maxWidth).toEqual(CONTAINER_WIDTH)\n  })\n\n  it(\"applies the configured height\", () => {\n    const NUMBER_OF_ROWS = 10\n    const TABLE_HEIGHT = 100\n    const { result } = renderHook(() =>\n      useTableSizer(\n        ArrowProto.create({\n          data: TEN_BY_TEN,\n          useContainerWidth: false,\n          height: TABLE_HEIGHT,\n        }),\n        NUMBER_OF_ROWS,\n        700\n      )\n    )\n\n    expect(result.current.resizableSize.height).toEqual(TABLE_HEIGHT)\n    // +1 rows for header row\n    expect(result.current.maxHeight).toEqual(\n      calculateMaxHeight(NUMBER_OF_ROWS + 1)\n    )\n  })\n\n  it(\"applies useContainerWidth configuration\", () => {\n    // The width of the surrounding containers\n    const CONTAINER_WIDTH = 700\n    const TABLE_WIDTH = 350\n    const { result } = renderHook(() =>\n      useTableSizer(\n        ArrowProto.create({\n          data: TEN_BY_TEN,\n          useContainerWidth: true,\n          width: TABLE_WIDTH,\n        }),\n        10,\n        CONTAINER_WIDTH\n      )\n    )\n\n    expect(result.current.resizableSize.width).toEqual(CONTAINER_WIDTH)\n    expect(result.current.maxWidth).toEqual(CONTAINER_WIDTH)\n  })\n\n  it(\"calculates correct container dimensions for a table\", () => {\n    // The width of the surrounding containers\n    const CONTAINER_WIDTH = 700\n    const { result } = renderHook(() =>\n      useTableSizer(\n        ArrowProto.create({\n          data: UNICODE,\n          useContainerWidth: false,\n        }),\n        2, // Unicode table has 2 rows\n        CONTAINER_WIDTH\n      )\n    )\n\n    // This is expected to be 100% to adapt to whatever width the glide data grid calculates\n    expect(result.current.resizableSize.width).toEqual(\"100%\")\n    expect(result.current.maxWidth).toEqual(CONTAINER_WIDTH)\n  })\n\n  it(\"calculates correct container dimensions for fullscreen mode\", () => {\n    // The width of the surrounding containers\n    const CONTAINER_WIDTH = 1920\n    const CONTAINER_HEIGHT = 1080\n\n    const TABLE_WIDTH = 350\n    const { result } = renderHook(() =>\n      useTableSizer(\n        ArrowProto.create({\n          data: VERY_TALL,\n          useContainerWidth: true,\n          width: TABLE_WIDTH,\n        }),\n        100, // VERY_TALL table has 100 rows\n        CONTAINER_WIDTH,\n        CONTAINER_HEIGHT,\n        true\n      )\n    )\n\n    expect(result.current.maxWidth).toEqual(CONTAINER_WIDTH)\n    expect(result.current.maxHeight).toEqual(CONTAINER_HEIGHT)\n    expect(result.current.resizableSize.width).toEqual(CONTAINER_WIDTH)\n    expect(result.current.resizableSize.height).toEqual(CONTAINER_HEIGHT)\n  })\n\n  it(\"adapts size on resizing\", () => {\n    // The width of the surrounding containers\n    const CONTAINER_WIDTH = 700\n    const TABLE_WIDTH = 350\n    const NUMBER_OF_ROWS = 10 // TEN_BY_TEN has 10 rows\n    const { result } = renderHook(() =>\n      useTableSizer(\n        ArrowProto.create({\n          data: TEN_BY_TEN,\n          useContainerWidth: false,\n          width: TABLE_WIDTH,\n        }),\n        NUMBER_OF_ROWS,\n        CONTAINER_WIDTH\n      )\n    )\n\n    const NEW_WIDTH = 100\n    const NEW_HEIGHT = 100\n\n    act(() => {\n      const { setResizableSize } = result.current\n      setResizableSize?.({\n        width: NEW_WIDTH,\n        height: NEW_HEIGHT,\n      })\n    })\n\n    expect(result.current.resizableSize.width).toEqual(NEW_WIDTH)\n    expect(result.current.resizableSize.height).toEqual(NEW_HEIGHT)\n    expect(result.current.maxWidth).toEqual(CONTAINER_WIDTH)\n    // +1 rows for header row\n    expect(result.current.maxHeight).toEqual(\n      calculateMaxHeight(NUMBER_OF_ROWS + 1)\n    )\n  })\n})\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASA,GAAG,EAAEC,UAAU,QAAQ,8BAA8B;AAE9D,SAASC,UAAU,EAAEC,OAAO,EAAEC,SAAS;AACvC,SAASC,KAAK,IAAIC,UAAU;AAE5B,OAAOC,aAAa,IAClBC,kBAAkB,EAClBC,eAAe;AAGjBC,QAAQ,CAAC,oBAAoB,EAAE,MAAM;EACnCC,EAAE,CAAC,8BAA8B,EAAE,MAAM;IACvC;IACA,MAAMC,eAAe,GAAG,GAAG;IAC3B,MAAMC,WAAW,GAAG,GAAG;IACvB,MAAM;MAAEC;IAAO,CAAC,GAAGb,UAAU,CAAC,MAC5BM,aAAa,CACXD,UAAU,CAACS,MAAM,CAAC;MAChBC,IAAI,EAAEd,UAAU;MAChBe,iBAAiB,EAAE,KAAK;MACxBC,KAAK,EAAEL;IACT,CAAC,CAAC,EACF,EAAE,EACFD,eACF,CACF,CAAC;IAEDO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACH,KAAK,CAAC,CAACI,OAAO,CAACT,WAAW,CAAC;IAC/DM,MAAM,CAACL,MAAM,CAACM,OAAO,CAACG,QAAQ,CAAC,CAACD,OAAO,CAACV,eAAe,CAAC;EAC1D,CAAC,CAAC;EAEFD,EAAE,CAAC,uDAAuD,EAAE,MAAM;IAChE;IACA;IACA;IACA;IACA;IACA,MAAMC,eAAe,GAAG,CAAC,CAAC;IAC1B,MAAM;MAAEE;IAAO,CAAC,GAAGb,UAAU,CAAC,MAC5BM,aAAa,CACXD,UAAU,CAACS,MAAM,CAAC;MAChBC,IAAI,EAAEd,UAAU;MAChBe,iBAAiB,EAAE;IACrB,CAAC,CAAC,EACF,EAAE,EACFL,eACF,CACF,CAAC;IAEDO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACH,KAAK,CAAC,CAACI,OAAO,CAACb,eAAe,CAAC;IACnEU,MAAM,CAACL,MAAM,CAACM,OAAO,CAACG,QAAQ,CAAC,CAACD,OAAO,CAACb,eAAe,CAAC;IACxDU,MAAM,CAACL,MAAM,CAACM,OAAO,CAACI,QAAQ,CAAC,CAACF,OAAO,CAACb,eAAe,CAAC;EAC1D,CAAC,CAAC;EAEFE,EAAE,CAAC,2CAA2C,EAAE,MAAM;IACpD;IACA,MAAMC,eAAe,GAAG,GAAG;IAC3B,MAAMC,WAAW,GAAG,GAAG;IACvB,MAAM;MAAEC;IAAO,CAAC,GAAGb,UAAU,CAAC,MAC5BM,aAAa,CACXD,UAAU,CAACS,MAAM,CAAC;MAChBC,IAAI,EAAEd,UAAU;MAChBe,iBAAiB,EAAE,KAAK;MACxBC,KAAK,EAAEL;IACT,CAAC,CAAC,EACF,EAAE,EACFD,eACF,CACF,CAAC;IAEDO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACH,KAAK,CAAC,CAACI,OAAO,CAACV,eAAe,CAAC;IACnEO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACG,QAAQ,CAAC,CAACD,OAAO,CAACV,eAAe,CAAC;EAC1D,CAAC,CAAC;EAEFD,EAAE,CAAC,+BAA+B,EAAE,MAAM;IACxC,MAAMc,cAAc,GAAG,EAAE;IACzB,MAAMC,YAAY,GAAG,GAAG;IACxB,MAAM;MAAEZ;IAAO,CAAC,GAAGb,UAAU,CAAC,MAC5BM,aAAa,CACXD,UAAU,CAACS,MAAM,CAAC;MAChBC,IAAI,EAAEd,UAAU;MAChBe,iBAAiB,EAAE,KAAK;MACxBU,MAAM,EAAED;IACV,CAAC,CAAC,EACFD,cAAc,EACd,GACF,CACF,CAAC;IAEDN,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACM,MAAM,CAAC,CAACL,OAAO,CAACI,YAAY,CAAC;IACjE;IACAP,MAAM,CAACL,MAAM,CAACM,OAAO,CAACQ,SAAS,CAAC,CAACN,OAAO,CACtCd,kBAAkB,CAACiB,cAAc,GAAG,CAAC,CACvC,CAAC;EACH,CAAC,CAAC;EAEFd,EAAE,CAAC,yCAAyC,EAAE,MAAM;IAClD;IACA,MAAMC,eAAe,GAAG,GAAG;IAC3B,MAAMC,WAAW,GAAG,GAAG;IACvB,MAAM;MAAEC;IAAO,CAAC,GAAGb,UAAU,CAAC,MAC5BM,aAAa,CACXD,UAAU,CAACS,MAAM,CAAC;MAChBC,IAAI,EAAEd,UAAU;MAChBe,iBAAiB,EAAE,IAAI;MACvBC,KAAK,EAAEL;IACT,CAAC,CAAC,EACF,EAAE,EACFD,eACF,CACF,CAAC;IAEDO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACH,KAAK,CAAC,CAACI,OAAO,CAACV,eAAe,CAAC;IACnEO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACG,QAAQ,CAAC,CAACD,OAAO,CAACV,eAAe,CAAC;EAC1D,CAAC,CAAC;EAEFD,EAAE,CAAC,qDAAqD,EAAE,MAAM;IAC9D;IACA,MAAMC,eAAe,GAAG,GAAG;IAC3B,MAAM;MAAEE;IAAO,CAAC,GAAGb,UAAU,CAAC,MAC5BM,aAAa,CACXD,UAAU,CAACS,MAAM,CAAC;MAChBC,IAAI,EAAEb,OAAO;MACbc,iBAAiB,EAAE;IACrB,CAAC,CAAC,EACF,CAAC;IAAE;IACHL,eACF,CACF,CAAC;;IAED;IACAO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACH,KAAK,CAAC,CAACI,OAAO,CAAC,MAAM,CAAC;IAC1DH,MAAM,CAACL,MAAM,CAACM,OAAO,CAACG,QAAQ,CAAC,CAACD,OAAO,CAACV,eAAe,CAAC;EAC1D,CAAC,CAAC;EAEFD,EAAE,CAAC,6DAA6D,EAAE,MAAM;IACtE;IACA,MAAMC,eAAe,GAAG,IAAI;IAC5B,MAAMiB,gBAAgB,GAAG,IAAI;IAE7B,MAAMhB,WAAW,GAAG,GAAG;IACvB,MAAM;MAAEC;IAAO,CAAC,GAAGb,UAAU,CAAC,MAC5BM,aAAa,CACXD,UAAU,CAACS,MAAM,CAAC;MAChBC,IAAI,EAAEZ,SAAS;MACfa,iBAAiB,EAAE,IAAI;MACvBC,KAAK,EAAEL;IACT,CAAC,CAAC,EACF,GAAG;IAAE;IACLD,eAAe,EACfiB,gBAAgB,EAChB,IACF,CACF,CAAC;IAEDV,MAAM,CAACL,MAAM,CAACM,OAAO,CAACG,QAAQ,CAAC,CAACD,OAAO,CAACV,eAAe,CAAC;IACxDO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACQ,SAAS,CAAC,CAACN,OAAO,CAACO,gBAAgB,CAAC;IAC1DV,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACH,KAAK,CAAC,CAACI,OAAO,CAACV,eAAe,CAAC;IACnEO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACM,MAAM,CAAC,CAACL,OAAO,CAACO,gBAAgB,CAAC;EACvE,CAAC,CAAC;EAEFlB,EAAE,CAAC,yBAAyB,EAAE,MAAM;IAClC;IACA,MAAMC,eAAe,GAAG,GAAG;IAC3B,MAAMC,WAAW,GAAG,GAAG;IACvB,MAAMY,cAAc,GAAG,EAAE,EAAC;IAC1B,MAAM;MAAEX;IAAO,CAAC,GAAGb,UAAU,CAAC,MAC5BM,aAAa,CACXD,UAAU,CAACS,MAAM,CAAC;MAChBC,IAAI,EAAEd,UAAU;MAChBe,iBAAiB,EAAE,KAAK;MACxBC,KAAK,EAAEL;IACT,CAAC,CAAC,EACFY,cAAc,EACdb,eACF,CACF,CAAC;IAED,MAAMkB,SAAS,GAAG,GAAG;IACrB,MAAMC,UAAU,GAAG,GAAG;IAEtB/B,GAAG,CAAC,MAAM;MACR,MAAM;QAAEgC;MAAiB,CAAC,GAAGlB,MAAM,CAACM,OAAO;MAC3CY,gBAAgB,GAAG;QACjBd,KAAK,EAAEY,SAAS;QAChBH,MAAM,EAAEI;MACV,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFZ,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACH,KAAK,CAAC,CAACI,OAAO,CAACQ,SAAS,CAAC;IAC7DX,MAAM,CAACL,MAAM,CAACM,OAAO,CAACC,aAAa,CAACM,MAAM,CAAC,CAACL,OAAO,CAACS,UAAU,CAAC;IAC/DZ,MAAM,CAACL,MAAM,CAACM,OAAO,CAACG,QAAQ,CAAC,CAACD,OAAO,CAACV,eAAe,CAAC;IACxD;IACAO,MAAM,CAACL,MAAM,CAACM,OAAO,CAACQ,SAAS,CAAC,CAACN,OAAO,CACtCd,kBAAkB,CAACiB,cAAc,GAAG,CAAC,CACvC,CAAC;EACH,CAAC,CAAC;AACJ,CAAC,CAAC"}