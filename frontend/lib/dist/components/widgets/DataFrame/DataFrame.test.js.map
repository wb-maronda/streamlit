{"version":3,"file":"DataFrame.test.js","names":["React","screen","glideDataGridModule","TEN_BY_TEN","render","Quiver","Arrow","ArrowProto","jest","mock","requireActual","DataEditor","fn","props","_jsx","DataFrame","jsx","getProps","data","useContainerWidth","arguments","length","undefined","editingMode","EditingMode","READ_ONLY","element","create","Uint8Array","width","height","disabled","widgetMgr","getStringValue","ResizeObserver","window","describe","beforeEach","mockImplementation","observe","unobserve","disconnect","afterEach","restoreAllMocks","it","expect","getAllByTestId","toBe","styledResizableContainer","getByTestId","toHaveClass","dfStyle","getComputedStyle","dataframeToolbar","toBeInTheDocument","toolbarButtons","toHaveLength","matchMedia","matches","FIXED","toHaveBeenCalledWith","objectContaining","rangeSelect","fillHandle","onColumnResize"],"sources":["../../../../src/components/widgets/DataFrame/DataFrame.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport { screen } from \"@testing-library/react\"\nimport * as glideDataGridModule from \"@glideapps/glide-data-grid\"\n\nimport { TEN_BY_TEN } from \"@streamlit/lib/src/mocks/arrow\"\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport { Quiver } from \"@streamlit/lib/src/dataframes/Quiver\"\nimport { Arrow as ArrowProto } from \"@streamlit/lib/src/proto\"\nimport \"@testing-library/jest-dom\"\n\njest.mock(\"@glideapps/glide-data-grid\", () => ({\n  ...jest.requireActual(\"@glideapps/glide-data-grid\"),\n  DataEditor: jest.fn(props => <div {...props} />),\n}))\n\n// The native-file-system-adapter creates some issues in the test environment\n// so we mock it out. The errors might be related to the missing typescript\n// distribution. But the file picker most likely wouldn't work anyways in jest-dom.\njest.mock(\"native-file-system-adapter\", () => ({}))\n\nimport DataFrame, { DataFrameProps } from \"./DataFrame\"\n\nconst getProps = (\n  data: Quiver,\n  useContainerWidth = false,\n  editingMode: ArrowProto.EditingMode = ArrowProto.EditingMode.READ_ONLY\n): DataFrameProps => ({\n  element: ArrowProto.create({\n    data: new Uint8Array(),\n    useContainerWidth,\n    width: 400,\n    height: 400,\n    editingMode,\n  }),\n  data,\n  width: 700,\n  disabled: false,\n  widgetMgr: {\n    getStringValue: jest.fn(),\n  } as any,\n})\n\nconst { ResizeObserver } = window\n\ndescribe(\"DataFrame widget\", () => {\n  const props = getProps(new Quiver({ data: TEN_BY_TEN }))\n\n  beforeEach(() => {\n    // Mocking ResizeObserver to prevent:\n    // TypeError: window.ResizeObserver is not a constructor\n    // @ts-expect-error\n    delete window.ResizeObserver\n    window.ResizeObserver = jest.fn().mockImplementation(() => ({\n      observe: jest.fn(),\n      unobserve: jest.fn(),\n      disconnect: jest.fn(),\n    }))\n  })\n\n  afterEach(() => {\n    window.ResizeObserver = ResizeObserver\n    jest.restoreAllMocks()\n  })\n\n  it(\"renders without crashing\", () => {\n    render(<DataFrame {...props} />)\n    expect(screen.getAllByTestId(\"stDataFrameResizable\").length).toBe(1)\n  })\n\n  it(\"should have correct className\", () => {\n    render(<DataFrame {...props} />)\n\n    const styledResizableContainer = screen.getByTestId(\"stDataFrame\")\n\n    expect(styledResizableContainer).toHaveClass(\"stDataFrame\")\n  })\n\n  it(\"grid container should use full width when useContainerWidth is used\", () => {\n    render(<DataFrame {...getProps(new Quiver({ data: TEN_BY_TEN }), true)} />)\n    const dfStyle = getComputedStyle(\n      screen.getByTestId(\"stDataFrameResizable\")\n    )\n    expect(dfStyle.width).toBe(\"700px\")\n    expect(dfStyle.height).toBe(\"400px\")\n  })\n\n  it(\"grid container should render with specific size\", () => {\n    render(<DataFrame {...props} />)\n    const dfStyle = getComputedStyle(\n      screen.getByTestId(\"stDataFrameResizable\")\n    )\n    expect(dfStyle.width).toBe(\"400px\")\n    expect(dfStyle.height).toBe(\"400px\")\n  })\n\n  it(\"should have a toolbar\", () => {\n    render(<DataFrame {...props} />)\n\n    const dataframeToolbar = screen.getByTestId(\"stElementToolbar\")\n\n    expect(dataframeToolbar).toBeInTheDocument()\n\n    const toolbarButtons = screen.getAllByTestId(\"stElementToolbarButton\")\n    expect(toolbarButtons).toHaveLength(3)\n  })\n\n  it(\"Touch detection correctly deactivates some features\", () => {\n    // Set window.matchMedia to simulate a touch device\n    window.matchMedia = jest.fn().mockImplementation(() => ({\n      matches: true,\n    }))\n\n    render(\n      <DataFrame\n        {...getProps(\n          new Quiver({ data: TEN_BY_TEN }),\n          true,\n          ArrowProto.EditingMode.FIXED\n        )}\n      />\n    )\n    // You have to set a second arg with {} to test work and get the received props\n    expect(glideDataGridModule.DataEditor).toHaveBeenCalledWith(\n      expect.objectContaining({\n        rangeSelect: \"cell\",\n        fillHandle: false,\n        onColumnResize: undefined,\n      }),\n      {}\n    )\n  })\n})\n"],"mappings":"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"}