{"version":3,"file":"arrowUtils.js","names":["GridCellKind","moment","Quiver","isNullOrUndefined","notNullOrUndefined","CheckboxColumn","DateColumn","DateTimeColumn","isErrorCell","ListColumn","NumberColumn","ObjectColumn","removeLineBreaks","SelectboxColumn","TextColumn","TimeColumn","extractCssProperty","htmlElementId","property","cssStyle","regex","RegExp","replace","match","exec","trim","undefined","applyPandasStylerCss","cell","cssId","cssStyles","themeOverride","fontColor","textDark","backgroundColor","bgCell","getColumnTypeFromArrow","arrowType","typeName","getTypeName","toLowerCase","includes","startsWith","getIndexFromArrow","data","indexPosition","types","index","title","indexNames","isEditable","id","name","isIndex","isHidden","getColumnFromArrow","columnPosition","columns","meta","numpy_type","pandas_type","columnTypeOptions","options","getCategoricalOptions","getEmptyIndexColumn","indexNumber","getAllColumnsFromArrow","dimensions","numIndices","headerColumns","numColumns","dataColumns","push","i","column","getCellFromArrow","arrowCell","arguments","length","cellTemplate","kind","getCell","content","format","contentType","field","parsedDate","type","unit","unix","convertToSeconds","utc","toDate","Number","decimalStr","displayContent","displayData","Text","Uri","Custom","displayDate"],"sources":["../../../../src/components/widgets/DataFrame/arrowUtils.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Theme as GlideTheme,\n  GridCell,\n  GridCellKind,\n  NumberCell,\n  TextCell,\n  UriCell,\n} from \"@glideapps/glide-data-grid\"\nimport { DatePickerType } from \"@glideapps/glide-data-grid-cells\"\nimport moment from \"moment\"\n\nimport {\n  Type as ArrowType,\n  DataFrameCell,\n  Quiver,\n} from \"@streamlit/lib/src/dataframes/Quiver\"\nimport {\n  isNullOrUndefined,\n  notNullOrUndefined,\n} from \"@streamlit/lib/src/util/utils\"\n\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  CheckboxColumn,\n  ColumnCreator,\n  DateColumn,\n  DateTimeColumn,\n  isErrorCell,\n  ListColumn,\n  NumberColumn,\n  ObjectColumn,\n  removeLineBreaks,\n  SelectboxColumn,\n  TextColumn,\n  TimeColumn,\n} from \"./columns\"\n\n/**\n * Extracts a CSS property value from a given CSS style string by using a regex.\n *\n * @param htmlElementId - The ID of the HTML element to extract the property for.\n * @param property - The css property to extract the value for.\n * @param cssStyle - The css style string.\n *\n * @return the CSS property value or undefined if the property is not found.\n */\nexport function extractCssProperty(\n  htmlElementId: string,\n  property: string,\n  cssStyle: string\n): string | undefined {\n  // This regex is supposed to extract the value of a CSS property\n  // for a specified HTML element ID from a CSS style string:\n  const regex = new RegExp(\n    `${htmlElementId}[,\\\\s].*{(?:[^}]*[\\\\s;]{1})?${property}:\\\\s*([^;}]+)[;]?.*}`,\n    \"gm\"\n  )\n  // Makes the regex simpler to match the element correctly:\n  cssStyle = cssStyle.replace(/{/g, \" {\")\n\n  const match = regex.exec(cssStyle)\n  if (match) {\n    return match[1].trim()\n  }\n\n  return undefined\n}\n/**\n * Applies pandas styler CSS to style the cell.\n *\n * @param cell: The cell to style.\n * @param cssId: The css ID of the cell.\n * @param cssStyles: All CSS styles from pandas styler.\n *\n * @return a styled grid cell.\n */\nexport function applyPandasStylerCss(\n  cell: GridCell,\n  cssId: string,\n  cssStyles: string\n): GridCell {\n  const themeOverride = {} as Partial<GlideTheme>\n\n  // Extract and apply the font color\n  const fontColor = extractCssProperty(cssId, \"color\", cssStyles)\n  if (fontColor) {\n    themeOverride.textDark = fontColor\n  }\n\n  // Extract and apply the background color\n  const backgroundColor = extractCssProperty(\n    cssId,\n    \"background-color\",\n    cssStyles\n  )\n  if (backgroundColor) {\n    themeOverride.bgCell = backgroundColor\n  }\n\n  if (backgroundColor === \"yellow\" && fontColor === undefined) {\n    // Yellow is used by pandas styler as the default highlight color.\n    // But yellow won't work well with our default font color in dark mode.\n    // Therefore, we are overriding the font color to our dark font color which\n    // always works well with yellow background.\n    themeOverride.textDark = \"#31333F\"\n  }\n\n  if (themeOverride) {\n    // Apply the background and font color in the theme override\n    return {\n      ...cell,\n      themeOverride,\n    }\n  }\n  return cell\n}\n\n/**\n * Maps the data type from Arrow to a column type.\n */\nexport function getColumnTypeFromArrow(arrowType: ArrowType): ColumnCreator {\n  let typeName = arrowType ? Quiver.getTypeName(arrowType) : null\n\n  if (!typeName) {\n    // Use object column as fallback\n    return ObjectColumn\n  }\n\n  typeName = typeName.toLowerCase().trim()\n  // Match based on arrow types\n  if ([\"unicode\", \"empty\", \"large_string[pyarrow]\"].includes(typeName)) {\n    return TextColumn\n  }\n\n  if ([\"datetime\", \"datetimetz\"].includes(typeName)) {\n    return DateTimeColumn\n  }\n  if (typeName === \"time\") {\n    return TimeColumn\n  }\n  if (typeName === \"date\") {\n    return DateColumn\n  }\n  if ([\"object\", \"bytes\"].includes(typeName)) {\n    return ObjectColumn\n  }\n  if ([\"bool\"].includes(typeName)) {\n    return CheckboxColumn\n  }\n  if (\n    [\n      \"int8\",\n      \"int16\",\n      \"int32\",\n      \"int64\",\n      \"uint8\",\n      \"uint16\",\n      \"uint32\",\n      \"uint64\",\n      \"float16\",\n      \"float32\",\n      \"float64\",\n      \"float96\",\n      \"float128\",\n      \"range\", // The default index in pandas uses a range type.\n      \"decimal\",\n    ].includes(typeName)\n  ) {\n    return NumberColumn\n  }\n  if (typeName === \"categorical\") {\n    return SelectboxColumn\n  }\n  if (typeName.startsWith(\"list\")) {\n    return ListColumn\n  }\n\n  return ObjectColumn\n}\n\n/**\n * Creates the column props for an index column from the Arrow metadata.\n *\n * @param data - The Arrow data.\n * @param indexPosition - The numeric position of the index column.\n *\n * @return the column props for the index column.\n */\nexport function getIndexFromArrow(\n  data: Quiver,\n  indexPosition: number\n): BaseColumnProps {\n  const arrowType = data.types.index[indexPosition]\n  const title = data.indexNames[indexPosition]\n  let isEditable = true\n\n  if (Quiver.getTypeName(arrowType) === \"range\") {\n    // Range indices are not editable\n    isEditable = false\n  }\n\n  return {\n    id: `index-${indexPosition}`,\n    name: title,\n    title,\n    isEditable,\n    arrowType,\n    isIndex: true,\n    isHidden: false,\n  } as BaseColumnProps\n}\n\n/**\n * Creates the column props for a data column from the Arrow metadata.\n *\n * @param data - The Arrow data.\n * @param columnPosition - The numeric position of the data column.\n *        Starts with 0 at the first non-index column.\n *\n * @return the column props for the data column.\n */\nexport function getColumnFromArrow(\n  data: Quiver,\n  columnPosition: number\n): BaseColumnProps {\n  const title = data.columns[0][columnPosition]\n  let arrowType = data.types.data[columnPosition]\n\n  if (isNullOrUndefined(arrowType)) {\n    // Use empty column type as fallback\n    arrowType = {\n      meta: null,\n      numpy_type: \"object\",\n      pandas_type: \"object\",\n    } as ArrowType\n  }\n\n  let columnTypeOptions\n  if (Quiver.getTypeName(arrowType) === \"categorical\") {\n    // Get the available categories and use it in column type metadata\n    const options = data.getCategoricalOptions(columnPosition)\n    if (notNullOrUndefined(options)) {\n      columnTypeOptions = {\n        options,\n      }\n    }\n  }\n\n  return {\n    id: `column-${title}-${columnPosition}`,\n    name: title,\n    title,\n    isEditable: true,\n    arrowType,\n    columnTypeOptions,\n    isIndex: false,\n    isHidden: false,\n  } as BaseColumnProps\n}\n\n/**\n * Creates the column props for an empty index column.\n * This is used for DataFrames that don't have any index.\n * At least one column is required for glide.\n */\nexport function getEmptyIndexColumn(): BaseColumnProps {\n  return {\n    id: `empty-index`,\n    title: \"\",\n    indexNumber: 0,\n    isEditable: false,\n    isIndex: true,\n  } as BaseColumnProps\n}\n\n/**\n * Creates the column props for all columns from the Arrow metadata.\n *\n * @param data - The Arrow data.\n * @return the column props for all columns.\n */\nexport function getAllColumnsFromArrow(data: Quiver): BaseColumnProps[] {\n  const columns: BaseColumnProps[] = []\n\n  const { dimensions } = data\n  const numIndices = dimensions.headerColumns\n  const numColumns = dimensions.dataColumns\n\n  if (numIndices === 0 && numColumns === 0) {\n    // Tables that don't have any columns cause an exception in glide-data-grid.\n    // As a workaround, we are adding an empty index column in this case.\n    columns.push(getEmptyIndexColumn())\n    return columns\n  }\n\n  for (let i = 0; i < numIndices; i++) {\n    const column = {\n      ...getIndexFromArrow(data, i),\n      indexNumber: i,\n    } as BaseColumnProps\n\n    columns.push(column)\n  }\n\n  for (let i = 0; i < numColumns; i++) {\n    const column = {\n      ...getColumnFromArrow(data, i),\n      indexNumber: i + numIndices,\n    } as BaseColumnProps\n\n    columns.push(column)\n  }\n  return columns\n}\n\n/**\n * Returns a glide-data-grid compatible cell object based on the\n * cell data from the Quiver (Arrow) object. Different types of data will\n * result in different cell types.\n *\n * @param column - The colum of the cell.\n * @param arrowCell - The dataframe cell object from Arrow.\n * @param cssStyles - Optional css styles to apply on the cell.\n *\n * @return a GridCell object that can be used by glide-data-grid.\n */\nexport function getCellFromArrow(\n  column: BaseColumn,\n  arrowCell: DataFrameCell,\n  cssStyles: string | undefined = undefined\n): GridCell {\n  const typeName = column.arrowType\n    ? Quiver.getTypeName(column.arrowType)\n    : null\n\n  let cellTemplate\n  if (column.kind === \"object\") {\n    // Always use display value from Quiver for object types\n    // these are special types that the dataframe only support in read-only mode.\n    cellTemplate = column.getCell(\n      notNullOrUndefined(arrowCell.content)\n        ? removeLineBreaks(\n            Quiver.format(\n              arrowCell.content,\n              arrowCell.contentType,\n              arrowCell.field\n            )\n          )\n        : null\n    )\n  } else if (\n    [\"time\", \"date\", \"datetime\"].includes(column.kind) &&\n    notNullOrUndefined(arrowCell.content) &&\n    (typeof arrowCell.content === \"number\" ||\n      typeof arrowCell.content === \"bigint\")\n  ) {\n    // This is a special case where we want to already parse a numerical timestamp\n    // to a date object based on the arrow field metadata.\n    // Our implementation only supports unix timestamps in seconds, so we need to\n    // do some custom conversion here.\n    let parsedDate\n    if (\n      typeName === \"time\" &&\n      notNullOrUndefined(arrowCell.field?.type?.unit)\n    ) {\n      // Time values needs to be adjusted to seconds based on the unit\n      parsedDate = moment\n        .unix(\n          Quiver.convertToSeconds(\n            arrowCell.content,\n            arrowCell.field?.type?.unit ?? 0\n          )\n        )\n        .utc()\n        .toDate()\n    } else {\n      // All other datetime related values are assumed to be in milliseconds\n      parsedDate = moment.utc(Number(arrowCell.content)).toDate()\n    }\n\n    cellTemplate = column.getCell(parsedDate)\n  } else if (typeName === \"decimal\") {\n    // This is a special case where we want to already prepare a decimal value\n    // to a number string based on the arrow field metadata. This is required\n    // because we don't have access to the required scale in the number column.\n    const decimalStr = isNullOrUndefined(arrowCell.content)\n      ? null\n      : Quiver.format(\n          arrowCell.content,\n          arrowCell.contentType,\n          arrowCell.field\n        )\n    cellTemplate = column.getCell(decimalStr)\n  } else {\n    cellTemplate = column.getCell(arrowCell.content)\n  }\n\n  if (isErrorCell(cellTemplate)) {\n    // Directly return error cells without any additional modification\n    return cellTemplate\n  }\n\n  if (!column.isEditable) {\n    // Only apply display content and css styles to non-editable cells.\n    if (notNullOrUndefined(arrowCell.displayContent)) {\n      const displayData = removeLineBreaks(arrowCell.displayContent)\n      // If the display content is set, use that instead of the content.\n      // This is only supported for text, object, date, datetime, time and number cells.\n      // Non-editable datetime cells will use the text cell kind\n      // so we don't need to handle date-time-cell cells extra here.\n      if (cellTemplate.kind === GridCellKind.Text) {\n        cellTemplate = {\n          ...cellTemplate,\n          displayData,\n        } as TextCell\n      } else if (cellTemplate.kind === GridCellKind.Number) {\n        cellTemplate = {\n          ...cellTemplate,\n          displayData,\n        } as NumberCell\n      } else if (cellTemplate.kind === GridCellKind.Uri) {\n        cellTemplate = {\n          ...cellTemplate,\n          displayData,\n        } as UriCell\n      } else if (\n        cellTemplate.kind === GridCellKind.Custom &&\n        (cellTemplate as DatePickerType).data?.kind === \"date-picker-cell\"\n      ) {\n        cellTemplate = {\n          ...cellTemplate,\n          data: {\n            ...(cellTemplate as DatePickerType).data,\n            displayDate: displayData,\n          },\n        } as DatePickerType\n      }\n    }\n\n    if (cssStyles && arrowCell.cssId) {\n      cellTemplate = applyPandasStylerCss(\n        cellTemplate,\n        arrowCell.cssId,\n        cssStyles\n      )\n    }\n  }\n  return cellTemplate\n}\n"],"mappings":"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"}