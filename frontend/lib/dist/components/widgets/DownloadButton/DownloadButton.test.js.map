{"version":3,"file":"DownloadButton.test.js","names":["React","fireEvent","screen","render","WidgetStateManager","DownloadButton","DownloadButtonProto","mockEndpoints","createDownloadLink","jsx","_jsx","jest","mock","getProps","elementProps","arguments","length","undefined","widgetProps","element","create","id","label","url","width","disabled","widgetMgr","sendRerunBackMsg","fn","formsDataChanged","endpoints","describe","it","props","downloadButton","getByRole","expect","toBeInTheDocument","getByTestId","toHaveClass","toHaveStyle","name","click","setTriggerValue","toHaveBeenCalledWith","fromUi","buildMediaURL","sameTabLink","getAttribute","toBe","newTabLink","fragmentId","toBeDisabled","children","useContainerWidth","help"],"sources":["../../../../src/components/widgets/DownloadButton/DownloadButton.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport { fireEvent, screen } from \"@testing-library/react\"\n\nimport \"@testing-library/jest-dom\"\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport { WidgetStateManager } from \"@streamlit/lib/src/WidgetStateManager\"\nimport { DownloadButton as DownloadButtonProto } from \"@streamlit/lib/src/proto\"\nimport { mockEndpoints } from \"@streamlit/lib/src/mocks/mocks\"\n\nimport DownloadButton, { createDownloadLink, Props } from \"./DownloadButton\"\n\njest.mock(\"@streamlit/lib/src/WidgetStateManager\")\njest.mock(\"@streamlit/lib/src/StreamlitEndpoints\")\n\nconst getProps = (\n  elementProps: Partial<DownloadButtonProto> = {},\n  widgetProps: Partial<Props> = {}\n): Props => ({\n  element: DownloadButtonProto.create({\n    id: \"1\",\n    label: \"Label\",\n    url: \"/media/mockDownloadURL\",\n    ...elementProps,\n  }),\n  width: 250,\n  disabled: false,\n  widgetMgr: new WidgetStateManager({\n    sendRerunBackMsg: jest.fn(),\n    formsDataChanged: jest.fn(),\n  }),\n  endpoints: mockEndpoints(),\n  ...widgetProps,\n})\n\ndescribe(\"DownloadButton widget\", () => {\n  it(\"renders without crashing\", () => {\n    const props = getProps()\n    render(<DownloadButton {...props} />)\n\n    const downloadButton = screen.getByRole(\"button\")\n    expect(downloadButton).toBeInTheDocument()\n  })\n\n  it(\"has correct className and style\", () => {\n    const props = getProps()\n    render(<DownloadButton {...props} />)\n\n    const downloadButton = screen.getByTestId(\"stDownloadButton\")\n\n    expect(downloadButton).toHaveClass(\"stDownloadButton\")\n    expect(downloadButton).toHaveStyle(`width: ${props.width}px`)\n  })\n\n  it(\"renders a label within the button\", () => {\n    const props = getProps()\n    render(<DownloadButton {...props} />)\n\n    const downloadButton = screen.getByRole(\"button\", {\n      name: `${props.element.label}`,\n    })\n\n    expect(downloadButton).toBeInTheDocument()\n  })\n\n  describe(\"wrapped BaseButton\", () => {\n    it(\"sets widget triggerValue and creates a download URL on click\", () => {\n      const props = getProps()\n      render(<DownloadButton {...props} />)\n\n      const downloadButton = screen.getByRole(\"button\")\n\n      fireEvent.click(downloadButton)\n\n      expect(props.widgetMgr.setTriggerValue).toHaveBeenCalledWith(\n        props.element,\n        { fromUi: true },\n        undefined\n      )\n\n      expect(props.endpoints.buildMediaURL).toHaveBeenCalledWith(\n        \"/media/mockDownloadURL\"\n      )\n    })\n\n    it(\"has a correct new tab behaviour download link\", () => {\n      const props = getProps()\n      const sameTabLink = createDownloadLink(\n        props.endpoints,\n        props.element.url,\n        false\n      )\n      expect(sameTabLink.getAttribute(\"target\")).toBe(\"_self\")\n\n      const newTabLink = createDownloadLink(\n        props.endpoints,\n        props.element.url,\n        true\n      )\n      expect(newTabLink.getAttribute(\"target\")).toBe(\"_blank\")\n    })\n\n    it(\"can set fragmentId on click\", () => {\n      const props = getProps(undefined, { fragmentId: \"myFragmentId\" })\n      render(<DownloadButton {...props} />)\n\n      const downloadButton = screen.getByRole(\"button\")\n      fireEvent.click(downloadButton)\n\n      expect(props.widgetMgr.setTriggerValue).toHaveBeenCalledWith(\n        props.element,\n        { fromUi: true },\n        \"myFragmentId\"\n      )\n    })\n\n    it(\"handles the disabled prop\", () => {\n      const props = getProps({}, { disabled: true })\n      render(<DownloadButton {...props} />)\n\n      const downloadButton = screen.getByRole(\"button\")\n      expect(downloadButton).toBeDisabled()\n    })\n\n    it(\"does not use container width by default\", () => {\n      const props = getProps()\n      render(<DownloadButton {...props}>Hello</DownloadButton>)\n\n      const downloadButton = screen.getByRole(\"button\")\n      expect(downloadButton).toHaveStyle(\"width: auto\")\n    })\n\n    it(\"passes useContainerWidth property with help correctly\", () => {\n      render(\n        <DownloadButton\n          {...getProps({ useContainerWidth: true, help: \"mockHelpText\" })}\n        >\n          Hello\n        </DownloadButton>\n      )\n\n      const downloadButton = screen.getByRole(\"button\")\n      expect(downloadButton).toHaveStyle(`width: ${250}px`)\n    })\n\n    it(\"passes useContainerWidth property without help correctly\", () => {\n      render(\n        <DownloadButton {...getProps({ useContainerWidth: true })}>\n          Hello\n        </DownloadButton>\n      )\n\n      const downloadButton = screen.getByRole(\"button\")\n      expect(downloadButton).toHaveStyle(\"width: 100%\")\n    })\n  })\n})\n"],"mappings":"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"}