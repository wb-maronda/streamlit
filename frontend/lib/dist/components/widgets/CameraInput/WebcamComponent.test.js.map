{"version":3,"file":"WebcamComponent.test.js","names":["React","fireEvent","screen","within","render","FacingMode","WebcamComponent","WebcamPermission","jsx","_jsx","jest","mock","isMobile","getProps","props","arguments","length","undefined","handleCapture","fn","width","disabled","setClearPhotoInProgress","clearPhotoInProgress","facingMode","USER","setFacingMode","testOverride","PENDING","describe","it","expect","getByTestId","toBeInTheDocument","getByText","getByRole","toHaveTextContent","toHaveAttribute","ERROR","SUCCESS","not","switchButton","click","toHaveBeenCalledTimes","name","toHaveBeenCalled"],"sources":["../../../../src/components/widgets/CameraInput/WebcamComponent.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\nimport \"@testing-library/jest-dom\"\n\nimport { fireEvent, screen, within } from \"@testing-library/react\"\n\nimport { render } from \"@streamlit/lib/src/test_util\"\n\nimport { FacingMode } from \"./SwitchFacingModeButton\"\nimport WebcamComponent, { Props, WebcamPermission } from \"./WebcamComponent\"\n\njest.mock(\"react-webcam\")\n\njest.mock(\"react-device-detect\", () => {\n  return {\n    isMobile: true,\n  }\n})\n\nconst getProps = (props: Partial<Props> = {}): Props => {\n  return {\n    handleCapture: jest.fn(),\n    width: 500,\n    disabled: false,\n    setClearPhotoInProgress: jest.fn(),\n    clearPhotoInProgress: false,\n    facingMode: FacingMode.USER,\n    setFacingMode: jest.fn(),\n    testOverride: WebcamPermission.PENDING,\n    ...props,\n  }\n}\n\ndescribe(\"Test Webcam Component\", () => {\n  it(\"renders without crashing\", () => {\n    const props = getProps()\n    render(<WebcamComponent {...props} />)\n    expect(\n      screen.getByTestId(\"stCameraInputWebcamComponent\")\n    ).toBeInTheDocument()\n  })\n\n  it(\"renders ask permission screen when pending state\", () => {\n    const props = getProps()\n    render(<WebcamComponent {...props} />)\n    expect(\n      screen.getByTestId(\"stCameraInputWebcamComponent\")\n    ).toBeInTheDocument()\n    expect(\n      screen.getByText(\"This app would like to use your camera.\")\n    ).toBeInTheDocument()\n    expect(screen.getByRole(\"link\")).toHaveTextContent(\n      \"Learn how to allow access.\"\n    )\n    // hidden style should be there and webcam should not show\n    expect(screen.getByTestId(\"stCameraInputWebcamStyledBox\")).toHaveAttribute(\n      \"hidden\"\n    )\n  })\n\n  it(\"renders ask permission screen when error state\", () => {\n    const props = getProps({ testOverride: WebcamPermission.ERROR })\n    render(<WebcamComponent {...props} />)\n    expect(\n      screen.getByTestId(\"stCameraInputWebcamComponent\")\n    ).toBeInTheDocument()\n\n    expect(\n      screen.getByText(\"This app would like to use your camera.\")\n    ).toBeInTheDocument()\n    expect(screen.getByRole(\"link\")).toHaveTextContent(\n      \"Learn how to allow access.\"\n    )\n    // hidden style should be there and webcam should not show\n    expect(screen.getByTestId(\"stCameraInputWebcamStyledBox\")).toHaveAttribute(\n      \"hidden\"\n    )\n  })\n\n  it(\"does not render ask permission screen in success state\", () => {\n    const props = getProps({ testOverride: WebcamPermission.SUCCESS })\n    render(<WebcamComponent {...props} />)\n    expect(\n      screen.getByTestId(\"stCameraInputWebcamComponent\")\n    ).toBeInTheDocument()\n\n    // hidden style should not be there and webcam should show\n    expect(\n      screen.getByTestId(\"stCameraInputWebcamStyledBox\")\n    ).not.toHaveAttribute(\"hidden\")\n  })\n\n  it(\"shows a SwitchFacingMode button\", () => {\n    const props = getProps({ testOverride: WebcamPermission.SUCCESS })\n    render(<WebcamComponent {...props} />)\n    expect(\n      screen.getByTestId(\"stCameraInputWebcamComponent\")\n    ).toBeInTheDocument()\n    expect(screen.getByTestId(\"stCameraInputSwitchButton\")).toBeInTheDocument()\n  })\n\n  it(\"changes `facingMode` when SwitchFacingMode button clicked\", () => {\n    const props = getProps({ testOverride: WebcamPermission.SUCCESS })\n    render(<WebcamComponent {...props} />)\n\n    expect(screen.getByTestId(\"stCameraInputSwitchButton\")).toBeInTheDocument()\n\n    const switchButton = within(\n      screen.getByTestId(\"stCameraInputSwitchButton\")\n    ).getByRole(\"button\")\n\n    fireEvent.click(switchButton)\n\n    expect(props.setFacingMode).toHaveBeenCalledTimes(1)\n  })\n\n  it(\"test handle capture function\", async () => {\n    const props = getProps({ testOverride: WebcamPermission.SUCCESS })\n    render(<WebcamComponent {...props} />)\n    expect(\n      screen.getByTestId(\"stCameraInputWebcamComponent\")\n    ).toBeInTheDocument()\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"Take Photo\" }))\n\n    expect(props.handleCapture).toHaveBeenCalled()\n  })\n})\n"],"mappings":"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"}