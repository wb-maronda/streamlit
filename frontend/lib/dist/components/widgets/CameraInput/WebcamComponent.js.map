{"version":3,"file":"WebcamComponent.js","names":["React","useCallback","useEffect","useRef","useState","Video","useTheme","isMobile","Webcam","debounce","Icon","themeColors","CAMERA_PERMISSION_URL","CameraInputButton","SwitchFacingModeButton","StyledBox","StyledCameraInput","StyledDescription","StyledLink","jsx","_jsx","jsxs","_jsxs","WebcamPermission","AskForCameraPermission","_ref","width","children","size","color","gray60","content","href","rel","target","WebcamComponent","_ref2","handleCapture","disabled","clearPhotoInProgress","setClearPhotoInProgress","facingMode","setFacingMode","testOverride","webcamPermission","setWebcamPermissionState","PENDING","videoRef","debouncedWidth","setDebouncedWidth","memoizedSetDebouncedCallback","capture","current","imageSrc","getScreenshot","theme","SUCCESS","switchFacingMode","hidden","audio","ref","screenshotFormat","screenshotQuality","height","style","borderRadius","radii","default","onUserMediaError","ERROR","onUserMedia","videoConstraints","ideal","onClick"],"sources":["../../../../src/components/widgets/CameraInput/WebcamComponent.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\n\nimport { Video } from \"@emotion-icons/open-iconic\"\nimport { useTheme } from \"@emotion/react\"\nimport { isMobile } from \"react-device-detect\"\nimport Webcam from \"react-webcam\"\n\nimport { debounce } from \"@streamlit/lib/src/util/utils\"\nimport Icon from \"@streamlit/lib/src/components/shared/Icon\"\nimport { EmotionTheme } from \"@streamlit/lib/src/theme\"\nimport themeColors from \"@streamlit/lib/src/theme/emotionBaseTheme/themeColors\"\nimport { CAMERA_PERMISSION_URL } from \"@streamlit/lib/src/urls\"\n\nimport CameraInputButton from \"./CameraInputButton\"\nimport SwitchFacingModeButton, { FacingMode } from \"./SwitchFacingModeButton\"\nimport {\n  StyledBox,\n  StyledCameraInput,\n  StyledDescription,\n  StyledLink,\n} from \"./styled-components\"\n\nexport interface Props {\n  handleCapture: (capturedPhoto: string | null) => void\n  width: number\n  disabled: boolean\n  clearPhotoInProgress: boolean\n  setClearPhotoInProgress: (clearPhotoInProgress: boolean) => void\n  facingMode: FacingMode\n  setFacingMode: () => void\n  // Allow for unit testing\n  testOverride?: WebcamPermission\n}\n\nexport enum WebcamPermission {\n  PENDING = \"pending\",\n  SUCCESS = \"success\",\n  ERROR = \"error\",\n}\n\ninterface AskForCameraPermissionProps {\n  width: number\n}\n\nexport const AskForCameraPermission = ({\n  width,\n}: AskForCameraPermissionProps): ReactElement => {\n  return (\n    <StyledBox width={width}>\n      <Icon size=\"threeXL\" color={themeColors.gray60} content={Video} />\n      <StyledDescription>\n        This app would like to use your camera.\n        <StyledLink\n          href={CAMERA_PERMISSION_URL}\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n        >\n          Learn how to allow access.\n        </StyledLink>\n      </StyledDescription>\n    </StyledBox>\n  )\n}\n\nconst WebcamComponent = ({\n  handleCapture,\n  width,\n  disabled,\n  clearPhotoInProgress,\n  setClearPhotoInProgress,\n  facingMode,\n  setFacingMode,\n  testOverride,\n}: Props): ReactElement => {\n  const [webcamPermission, setWebcamPermissionState] = useState(\n    testOverride || WebcamPermission.PENDING\n  )\n  const videoRef = useRef<Webcam>(null)\n\n  const [debouncedWidth, setDebouncedWidth] = useState(width)\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const memoizedSetDebouncedCallback = useCallback(\n    debounce(1000, setDebouncedWidth),\n    []\n  )\n\n  useEffect(() => {\n    memoizedSetDebouncedCallback(width)\n  }, [width, memoizedSetDebouncedCallback])\n\n  function capture(): void {\n    if (videoRef.current !== null) {\n      const imageSrc = videoRef.current.getScreenshot()\n      handleCapture(imageSrc)\n    }\n  }\n\n  const theme: EmotionTheme = useTheme()\n\n  return (\n    <StyledCameraInput\n      width={debouncedWidth}\n      data-testid=\"stCameraInputWebcamComponent\"\n    >\n      {webcamPermission !== WebcamPermission.SUCCESS &&\n      !disabled &&\n      !clearPhotoInProgress ? (\n        <AskForCameraPermission width={debouncedWidth} />\n      ) : (\n        isMobile && <SwitchFacingModeButton switchFacingMode={setFacingMode} />\n      )}\n      <StyledBox\n        data-testid=\"stCameraInputWebcamStyledBox\"\n        hidden={\n          webcamPermission !== WebcamPermission.SUCCESS &&\n          !disabled &&\n          !clearPhotoInProgress\n        }\n        width={debouncedWidth}\n      >\n        {!disabled && (\n          <Webcam\n            audio={false}\n            ref={videoRef}\n            screenshotFormat=\"image/jpeg\"\n            screenshotQuality={1}\n            width={debouncedWidth}\n            // We keep Aspect ratio of container always equal 16 / 9.\n            // The aspect ration of video stream may be different depending on a camera.\n            height={(debouncedWidth * 9) / 16}\n            style={{\n              borderRadius: `${theme.radii.default} ${theme.radii.default} 0 0`,\n            }}\n            onUserMediaError={() => {\n              setWebcamPermissionState(WebcamPermission.ERROR)\n            }}\n            onUserMedia={() => {\n              setWebcamPermissionState(WebcamPermission.SUCCESS)\n              setClearPhotoInProgress(false)\n            }}\n            videoConstraints={{\n              width: { ideal: debouncedWidth },\n              facingMode,\n            }}\n          />\n        )}\n      </StyledBox>\n      <CameraInputButton\n        onClick={capture}\n        disabled={\n          webcamPermission !== WebcamPermission.SUCCESS ||\n          disabled ||\n          clearPhotoInProgress\n        }\n      >\n        Take Photo\n      </CameraInputButton>\n    </StyledCameraInput>\n  )\n}\n\nexport default WebcamComponent\n"],"mappings":"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"}