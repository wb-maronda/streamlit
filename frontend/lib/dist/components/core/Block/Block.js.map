{"version":3,"file":"Block.js","names":["React","useContext","useEffect","useMemo","useRef","useTheme","LibContext","BlockNode","ElementNode","getElementWidgetID","notNullOrUndefined","Form","Tabs","Popover","ChatMessage","Dialog","Expander","useScrollToBottom","isComponentStale","shouldComponentBeEnabled","assignDividerColor","ElementNodeRenderer","StyledColumn","StyledHorizontalBlock","StyledVerticalBlock","StyledVerticalBlockWrapper","StyledVerticalBlockBorderWrapper","Fragment","_Fragment","jsx","_jsx","BlockNodeRenderer","props","node","fragmentIdsThisRun","isEmpty","deltaBlock","allowEmpty","enable","scriptRunState","isStale","scriptRunId","childProps","disableFullscreenMode","dialog","popover","child","LayoutBlock","element","children","expandable","empty","width","type","formId","clearOnSubmit","border","form","submitButtons","formsData","get","hasSubmitButton","undefined","length","widgetMgr","chatMessage","endpoints","column","_node$deltaBlock$colu","_node$deltaBlock$colu2","_node$deltaBlock$colu3","weight","gap","verticalAlignment","tabContainer","renderTabContent","mappedChildProps","VerticalBlock","tabsProps","ChildRenderer","libConfig","map","index","key","Error","concat","ScrollToBottomVerticalBlockWrapper","height","scrollContainerRef","ref","_props$node$deltaBloc","_props$node$deltaBloc2","_props$node$deltaBloc3","wrapperElement","setWidth","useState","observer","ResizeObserver","_ref","entry","window","requestAnimationFrame","target","getBoundingClientRect","vertical","activateScrollToBottom","find","current","observe","disconnect","VerticalBlockBorderWrapper","propsWithNewWidth","HorizontalBlock","_props$node$deltaBloc4","_props$node$deltaBloc5","horizontal"],"sources":["../../../../src/components/core/Block/Block.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ReactElement,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  ReactNode,\n} from \"react\"\nimport { useTheme } from \"@emotion/react\"\nimport { LibContext } from \"@streamlit/lib/src/components/core/LibContext\"\nimport { Block as BlockProto } from \"@streamlit/lib/src/proto\"\nimport { BlockNode, AppNode, ElementNode } from \"@streamlit/lib/src/AppNode\"\nimport {\n  getElementWidgetID,\n  notNullOrUndefined,\n} from \"@streamlit/lib/src/util/utils\"\nimport { Form } from \"@streamlit/lib/src/components/widgets/Form\"\nimport Tabs, { TabProps } from \"@streamlit/lib/src/components/elements/Tabs\"\nimport Popover from \"@streamlit/lib/src/components/elements/Popover\"\nimport ChatMessage from \"@streamlit/lib/src/components/elements/ChatMessage\"\nimport Dialog from \"@streamlit/lib/src/components/elements/Dialog\"\nimport Expander from \"@streamlit/lib/src/components/elements/Expander\"\nimport { useScrollToBottom } from \"@streamlit/lib/src/hooks/useScrollToBottom\"\n\nimport {\n  BaseBlockProps,\n  isComponentStale,\n  shouldComponentBeEnabled,\n  assignDividerColor,\n} from \"./utils\"\nimport ElementNodeRenderer from \"./ElementNodeRenderer\"\n\nimport {\n  StyledColumn,\n  StyledHorizontalBlock,\n  StyledVerticalBlock,\n  StyledVerticalBlockWrapper,\n  StyledVerticalBlockBorderWrapper,\n  StyledVerticalBlockBorderWrapperProps,\n} from \"./styled-components\"\n\nexport interface BlockPropsWithoutWidth extends BaseBlockProps {\n  node: BlockNode\n}\n\ninterface BlockPropsWithWidth extends BaseBlockProps {\n  node: BlockNode\n  width: number\n}\n\n// Render BlockNodes (i.e. container nodes).\nconst BlockNodeRenderer = (props: BlockPropsWithWidth): ReactElement => {\n  const { node } = props\n  const { fragmentIdsThisRun } = useContext(LibContext)\n\n  if (node.isEmpty && !node.deltaBlock.allowEmpty) {\n    return <></>\n  }\n\n  const enable = shouldComponentBeEnabled(\"\", props.scriptRunState)\n  const isStale = isComponentStale(\n    enable,\n    node,\n    props.scriptRunState,\n    props.scriptRunId,\n    fragmentIdsThisRun\n  )\n\n  const childProps = { ...props, ...{ node } }\n\n  const disableFullscreenMode =\n    props.disableFullscreenMode ||\n    notNullOrUndefined(node.deltaBlock.dialog) ||\n    notNullOrUndefined(node.deltaBlock.popover)\n\n  const child: ReactElement = (\n    <LayoutBlock\n      {...childProps}\n      disableFullscreenMode={disableFullscreenMode}\n    />\n  )\n\n  if (node.deltaBlock.dialog) {\n    return (\n      <Dialog element={node.deltaBlock.dialog as BlockProto.Dialog}>\n        {child}\n      </Dialog>\n    )\n  }\n\n  if (node.deltaBlock.expandable) {\n    return (\n      <Expander\n        empty={node.isEmpty}\n        isStale={isStale}\n        element={node.deltaBlock.expandable as BlockProto.Expandable}\n      >\n        {child}\n      </Expander>\n    )\n  }\n\n  if (node.deltaBlock.popover) {\n    return (\n      <Popover\n        empty={node.isEmpty}\n        element={node.deltaBlock.popover as BlockProto.Popover}\n        width={props.width}\n      >\n        {child}\n      </Popover>\n    )\n  }\n\n  if (node.deltaBlock.type === \"form\") {\n    const { formId, clearOnSubmit, border } = node.deltaBlock\n      .form as BlockProto.Form\n    const submitButtons = props.formsData.submitButtons.get(formId)\n    const hasSubmitButton =\n      submitButtons !== undefined && submitButtons.length > 0\n    return (\n      <Form\n        formId={formId}\n        clearOnSubmit={clearOnSubmit}\n        width={props.width}\n        hasSubmitButton={hasSubmitButton}\n        scriptRunState={props.scriptRunState}\n        widgetMgr={props.widgetMgr}\n        border={border}\n      >\n        {child}\n      </Form>\n    )\n  }\n\n  if (node.deltaBlock.chatMessage) {\n    return (\n      <ChatMessage\n        element={node.deltaBlock.chatMessage as BlockProto.ChatMessage}\n        endpoints={props.endpoints}\n      >\n        {child}\n      </ChatMessage>\n    )\n  }\n\n  if (node.deltaBlock.column) {\n    return (\n      <StyledColumn\n        weight={node.deltaBlock.column.weight ?? 0}\n        gap={node.deltaBlock.column.gap ?? \"\"}\n        verticalAlignment={\n          node.deltaBlock.column.verticalAlignment ?? undefined\n        }\n        data-testid=\"column\"\n      >\n        {child}\n      </StyledColumn>\n    )\n  }\n\n  if (node.deltaBlock.tabContainer) {\n    const renderTabContent = (\n      mappedChildProps: JSX.IntrinsicAttributes & BlockPropsWithoutWidth\n    ): ReactElement => {\n      // avoid circular dependency where Tab uses VerticalBlock but VerticalBlock uses tabs\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      return <VerticalBlock {...mappedChildProps}></VerticalBlock>\n    }\n    const tabsProps: TabProps = { ...childProps, isStale, renderTabContent }\n    return <Tabs {...tabsProps} />\n  }\n\n  return child\n}\n\nconst ChildRenderer = (props: BlockPropsWithWidth): ReactElement => {\n  const { libConfig } = useContext(LibContext)\n\n  // Handle cycling of colors for dividers:\n  assignDividerColor(props.node, useTheme())\n\n  return (\n    <>\n      {props.node.children &&\n        props.node.children.map(\n          (node: AppNode, index: number): ReactElement => {\n            const disableFullscreenMode =\n              libConfig.disableFullscreenMode || props.disableFullscreenMode\n\n            // Base case: render a leaf node.\n            if (node instanceof ElementNode) {\n              // Put node in childProps instead of passing as a node={node} prop in React to\n              // guarantee it doesn't get overwritten by {...childProps}.\n              const childProps = {\n                ...props,\n                disableFullscreenMode,\n                node: node as ElementNode,\n              }\n\n              const key = getElementWidgetID(node.element) || index\n              return <ElementNodeRenderer key={key} {...childProps} />\n            }\n\n            // Recursive case: render a block, which can contain other blocks\n            // and elements.\n            if (node instanceof BlockNode) {\n              // Put node in childProps instead of passing as a node={node} prop in React to\n              // guarantee it doesn't get overwritten by {...childProps}.\n              const childProps = {\n                ...props,\n                disableFullscreenMode,\n                node: node as BlockNode,\n              }\n\n              return <BlockNodeRenderer key={index} {...childProps} />\n            }\n\n            // We don't have any other node types!\n            throw new Error(`Unrecognized AppNode: ${node}`)\n          }\n        )}\n    </>\n  )\n}\n\nexport interface ScrollToBottomVerticalBlockWrapperProps\n  extends StyledVerticalBlockBorderWrapperProps {\n  children: ReactNode\n}\n\n// A wrapper for Vertical Block that adds scrolling with pinned to bottom behavior.\nfunction ScrollToBottomVerticalBlockWrapper(\n  props: ScrollToBottomVerticalBlockWrapperProps\n): ReactElement {\n  const { border, height, children } = props\n  const scrollContainerRef = useScrollToBottom()\n\n  return (\n    <StyledVerticalBlockBorderWrapper\n      border={border}\n      height={height}\n      data-testid=\"stVerticalBlockBorderWrapper\"\n      data-test-scroll-behavior=\"scroll-to-bottom\"\n      ref={scrollContainerRef as React.RefObject<HTMLDivElement>}\n    >\n      {children}\n    </StyledVerticalBlockBorderWrapper>\n  )\n}\n\n// Currently, only VerticalBlocks will ever contain leaf elements. But this is only enforced on the\n// Python side.\nconst VerticalBlock = (props: BlockPropsWithoutWidth): ReactElement => {\n  const wrapperElement = useRef<HTMLDivElement>(null)\n  const [width, setWidth] = React.useState(-1)\n\n  const observer = useMemo(\n    () =>\n      new ResizeObserver(([entry]) => {\n        // Since the setWidth will perform changes to the DOM,\n        // we need wrap it in a requestAnimationFrame to avoid this error:\n        // ResizeObserver loop completed with undelivered notifications.\n        window.requestAnimationFrame(() => {\n          // We need to determine the available width here to be able to set\n          // an explicit width for the `StyledVerticalBlock`.\n\n          // The width should never be set to 0 since it can cause\n          // flickering effects.\n          setWidth(entry.target.getBoundingClientRect().width || -1)\n        })\n      }),\n    [setWidth]\n  )\n\n  const border = props.node.deltaBlock.vertical?.border ?? false\n  const height = props.node.deltaBlock.vertical?.height || undefined\n\n  const activateScrollToBottom =\n    height &&\n    props.node.children.find(node => {\n      return (\n        node instanceof BlockNode && node.deltaBlock.type === \"chatMessage\"\n      )\n    }) !== undefined\n\n  useEffect(() => {\n    if (wrapperElement.current) {\n      observer.observe(wrapperElement.current)\n    }\n    return () => {\n      observer.disconnect()\n    }\n    // We need to update the observer whenever the scrolling is activated or deactivated\n    // Otherwise, it still tries to measure the width of the old wrapper element.\n    /* eslint-disable react-hooks/exhaustive-deps */\n  }, [observer, activateScrollToBottom])\n\n  // Decide which wrapper to use based on whether we need to activate scrolling to bottom\n  // This is done for performance reasons, to prevent the usage of useScrollToBottom\n  // if it is not needed.\n  const VerticalBlockBorderWrapper = activateScrollToBottom\n    ? ScrollToBottomVerticalBlockWrapper\n    : StyledVerticalBlockBorderWrapper\n\n  const propsWithNewWidth = {\n    ...props,\n    ...{ width },\n  }\n  // Widths of children autosizes to container width (and therefore window width).\n  // StyledVerticalBlocks are the only things that calculate their own widths. They should never use\n  // the width value coming from the parent via props.\n\n  // To apply a border, we need to wrap the StyledVerticalBlockWrapper again, otherwise the width\n  // calculation would not take the padding into consideration.\n  return (\n    <VerticalBlockBorderWrapper\n      border={border}\n      height={height}\n      data-testid=\"stVerticalBlockBorderWrapper\"\n      data-test-scroll-behavior=\"normal\"\n    >\n      <StyledVerticalBlockWrapper ref={wrapperElement}>\n        <StyledVerticalBlock width={width} data-testid=\"stVerticalBlock\">\n          <ChildRenderer {...propsWithNewWidth} />\n        </StyledVerticalBlock>\n      </StyledVerticalBlockWrapper>\n    </VerticalBlockBorderWrapper>\n  )\n}\n\nconst HorizontalBlock = (props: BlockPropsWithWidth): ReactElement => {\n  // Create a horizontal block as the parent for columns.\n  // The children are always columns, but this is not checked. We just trust the Python side to\n  // do the right thing, then we ask ChildRenderer to handle it.\n  const gap = props.node.deltaBlock.horizontal?.gap ?? \"\"\n\n  return (\n    <StyledHorizontalBlock gap={gap} data-testid=\"stHorizontalBlock\">\n      <ChildRenderer {...props} />\n    </StyledHorizontalBlock>\n  )\n}\n\n// A container block with one of two types of layouts: vertical and horizontal.\nfunction LayoutBlock(props: BlockPropsWithWidth): ReactElement {\n  if (props.node.deltaBlock.horizontal) {\n    return <HorizontalBlock {...props} />\n  }\n\n  return <VerticalBlock {...props} />\n}\n\nexport default VerticalBlock\n"],"mappings":"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"}