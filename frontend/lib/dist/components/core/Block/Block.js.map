{"version":3,"file":"Block.js","names":["React","useContext","useEffect","useMemo","useRef","classNames","useTheme","LibContext","BlockNode","ElementNode","getElementId","notNullOrUndefined","Form","Tabs","Popover","ChatMessage","Dialog","Expander","useScrollToBottom","assignDividerColor","convertKeyToClassName","getKeyFromId","isComponentStale","shouldComponentBeEnabled","ElementNodeRenderer","StyledColumn","StyledHorizontalBlock","StyledVerticalBlock","StyledVerticalBlockBorderWrapper","StyledVerticalBlockWrapper","Fragment","_Fragment","jsx","_jsx","BlockNodeRenderer","props","node","fragmentIdsThisRun","isEmpty","deltaBlock","allowEmpty","enable","scriptRunState","isStale","scriptRunId","childProps","disableFullscreenMode","dialog","popover","child","LayoutBlock","element","deltaMsgReceivedAt","children","expandable","empty","width","type","formId","clearOnSubmit","enterToSubmit","border","form","submitButtons","formsData","get","hasSubmitButton","undefined","length","widgetMgr","chatMessage","endpoints","column","weight","gap","verticalAlignment","className","tabContainer","renderTabContent","mappedChildProps","VerticalBlock","tabsProps","ChildRenderer","libConfig","elementKeySet","Set","map","index","key","toString","has","add","Error","ScrollToBottomVerticalBlockWrapper","height","scrollContainerRef","ref","wrapperElement","setWidth","useState","observer","ResizeObserver","_ref","entry","window","requestAnimationFrame","target","getBoundingClientRect","vertical","activateScrollToBottom","find","current","observe","disconnect","VerticalBlockBorderWrapper","propsWithNewWidth","userKey","id","HorizontalBlock","horizontal"],"sources":["../../../../src/components/core/Block/Block.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ReactElement,\n  ReactNode,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n} from \"react\"\n\nimport classNames from \"classnames\"\nimport { useTheme } from \"@emotion/react\"\n\nimport { LibContext } from \"@streamlit/lib/src/components/core/LibContext\"\nimport { Block as BlockProto } from \"@streamlit/lib/src/proto\"\nimport { AppNode, BlockNode, ElementNode } from \"@streamlit/lib/src/AppNode\"\nimport {\n  getElementId,\n  notNullOrUndefined,\n} from \"@streamlit/lib/src/util/utils\"\nimport { Form } from \"@streamlit/lib/src/components/widgets/Form\"\nimport Tabs, { TabProps } from \"@streamlit/lib/src/components/elements/Tabs\"\nimport Popover from \"@streamlit/lib/src/components/elements/Popover\"\nimport ChatMessage from \"@streamlit/lib/src/components/elements/ChatMessage\"\nimport Dialog from \"@streamlit/lib/src/components/elements/Dialog\"\nimport Expander from \"@streamlit/lib/src/components/elements/Expander\"\nimport { useScrollToBottom } from \"@streamlit/lib/src/hooks/useScrollToBottom\"\n\nimport {\n  assignDividerColor,\n  BaseBlockProps,\n  convertKeyToClassName,\n  getKeyFromId,\n  isComponentStale,\n  shouldComponentBeEnabled,\n} from \"./utils\"\nimport ElementNodeRenderer from \"./ElementNodeRenderer\"\nimport {\n  StyledColumn,\n  StyledHorizontalBlock,\n  StyledVerticalBlock,\n  StyledVerticalBlockBorderWrapper,\n  StyledVerticalBlockBorderWrapperProps,\n  StyledVerticalBlockWrapper,\n} from \"./styled-components\"\n\nexport interface BlockPropsWithoutWidth extends BaseBlockProps {\n  node: BlockNode\n}\n\ninterface BlockPropsWithWidth extends BaseBlockProps {\n  node: BlockNode\n  width: number\n}\n\n// Render BlockNodes (i.e. container nodes).\nconst BlockNodeRenderer = (props: BlockPropsWithWidth): ReactElement => {\n  const { node } = props\n  const { fragmentIdsThisRun } = useContext(LibContext)\n\n  if (node.isEmpty && !node.deltaBlock.allowEmpty) {\n    return <></>\n  }\n\n  const enable = shouldComponentBeEnabled(\"\", props.scriptRunState)\n  const isStale = isComponentStale(\n    enable,\n    node,\n    props.scriptRunState,\n    props.scriptRunId,\n    fragmentIdsThisRun\n  )\n\n  const childProps = { ...props, ...{ node } }\n\n  const disableFullscreenMode =\n    props.disableFullscreenMode ||\n    notNullOrUndefined(node.deltaBlock.dialog) ||\n    notNullOrUndefined(node.deltaBlock.popover)\n\n  const child: ReactElement = (\n    <LayoutBlock\n      {...childProps}\n      disableFullscreenMode={disableFullscreenMode}\n    />\n  )\n\n  if (node.deltaBlock.dialog) {\n    return (\n      <Dialog\n        element={node.deltaBlock.dialog as BlockProto.Dialog}\n        deltaMsgReceivedAt={node.deltaMsgReceivedAt}\n      >\n        {child}\n      </Dialog>\n    )\n  }\n\n  if (node.deltaBlock.expandable) {\n    return (\n      <Expander\n        empty={node.isEmpty}\n        isStale={isStale}\n        element={node.deltaBlock.expandable as BlockProto.Expandable}\n      >\n        {child}\n      </Expander>\n    )\n  }\n\n  if (node.deltaBlock.popover) {\n    return (\n      <Popover\n        empty={node.isEmpty}\n        element={node.deltaBlock.popover as BlockProto.Popover}\n        width={props.width}\n      >\n        {child}\n      </Popover>\n    )\n  }\n\n  if (node.deltaBlock.type === \"form\") {\n    const { formId, clearOnSubmit, enterToSubmit, border } = node.deltaBlock\n      .form as BlockProto.Form\n    const submitButtons = props.formsData.submitButtons.get(formId)\n    const hasSubmitButton =\n      submitButtons !== undefined && submitButtons.length > 0\n    return (\n      <Form\n        formId={formId}\n        clearOnSubmit={clearOnSubmit}\n        enterToSubmit={enterToSubmit}\n        width={props.width}\n        hasSubmitButton={hasSubmitButton}\n        scriptRunState={props.scriptRunState}\n        widgetMgr={props.widgetMgr}\n        border={border}\n      >\n        {child}\n      </Form>\n    )\n  }\n\n  if (node.deltaBlock.chatMessage) {\n    return (\n      <ChatMessage\n        element={node.deltaBlock.chatMessage as BlockProto.ChatMessage}\n        endpoints={props.endpoints}\n      >\n        {child}\n      </ChatMessage>\n    )\n  }\n\n  if (node.deltaBlock.column) {\n    return (\n      <StyledColumn\n        weight={node.deltaBlock.column.weight ?? 0}\n        gap={node.deltaBlock.column.gap ?? \"\"}\n        verticalAlignment={\n          node.deltaBlock.column.verticalAlignment ?? undefined\n        }\n        className=\"stColumn\"\n        data-testid=\"stColumn\"\n      >\n        {child}\n      </StyledColumn>\n    )\n  }\n\n  if (node.deltaBlock.tabContainer) {\n    const renderTabContent = (\n      mappedChildProps: JSX.IntrinsicAttributes & BlockPropsWithoutWidth\n    ): ReactElement => {\n      // avoid circular dependency where Tab uses VerticalBlock but VerticalBlock uses tabs\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      return <VerticalBlock {...mappedChildProps}></VerticalBlock>\n    }\n    const tabsProps: TabProps = { ...childProps, isStale, renderTabContent }\n    return <Tabs {...tabsProps} />\n  }\n\n  return child\n}\n\nconst ChildRenderer = (props: BlockPropsWithWidth): ReactElement => {\n  const { libConfig } = useContext(LibContext)\n\n  // Handle cycling of colors for dividers:\n  assignDividerColor(props.node, useTheme())\n\n  // Capture all the element ids to avoid rendering the same element twice\n  const elementKeySet = new Set<string>()\n\n  return (\n    <>\n      {props.node.children &&\n        props.node.children.map((node: AppNode, index: number): ReactNode => {\n          const disableFullscreenMode =\n            libConfig.disableFullscreenMode || props.disableFullscreenMode\n\n          // Base case: render a leaf node.\n          if (node instanceof ElementNode) {\n            // Put node in childProps instead of passing as a node={node} prop in React to\n            // guarantee it doesn't get overwritten by {...childProps}.\n            const childProps = {\n              ...props,\n              disableFullscreenMode,\n              node: node as ElementNode,\n            }\n\n            const key = getElementId(node.element) || index.toString()\n            // Avoid rendering the same element twice. We assume the first one is the one we want\n            // because the page is rendered top to bottom, so a valid widget would be rendered\n            // correctly and we assume the second one is therefore stale (or throw an error).\n            // Also, our setIn logic pushes stale widgets down in the list of elements, so the\n            // most recent one should always come first.\n            if (elementKeySet.has(key)) {\n              return null\n            }\n\n            elementKeySet.add(key)\n\n            return <ElementNodeRenderer key={key} {...childProps} />\n          }\n\n          // Recursive case: render a block, which can contain other blocks\n          // and elements.\n          if (node instanceof BlockNode) {\n            // Put node in childProps instead of passing as a node={node} prop in React to\n            // guarantee it doesn't get overwritten by {...childProps}.\n            const childProps = {\n              ...props,\n              disableFullscreenMode,\n              node: node as BlockNode,\n            }\n\n            return <BlockNodeRenderer key={index} {...childProps} />\n          }\n\n          // We don't have any other node types!\n          throw new Error(`Unrecognized AppNode: ${node}`)\n        })}\n    </>\n  )\n}\n\nexport interface ScrollToBottomVerticalBlockWrapperProps\n  extends StyledVerticalBlockBorderWrapperProps {\n  children: ReactNode\n}\n\n// A wrapper for Vertical Block that adds scrolling with pinned to bottom behavior.\nfunction ScrollToBottomVerticalBlockWrapper(\n  props: ScrollToBottomVerticalBlockWrapperProps\n): ReactElement {\n  const { border, height, children } = props\n  const scrollContainerRef = useScrollToBottom()\n\n  return (\n    <StyledVerticalBlockBorderWrapper\n      border={border}\n      height={height}\n      data-testid=\"stVerticalBlockBorderWrapper\"\n      data-test-scroll-behavior=\"scroll-to-bottom\"\n      ref={scrollContainerRef as React.RefObject<HTMLDivElement>}\n    >\n      {children}\n    </StyledVerticalBlockBorderWrapper>\n  )\n}\n\n// Currently, only VerticalBlocks will ever contain leaf elements. But this is only enforced on the\n// Python side.\nconst VerticalBlock = (props: BlockPropsWithoutWidth): ReactElement => {\n  const wrapperElement = useRef<HTMLDivElement>(null)\n  const [width, setWidth] = React.useState(-1)\n\n  const observer = useMemo(\n    () =>\n      new ResizeObserver(([entry]) => {\n        // Since the setWidth will perform changes to the DOM,\n        // we need wrap it in a requestAnimationFrame to avoid this error:\n        // ResizeObserver loop completed with undelivered notifications.\n        window.requestAnimationFrame(() => {\n          // We need to determine the available width here to be able to set\n          // an explicit width for the `StyledVerticalBlock`.\n\n          // The width should never be set to 0 since it can cause\n          // flickering effects.\n          setWidth(entry.target.getBoundingClientRect().width || -1)\n        })\n      }),\n    [setWidth]\n  )\n\n  const border = props.node.deltaBlock.vertical?.border ?? false\n  const height = props.node.deltaBlock.vertical?.height || undefined\n\n  const activateScrollToBottom =\n    height &&\n    props.node.children.find(node => {\n      return (\n        node instanceof BlockNode && node.deltaBlock.type === \"chatMessage\"\n      )\n    }) !== undefined\n\n  useEffect(() => {\n    if (wrapperElement.current) {\n      observer.observe(wrapperElement.current)\n    }\n    return () => {\n      observer.disconnect()\n    }\n    // We need to update the observer whenever the scrolling is activated or deactivated\n    // Otherwise, it still tries to measure the width of the old wrapper element.\n    /* eslint-disable react-hooks/exhaustive-deps */\n  }, [observer, activateScrollToBottom])\n\n  // Decide which wrapper to use based on whether we need to activate scrolling to bottom\n  // This is done for performance reasons, to prevent the usage of useScrollToBottom\n  // if it is not needed.\n  const VerticalBlockBorderWrapper = activateScrollToBottom\n    ? ScrollToBottomVerticalBlockWrapper\n    : StyledVerticalBlockBorderWrapper\n\n  const propsWithNewWidth = {\n    ...props,\n    ...{ width },\n  }\n  // Extract the user-specified key from the block ID (if provided):\n  const userKey = getKeyFromId(props.node.deltaBlock.id)\n\n  // Widths of children autosizes to container width (and therefore window width).\n  // StyledVerticalBlocks are the only things that calculate their own widths. They should never use\n  // the width value coming from the parent via props.\n\n  // To apply a border, we need to wrap the StyledVerticalBlockWrapper again, otherwise the width\n  // calculation would not take the padding into consideration.\n  return (\n    <VerticalBlockBorderWrapper\n      border={border}\n      height={height}\n      data-testid=\"stVerticalBlockBorderWrapper\"\n      data-test-scroll-behavior=\"normal\"\n    >\n      <StyledVerticalBlockWrapper ref={wrapperElement}>\n        <StyledVerticalBlock\n          width={width}\n          className={classNames(\n            \"stVerticalBlock\",\n            convertKeyToClassName(userKey)\n          )}\n          data-testid=\"stVerticalBlock\"\n        >\n          <ChildRenderer {...propsWithNewWidth} />\n        </StyledVerticalBlock>\n      </StyledVerticalBlockWrapper>\n    </VerticalBlockBorderWrapper>\n  )\n}\n\nconst HorizontalBlock = (props: BlockPropsWithWidth): ReactElement => {\n  // Create a horizontal block as the parent for columns.\n  // The children are always columns, but this is not checked. We just trust the Python side to\n  // do the right thing, then we ask ChildRenderer to handle it.\n  const gap = props.node.deltaBlock.horizontal?.gap ?? \"\"\n\n  return (\n    <StyledHorizontalBlock\n      gap={gap}\n      className=\"stHorizontalBlock\"\n      data-testid=\"stHorizontalBlock\"\n    >\n      <ChildRenderer {...props} />\n    </StyledHorizontalBlock>\n  )\n}\n\n// A container block with one of two types of layouts: vertical and horizontal.\nfunction LayoutBlock(props: BlockPropsWithWidth): ReactElement {\n  if (props.node.deltaBlock.horizontal) {\n    return <HorizontalBlock {...props} />\n  }\n\n  return <VerticalBlock {...props} />\n}\n\nexport default VerticalBlock\n"],"mappings":"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"}