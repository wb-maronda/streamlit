{"version":3,"file":"ElementNodeRenderer.test.js","names":["React","screen","waitFor","render","Balloons","BalloonsProto","ForwardMsgMetadata","Snow","SnowProto","ElementNode","ScriptRunState","createFormsData","WidgetStateManager","FileUploadClient","ComponentRegistry","mockEndpoints","mockSessionInfo","ElementNodeRenderer","jsx","_jsx","FAKE_SCRIPT_HASH","createBalloonNode","scriptRunId","node","show","create","element","type","createSnowNode","getProps","props","sessionInfo","endpoints","scriptRunState","RUNNING","widgetMgr","sendRerunBackMsg","jest","fn","formsDataChanged","widgetsDisabled","uploadClient","formsWithPendingRequestsChanged","requestFileURLs","componentRegistry","formsData","width","describe","it","expect","queryByTestId","toBeNull","elementNodeRenderer","getByTestId","toBeInTheDocument","toHaveClass","children","toHaveLength","elementRendererChildren"],"sources":["../../../../src/components/core/Block/ElementNodeRenderer.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport \"@testing-library/jest-dom\"\nimport { screen, waitFor } from \"@testing-library/react\"\n\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport {\n  Balloons as BalloonsProto,\n  ForwardMsgMetadata,\n  Snow as SnowProto,\n} from \"@streamlit/lib/src/proto\"\nimport { ElementNode } from \"@streamlit/lib/src/AppNode\"\nimport { ScriptRunState } from \"@streamlit/lib/src/ScriptRunState\"\nimport {\n  createFormsData,\n  WidgetStateManager,\n} from \"@streamlit/lib/src/WidgetStateManager\"\nimport { FileUploadClient } from \"@streamlit/lib/src/FileUploadClient\"\nimport { ComponentRegistry } from \"@streamlit/lib/src/components/widgets/CustomComponent\"\nimport { mockEndpoints, mockSessionInfo } from \"@streamlit/lib/src/mocks/mocks\"\n\nimport ElementNodeRenderer, {\n  ElementNodeRendererProps,\n} from \"./ElementNodeRenderer\"\n\nconst FAKE_SCRIPT_HASH = \"fake_script_hash\"\n\nfunction createBalloonNode(scriptRunId: string): ElementNode {\n  const node = new ElementNode(\n    new BalloonsProto({\n      show: true,\n    }),\n    ForwardMsgMetadata.create({}),\n    scriptRunId,\n    FAKE_SCRIPT_HASH\n  )\n  node.element.type = \"balloons\"\n  return node\n}\n\nfunction createSnowNode(scriptRunId: string): ElementNode {\n  const node = new ElementNode(\n    new SnowProto({\n      show: true,\n    }),\n    ForwardMsgMetadata.create({}),\n    scriptRunId,\n    FAKE_SCRIPT_HASH\n  )\n  node.element.type = \"snow\"\n  return node\n}\n\nfunction getProps(\n  props: Partial<ElementNodeRendererProps> &\n    Pick<ElementNodeRendererProps, \"node\" | \"scriptRunId\">\n): ElementNodeRendererProps {\n  const sessionInfo = mockSessionInfo()\n  const endpoints = mockEndpoints()\n  return {\n    endpoints: endpoints,\n    scriptRunState: ScriptRunState.RUNNING,\n    sessionInfo: sessionInfo,\n    widgetMgr: new WidgetStateManager({\n      sendRerunBackMsg: jest.fn(),\n      formsDataChanged: jest.fn(),\n    }),\n    widgetsDisabled: false,\n    uploadClient: new FileUploadClient({\n      sessionInfo: sessionInfo,\n      endpoints,\n      formsWithPendingRequestsChanged: () => {},\n      requestFileURLs: jest.fn(),\n    }),\n    componentRegistry: new ComponentRegistry(endpoints),\n    formsData: createFormsData(),\n    width: 1000,\n    ...props,\n  }\n}\n\ndescribe(\"ElementNodeRenderer Block Component\", () => {\n  describe(\"render Balloons\", () => {\n    it(\"should NOT render a stale component\", async () => {\n      const scriptRunId = \"SCRIPT_RUN_ID\"\n      const props = getProps({\n        node: createBalloonNode(scriptRunId),\n        scriptRunId: \"NEW_SCRIPT_ID\",\n      })\n      render(<ElementNodeRenderer {...props} />)\n\n      await waitFor(() =>\n        expect(screen.queryByTestId(\"stSkeleton\")).toBeNull()\n      )\n      const elementNodeRenderer = screen.getByTestId(\"stElementContainer\")\n      expect(elementNodeRenderer).toBeInTheDocument()\n      expect(elementNodeRenderer).toHaveClass(\"stElementContainer\")\n      // eslint-disable-next-line testing-library/no-node-access\n      expect(elementNodeRenderer.children).toHaveLength(0)\n    })\n\n    it(\"should render a fresh component\", async () => {\n      const scriptRunId = \"SCRIPT_RUN_ID\"\n      const props = getProps({\n        node: createBalloonNode(scriptRunId),\n        scriptRunId,\n      })\n      render(<ElementNodeRenderer {...props} />)\n\n      await waitFor(() =>\n        expect(screen.queryByTestId(\"stSkeleton\")).toBeNull()\n      )\n      const elementNodeRenderer = screen.getByTestId(\"stElementContainer\")\n      expect(elementNodeRenderer).toBeInTheDocument()\n      // eslint-disable-next-line testing-library/no-node-access\n      const elementRendererChildren = elementNodeRenderer.children\n      expect(elementRendererChildren).toHaveLength(1)\n      expect(elementRendererChildren[0]).toHaveClass(\"stBalloons\")\n    })\n  })\n\n  describe(\"render Snow\", () => {\n    it(\"should NOT render a stale component\", async () => {\n      const scriptRunId = \"SCRIPT_RUN_ID\"\n      const props = getProps({\n        node: createSnowNode(scriptRunId),\n        scriptRunId: \"NEW_SCRIPT_ID\",\n      })\n      render(<ElementNodeRenderer {...props} />)\n\n      await waitFor(() =>\n        expect(screen.queryByTestId(\"stSkeleton\")).toBeNull()\n      )\n      const elementNodeRenderer = screen.getByTestId(\"stElementContainer\")\n      expect(elementNodeRenderer).toBeInTheDocument()\n      // eslint-disable-next-line testing-library/no-node-access\n      expect(elementNodeRenderer.children).toHaveLength(0)\n    })\n\n    it(\"should render a fresh component\", async () => {\n      const scriptRunId = \"SCRIPT_RUN_ID\"\n      const props = getProps({\n        node: createSnowNode(scriptRunId),\n        scriptRunId,\n      })\n      render(<ElementNodeRenderer {...props} />)\n\n      await waitFor(() =>\n        expect(screen.queryByTestId(\"stSkeleton\")).toBeNull()\n      )\n      const elementNodeRenderer = screen.getByTestId(\"stElementContainer\")\n      expect(elementNodeRenderer).toBeInTheDocument()\n      // eslint-disable-next-line testing-library/no-node-access\n      const elementRendererChildren = elementNodeRenderer.children\n      expect(elementRendererChildren).toHaveLength(1)\n      expect(elementRendererChildren[0]).toHaveClass(\"stSnow\")\n    })\n  })\n})\n"],"mappings":"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"}