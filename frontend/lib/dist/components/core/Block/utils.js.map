{"version":3,"file":"utils.js","names":["ScriptRunState","getDividerColors","shouldComponentBeEnabled","elementType","scriptRunState","RUNNING","isElementStale","node","scriptRunId","fragmentIdsThisRun","RERUN_REQUESTED","length","Boolean","fragmentId","includes","isComponentStale","enable","assignDividerColor","theme","allColorMap","allColorKeys","Object","keys","blue","green","orange","red","violet","autoColorMap","autoColorKeys","dividerIndex","Array","from","getElements","forEach","element","_element$heading","divider","heading","type","colorKey"],"sources":["../../../../src/components/core/Block/utils.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ScriptRunState } from \"@streamlit/lib/src/ScriptRunState\"\nimport { BlockNode, AppNode } from \"@streamlit/lib/src/AppNode\"\nimport {\n  FormsData,\n  WidgetStateManager,\n} from \"@streamlit/lib/src/WidgetStateManager\"\nimport { FileUploadClient } from \"@streamlit/lib/src/FileUploadClient\"\nimport { ComponentRegistry } from \"@streamlit/lib/src/components/widgets/CustomComponent\"\nimport { SessionInfo } from \"@streamlit/lib/src/SessionInfo\"\nimport { StreamlitEndpoints } from \"@streamlit/lib/src/StreamlitEndpoints\"\nimport { EmotionTheme, getDividerColors } from \"@streamlit/lib/src/theme\"\n\nexport function shouldComponentBeEnabled(\n  elementType: string,\n  scriptRunState: ScriptRunState\n): boolean {\n  return elementType !== \"empty\" || scriptRunState !== ScriptRunState.RUNNING\n}\n\nexport function isElementStale(\n  node: AppNode,\n  scriptRunState: ScriptRunState,\n  scriptRunId: string,\n  fragmentIdsThisRun?: Array<string>\n): boolean {\n  if (scriptRunState === ScriptRunState.RERUN_REQUESTED) {\n    // If a rerun was just requested, all of our current elements\n    // are about to become stale.\n    return true\n  }\n\n  if (scriptRunState === ScriptRunState.RUNNING) {\n    if (fragmentIdsThisRun && fragmentIdsThisRun.length) {\n      return Boolean(\n        node.fragmentId && fragmentIdsThisRun.includes(node.fragmentId)\n      )\n    }\n    return node.scriptRunId !== scriptRunId\n  }\n\n  return false\n}\n\nexport function isComponentStale(\n  enable: boolean,\n  node: AppNode,\n  scriptRunState: ScriptRunState,\n  scriptRunId: string,\n  fragmentIdsThisRun?: Array<string>\n): boolean {\n  return (\n    !enable ||\n    isElementStale(node, scriptRunState, scriptRunId, fragmentIdsThisRun)\n  )\n}\n\nexport function assignDividerColor(\n  node: BlockNode,\n  theme: EmotionTheme\n): void {\n  // All available divider colors\n  const allColorMap = getDividerColors(theme)\n  const allColorKeys = Object.keys(allColorMap)\n\n  // Limited colors for auto assignment\n  const { blue, green, orange, red, violet } = allColorMap\n  const autoColorMap = { blue, green, orange, red, violet }\n  const autoColorKeys = Object.keys(autoColorMap)\n  let dividerIndex = 0\n\n  Array.from(node.getElements()).forEach(element => {\n    const divider = element.heading?.divider\n    if (element.type === \"heading\" && divider) {\n      if (divider === \"auto\") {\n        const colorKey = autoColorKeys[dividerIndex]\n        // @ts-expect-error - heading.divider is not undefined at this point\n        element.heading.divider = autoColorMap[colorKey]\n        dividerIndex += 1\n        if (dividerIndex === autoColorKeys.length) dividerIndex = 0\n      } else if (allColorKeys.includes(divider)) {\n        // @ts-expect-error\n        element.heading.divider = allColorMap[divider]\n      }\n    }\n  })\n}\nexport interface BaseBlockProps {\n  /**\n   * The app's StreamlitEndpoints instance. Exposes non-websocket endpoint logic\n   * used by various Streamlit elements.\n   */\n  endpoints: StreamlitEndpoints\n\n  /**\n   * The app's SessionInfo instance. Exposes session-specific properties.\n   */\n  sessionInfo: SessionInfo\n\n  /**\n   * The app's WidgetStateManager instance. Used by all widget elements to\n   * store and retrieve widget state. When the user interacts with a widget,\n   * the WidgetStateManager initiates the \"rerun BackMsg\" data flow to kick\n   * off a script rerun.\n   */\n  widgetMgr: WidgetStateManager\n\n  /**\n   * The app's FileUploadClient instance. Used by the FileUploader component\n   * to send files to the Streamlit backend.\n   */\n  uploadClient: FileUploadClient\n\n  /**\n   * The app's ComponentRegistry instance. Dispatches \"Custom Component\"\n   * iframe messages to ComponentInstances.\n   */\n  componentRegistry: ComponentRegistry\n\n  /**\n   * The ID of the current \"script run\". When a Streamlit script is re-run\n   * (usually as a result of the user interacting with a widget), the Streamlit\n   * backend sends a new scriptRunId to the frontend. When the script run ends,\n   * the frontend discards \"stale\" elements (that is, elements with a non-current\n   * scriptRunId).\n   */\n  scriptRunId: string\n\n  /**\n   * The app's current ScriptRunState. This is used in combination with\n   * scriptRunId to prune stale elements. It's also used by the app to\n   * display the \"running man\" indicator when the app's script is being re-run.\n   */\n  scriptRunState: ScriptRunState\n\n  /**\n   * If true, all widgets will be disabled and the app will be non-interactive.\n   * This is generally set when the frontend is disconnected from the backend.\n   */\n  widgetsDisabled: boolean\n\n  /**\n   * Data about all forms in the app. The WidgetStateManager creates its own\n   * internal FormsData instance, and calls a callback (`formsDataChanged`)\n   * when forms are updated. This FormsData instance should be updated\n   * from that callback.\n   */\n  formsData: FormsData\n\n  /**\n   * If true , the element should not allow going into fullscreen. Right now we plan\n   * to use it, for example, in Dialogs to prevent fullscreen issues.\n   */\n  disableFullscreenMode?: boolean\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASA,cAAc;AAUvB,SAAuBC,gBAAgB;AAEvC,OAAO,SAASC,wBAAwBA,CACtCC,WAAmB,EACnBC,cAA8B,EACrB;EACT,OAAOD,WAAW,KAAK,OAAO,IAAIC,cAAc,KAAKJ,cAAc,CAACK,OAAO;AAC7E;AAEA,OAAO,SAASC,cAAcA,CAC5BC,IAAa,EACbH,cAA8B,EAC9BI,WAAmB,EACnBC,kBAAkC,EACzB;EACT,IAAIL,cAAc,KAAKJ,cAAc,CAACU,eAAe,EAAE;IACrD;IACA;IACA,OAAO,IAAI;EACb;EAEA,IAAIN,cAAc,KAAKJ,cAAc,CAACK,OAAO,EAAE;IAC7C,IAAII,kBAAkB,IAAIA,kBAAkB,CAACE,MAAM,EAAE;MACnD,OAAOC,OAAO,CACZL,IAAI,CAACM,UAAU,IAAIJ,kBAAkB,CAACK,QAAQ,CAACP,IAAI,CAACM,UAAU,CAChE,CAAC;IACH;IACA,OAAON,IAAI,CAACC,WAAW,KAAKA,WAAW;EACzC;EAEA,OAAO,KAAK;AACd;AAEA,OAAO,SAASO,gBAAgBA,CAC9BC,MAAe,EACfT,IAAa,EACbH,cAA8B,EAC9BI,WAAmB,EACnBC,kBAAkC,EACzB;EACT,OACE,CAACO,MAAM,IACPV,cAAc,CAACC,IAAI,EAAEH,cAAc,EAAEI,WAAW,EAAEC,kBAAkB,CAAC;AAEzE;AAEA,OAAO,SAASQ,kBAAkBA,CAChCV,IAAe,EACfW,KAAmB,EACb;EACN;EACA,MAAMC,WAAW,GAAGlB,gBAAgB,CAACiB,KAAK,CAAC;EAC3C,MAAME,YAAY,GAAGC,MAAM,CAACC,IAAI,CAACH,WAAW,CAAC;;EAE7C;EACA,MAAM;IAAEI,IAAI;IAAEC,KAAK;IAAEC,MAAM;IAAEC,GAAG;IAAEC;EAAO,CAAC,GAAGR,WAAW;EACxD,MAAMS,YAAY,GAAG;IAAEL,IAAI;IAAEC,KAAK;IAAEC,MAAM;IAAEC,GAAG;IAAEC;EAAO,CAAC;EACzD,MAAME,aAAa,GAAGR,MAAM,CAACC,IAAI,CAACM,YAAY,CAAC;EAC/C,IAAIE,YAAY,GAAG,CAAC;EAEpBC,KAAK,CAACC,IAAI,CAACzB,IAAI,CAAC0B,WAAW,CAAC,CAAC,CAAC,CAACC,OAAO,CAACC,OAAO,IAAI;IAAA,IAAAC,gBAAA;IAChD,MAAMC,OAAO,IAAAD,gBAAA,GAAGD,OAAO,CAACG,OAAO,cAAAF,gBAAA,uBAAfA,gBAAA,CAAiBC,OAAO;IACxC,IAAIF,OAAO,CAACI,IAAI,KAAK,SAAS,IAAIF,OAAO,EAAE;MACzC,IAAIA,OAAO,KAAK,MAAM,EAAE;QACtB,MAAMG,QAAQ,GAAGX,aAAa,CAACC,YAAY,CAAC;QAC5C;QACAK,OAAO,CAACG,OAAO,CAACD,OAAO,GAAGT,YAAY,CAACY,QAAQ,CAAC;QAChDV,YAAY,IAAI,CAAC;QACjB,IAAIA,YAAY,KAAKD,aAAa,CAAClB,MAAM,EAAEmB,YAAY,GAAG,CAAC;MAC7D,CAAC,MAAM,IAAIV,YAAY,CAACN,QAAQ,CAACuB,OAAO,CAAC,EAAE;QACzC;QACAF,OAAO,CAACG,OAAO,CAACD,OAAO,GAAGlB,WAAW,CAACkB,OAAO,CAAC;MAChD;IACF;EACF,CAAC,CAAC;AACJ"}